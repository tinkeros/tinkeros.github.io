<!DOCTYPE HTML>
<html style="background-color:#FFFFFF;">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=US-ASCII">
<title>The Temple Operating System</title>
<meta name="keywords" content="Operating System,64-Bit,64 Bit,Temple,OS,TempleOS,Free,Open Source,Public Domain,x86_64">
<meta name="generator" content="TinkerOS V5.10">
<style type="text/css">
.cB0{color:#000000;background-color:#55ffff;}
.cB1{color:#0000aa;background-color:#55ffff;}
.cB2{color:#00aa00;background-color:#55ffff;}
.cB3{color:#00aaaa;background-color:#55ffff;}
.cB5{color:#aa00aa;background-color:#55ffff;}
.cB6{color:#aa5500;background-color:#55ffff;}
.cB7{color:#aaaaaa;background-color:#55ffff;}
.cB9{color:#5555ff;background-color:#55ffff;}
.cF0{color:#000000;background-color:#ffffff;}
.cF1{color:#0000aa;background-color:#ffffff;}
.cF2{color:#00aa00;background-color:#ffffff;}
.cF3{color:#00aaaa;background-color:#ffffff;}
.cF4{color:#aa0000;background-color:#ffffff;}
.cF5{color:#aa00aa;background-color:#ffffff;}
.cF6{color:#aa5500;background-color:#ffffff;}
.cF7{color:#aaaaaa;background-color:#ffffff;}
.cF8{color:#555555;background-color:#ffffff;}
.cF9{color:#5555ff;background-color:#ffffff;}
.cFA{color:#55ff55;background-color:#ffffff;}
.cFB{color:#55ffff;background-color:#ffffff;}
.cFC{color:#ff5555;background-color:#ffffff;}
.cFD{color:#ff55ff;background-color:#ffffff;}
.cFE{color:#ffff55;background-color:#ffffff;}
.cFF{color:#ffffff;background-color:#ffffff;}
</style>
</head>
<body style="background-color:#55FFFF; border-style:solid;
	  border-width:8px; border-color:#0000AA;
	  margin-left:auto; margin-right:auto; width:800px; ">
<pre style="font-family:courier;font-size:10pt;font-variant-ligatures: none;">
<div style="margin-left:auto; margin-right:auto; width: 640px;">
<a name="l1"></a><span class=cB0>#</span><span class=cB1>help_index</span><span class=cB0> </span><span class=cB6>&quot;DolDoc&quot;</span><span class=cB0>
<a name="l2"></a>
<a name="l3"></a></span><span class=cB9>I64</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocRecalc.html#l3"></span><span class=cB5>DocWordWrapDel</a></span><span class=cB0>(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1468"></span><span class=cB9>CDoc</a></span><span class=cB0> *doc,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1292"></span><span class=cB9>CDocEntry</a></span><span class=cB0> *doc_e,
<a name="l4"></a>                   </span><span class=cB1>Bool</span><span class=cB0> full_refresh,</span><span class=cB1>Bool</span><span class=cB0> same_win,</span><span class=cB9>I64</span><span class=cB0> left_margin,</span><span class=cB9>I64</span><span class=cB0> right_margin,
<a name="l5"></a>                   <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1292"></span><span class=cB9>CDocEntry</a></span><span class=cB0> **_best_doc_e,</span><span class=cB9>I64</span><span class=cB0> *_best_col)
<a name="l6"></a>{
<a name="l7"></a>  <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1292"></span><span class=cB9>CDocEntry</a></span><span class=cB0> *doc_e2;
<a name="l8"></a>  </span><span class=cB1>U8</span><span class=cB0> *ptr;
<a name="l9"></a>  </span><span class=cB9>I64</span><span class=cB0> j,k;
<a name="l10"></a>  </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1070"></span><span class=cB3>DOCEF_TAG</a></span><span class=cB0> &amp;&amp; doc_e-&gt;tag)
<a name="l11"></a>    k=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l61"></span><span class=cB5>StrLen</a></span><span class=cB0>(doc_e-&gt;tag);
<a name="l12"></a>  </span><span class=cB1>else</span><span class=cB0>
<a name="l13"></a>    k=0;
<a name="l14"></a>  </span><span class=cB1>if</span><span class=cB0> (full_refresh)
<a name="l15"></a>    </span><span class=cB1>while</span><span class=cB0> (<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l22"></span><span class=cB3>TRUE</a></span><span class=cB0>)
<a name="l16"></a>    </span><span class=cB7>{</span><span class=cB0>
<a name="l17"></a>      doc_e2=doc_e-&gt;next;
<a name="l18"></a>      </span><span class=cB1>if</span><span class=cB0> (doc_e2-&gt;type_u8==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1007"></span><span class=cB3>DOCT_SOFT_NEW_LINE</a></span><span class=cB0> &amp;&amp; !same_win)
<a name="l19"></a>      {
<a name="l20"></a>        </span><span class=cB1>if</span><span class=cB0> (doc-&gt;cur_entry==doc_e2)
<a name="l21"></a>        </span><span class=cB7>{</span><span class=cB0>
<a name="l22"></a>          doc-&gt;cur_entry=doc_e2-&gt;next;
<a name="l23"></a>          doc-&gt;cur_col=doc-&gt;cur_entry-&gt;min_col;
<a name="l24"></a>        </span><span class=cB7>}</span><span class=cB0>
<a name="l25"></a>        </span><span class=cB1>if</span><span class=cB0> (*_best_doc_e==doc_e2)
<a name="l26"></a>        </span><span class=cB7>{</span><span class=cB0>
<a name="l27"></a>          *_best_doc_e=doc_e2-&gt;next;
<a name="l28"></a>          *_best_col=0;
<a name="l29"></a>        </span><span class=cB7>}</span><span class=cB0>
<a name="l30"></a>        <a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocNew.html#l67"></span><span class=cB5>DocEntryDel</a></span><span class=cB0>(doc,doc_e2);
<a name="l31"></a>      }
<a name="l32"></a>      </span><span class=cB1>else</span><span class=cB0> </span><span class=cB1>if</span><span class=cB0> (<a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocNew.html#l34"></span><span class=cB5>IsEditableText</a></span><span class=cB7>(</span><span class=cB0>doc_e</span><span class=cB7>)</span><span class=cB0> &amp;&amp;
<a name="l33"></a>               doc_e-&gt;de_flags==doc_e2-&gt;de_flags &amp;&amp; doc_e-&gt;type==doc_e2-&gt;type)
<a name="l34"></a>      {
<a name="l35"></a>        j=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l61"></span><span class=cB5>StrLen</a></span><span class=cB0>(doc_e2-&gt;tag);
<a name="l36"></a>        ptr=<a href="http://tinkeros.github.io/WbGit/Kernel/Mem/MAllocFree.html#l419"></span><span class=cB5>MAlloc</a></span><span class=cB0>(k+j+1,doc-&gt;mem_task);
<a name="l37"></a>        <a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l172"></span><span class=cB5>MemCpy</a></span><span class=cB0>(ptr,doc_e-&gt;tag,k);
<a name="l38"></a>        <a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l172"></span><span class=cB5>MemCpy</a></span><span class=cB0>(ptr+k,doc_e2-&gt;tag,j+1);
<a name="l39"></a>        <a href="http://tinkeros.github.io/WbGit/Kernel/Mem/MAllocFree.html#l415"></span><span class=cB5>Free</a></span><span class=cB0>(doc_e-&gt;tag);
<a name="l40"></a>        doc_e-&gt;tag=ptr;
<a name="l41"></a>        </span><span class=cB1>if</span><span class=cB0> (doc-&gt;cur_entry==doc_e2)
<a name="l42"></a>        </span><span class=cB7>{</span><span class=cB0>
<a name="l43"></a>          doc-&gt;cur_entry=doc_e;
<a name="l44"></a>          doc-&gt;cur_col+=k;
<a name="l45"></a>        </span><span class=cB7>}</span><span class=cB0>
<a name="l46"></a>        </span><span class=cB1>if</span><span class=cB0> (*_best_doc_e==doc_e2)
<a name="l47"></a>        </span><span class=cB7>{</span><span class=cB0>
<a name="l48"></a>          *_best_doc_e=doc_e;
<a name="l49"></a>          *_best_col=0;
<a name="l50"></a>        </span><span class=cB7>}</span><span class=cB0>
<a name="l51"></a>        <a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocNew.html#l67"></span><span class=cB5>DocEntryDel</a></span><span class=cB0>(doc,doc_e2);
<a name="l52"></a>        k+=j;
<a name="l53"></a>        </span><span class=cB1>if</span><span class=cB0> (k&gt;</span><span class=cB7>(</span><span class=cB0>right_margin-left_margin+1</span><span class=cB7>)</span><span class=cB0>&lt;&lt;1)
<a name="l54"></a>          </span><span class=cB1>break</span><span class=cB0>;
<a name="l55"></a>      }
<a name="l56"></a>      </span><span class=cB1>else</span><span class=cB0>
<a name="l57"></a>        </span><span class=cB1>break</span><span class=cB0>;
<a name="l58"></a>    </span><span class=cB7>}</span><span class=cB0>
<a name="l59"></a>  </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1084"></span><span class=cB3>DOCEF_SCROLLING_X</a></span><span class=cB0>)
<a name="l60"></a>    k=doc_e-&gt;scroll_len;
<a name="l61"></a>  </span><span class=cB1>return</span><span class=cB0> k;
<a name="l62"></a>}
<a name="l63"></a>
<a name="l64"></a></span><span class=cB1>U0</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocRecalc.html#l64"></span><span class=cB5>DocRecalcXY</a></span><span class=cB0>(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1468"></span><span class=cB9>CDoc</a></span><span class=cB0> *doc,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1292"></span><span class=cB9>CDocEntry</a></span><span class=cB0> *doc_e,
<a name="l65"></a>               </span><span class=cB9>I64</span><span class=cB0> k,</span><span class=cB9>I64</span><span class=cB0> left,</span><span class=cB9>I64</span><span class=cB0> width,</span><span class=cB9>I64</span><span class=cB0> height,</span><span class=cB9>I64</span><span class=cB0> left_margin,</span><span class=cB9>I64</span><span class=cB0> right_margin,
<a name="l66"></a>               </span><span class=cB9>I64</span><span class=cB0> x0,</span><span class=cB9>I64</span><span class=cB0> y0,</span><span class=cB9>I64</span><span class=cB0> *_x,</span><span class=cB9>I64</span><span class=cB0> *_y)
<a name="l67"></a>{
<a name="l68"></a>  </span><span class=cB9>I64</span><span class=cB0> i,x=*_x,y=*_y;
<a name="l69"></a>  </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1101"></span><span class=cB3>DOCEF_MARGIN_REL_X</a></span><span class=cB0>)
<a name="l70"></a>  </span><span class=cB7>{</span><span class=cB0>
<a name="l71"></a>    </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1092"></span><span class=cB3>DOCEF_LEFT_X</a></span><span class=cB0>)
<a name="l72"></a>      x=left_margin-left;
<a name="l73"></a>    </span><span class=cB1>else</span><span class=cB0> </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1094"></span><span class=cB3>DOCEF_RIGHT_X</a></span><span class=cB0>)
<a name="l74"></a>      x=right_margin-(k-1)-left;
<a name="l75"></a>    </span><span class=cB1>else</span><span class=cB0> </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1093"></span><span class=cB3>DOCEF_CENTER_X</a></span><span class=cB0>)
<a name="l76"></a>      x=(right_margin+left_margin)&gt;&gt;1-k&gt;&gt;1-left;
<a name="l77"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l78"></a>  </span><span class=cB1>else</span><span class=cB0>
<a name="l79"></a>  </span><span class=cB7>{</span><span class=cB0>
<a name="l80"></a>    </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1092"></span><span class=cB3>DOCEF_LEFT_X</a></span><span class=cB0>)
<a name="l81"></a>      x=x0;
<a name="l82"></a>    </span><span class=cB1>else</span><span class=cB0> </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1094"></span><span class=cB3>DOCEF_RIGHT_X</a></span><span class=cB0>)
<a name="l83"></a>      x=width+x0-k;
<a name="l84"></a>    </span><span class=cB1>else</span><span class=cB0> </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1093"></span><span class=cB3>DOCEF_CENTER_X</a></span><span class=cB0>)
<a name="l85"></a>      x=(width+x0-k)&gt;&gt;1;
<a name="l86"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l87"></a>  i=y;
<a name="l88"></a>  </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1100"></span><span class=cB3>DOCEF_PAGE_REL_Y</a></span><span class=cB0>)
<a name="l89"></a>  </span><span class=cB7>{</span><span class=cB0>
<a name="l90"></a>    doc-&gt;flags|=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1388"></span><span class=cB3>DOCF_BWD_MOVEMENT</a></span><span class=cB0>;
<a name="l91"></a>    </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1095"></span><span class=cB3>DOCEF_TOP_Y</a></span><span class=cB0>)
<a name="l92"></a>      y-=doc_e-&gt;page_line_num;
<a name="l93"></a>    </span><span class=cB1>else</span><span class=cB0> </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1097"></span><span class=cB3>DOCEF_BOTTOM_Y</a></span><span class=cB0>)
<a name="l94"></a>      y+=doc_e-&gt;settings.page_len-doc_e-&gt;page_line_num;
<a name="l95"></a>    </span><span class=cB1>else</span><span class=cB0> </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1096"></span><span class=cB3>DOCEF_CENTER_Y</a></span><span class=cB0>)
<a name="l96"></a>      y+=doc_e-&gt;settings.page_len&gt;&gt;1-doc_e-&gt;page_line_num;
<a name="l97"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l98"></a>  </span><span class=cB1>else</span><span class=cB0>
<a name="l99"></a>  </span><span class=cB7>{</span><span class=cB0>
<a name="l100"></a>    doc-&gt;flags|=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1388"></span><span class=cB3>DOCF_BWD_MOVEMENT</a></span><span class=cB0>;
<a name="l101"></a>    </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1095"></span><span class=cB3>DOCEF_TOP_Y</a></span><span class=cB0>)
<a name="l102"></a>      y=y0;
<a name="l103"></a>    </span><span class=cB1>else</span><span class=cB0> </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1097"></span><span class=cB3>DOCEF_BOTTOM_Y</a></span><span class=cB0>)
<a name="l104"></a>      y=height-1+y0;
<a name="l105"></a>    </span><span class=cB1>else</span><span class=cB0> </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1096"></span><span class=cB3>DOCEF_CENTER_Y</a></span><span class=cB0>)
<a name="l106"></a>      y=height&gt;&gt;1+y0;
<a name="l107"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l108"></a>  </span><span class=cB1>if</span><span class=cB0> (y!=i)
<a name="l109"></a>  </span><span class=cB7>{</span><span class=cB0>
<a name="l110"></a>    doc-&gt;page_line_num+=y-i;
<a name="l111"></a>    </span><span class=cB1>if</span><span class=cB0> (doc-&gt;page_line_num&lt;0)
<a name="l112"></a>      doc-&gt;page_line_num=doc_e-&gt;settings.page_len+
<a name="l113"></a>                         doc-&gt;page_line_num%doc_e-&gt;settings.page_len;
<a name="l114"></a>    </span><span class=cB1>else</span><span class=cB0>
<a name="l115"></a>      doc-&gt;page_line_num=doc-&gt;page_line_num%doc_e-&gt;settings.page_len;
<a name="l116"></a>    </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;settings.header!=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1268"></span><span class=cB3>DOC_DFT</a></span><span class=cB0> &amp;&amp;
<a name="l117"></a>        doc-&gt;page_line_num&lt;doc_e-&gt;settings.header)
<a name="l118"></a>    {
<a name="l119"></a>      y+=doc_e-&gt;settings.header-doc-&gt;page_line_num;
<a name="l120"></a>      doc-&gt;page_line_num=doc_e-&gt;settings.header;
<a name="l121"></a>    }
<a name="l122"></a>    </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;settings.footer==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1268"></span><span class=cB3>DOC_DFT</a></span><span class=cB0>)
<a name="l123"></a>    {
<a name="l124"></a>      </span><span class=cB1>if</span><span class=cB0> (doc-&gt;page_line_num&gt;=doc_e-&gt;settings.page_len)
<a name="l125"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l126"></a>        </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;settings.header==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1268"></span><span class=cB3>DOC_DFT</a></span><span class=cB0>)
<a name="l127"></a>          doc-&gt;page_line_num=0;
<a name="l128"></a>        </span><span class=cB1>else</span><span class=cB0>
<a name="l129"></a>        {
<a name="l130"></a>          doc-&gt;page_line_num=doc_e-&gt;settings.header;
<a name="l131"></a>          y+=doc_e-&gt;settings.header;
<a name="l132"></a>        }
<a name="l133"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l134"></a>    }
<a name="l135"></a>    </span><span class=cB1>else</span><span class=cB0>
<a name="l136"></a>    {
<a name="l137"></a>      </span><span class=cB1>if</span><span class=cB0> (doc-&gt;page_line_num&gt;=
<a name="l138"></a>          doc_e-&gt;settings.page_len-doc_e-&gt;settings.footer)
<a name="l139"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l140"></a>        y+=doc_e-&gt;settings.footer;
<a name="l141"></a>        </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;settings.header==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1268"></span><span class=cB3>DOC_DFT</a></span><span class=cB0>)
<a name="l142"></a>          doc-&gt;page_line_num=0;
<a name="l143"></a>        </span><span class=cB1>else</span><span class=cB0>
<a name="l144"></a>        {
<a name="l145"></a>          doc-&gt;page_line_num=doc_e-&gt;settings.header;
<a name="l146"></a>          y+=doc_e-&gt;settings.header;
<a name="l147"></a>        }
<a name="l148"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l149"></a>    }
<a name="l150"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l151"></a>  *_x=x;
<a name="l152"></a>  *_y=y;
<a name="l153"></a>}
<a name="l154"></a>
<a name="l155"></a><a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1292"></span><span class=cB9>CDocEntry</a></span><span class=cB0> *<a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocRecalc.html#l155"></span><span class=cB5>DocSplitTag</a></span><span class=cB0>(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1468"></span><span class=cB9>CDoc</a></span><span class=cB0> *doc,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1292"></span><span class=cB9>CDocEntry</a></span><span class=cB0> *doc_e,</span><span class=cB9>I64</span><span class=cB0> i,</span><span class=cB9>I64</span><span class=cB0> x,</span><span class=cB9>I64</span><span class=cB0> y,</span><span class=cB9>I64</span><span class=cB0> type_u8)
<a name="l156"></a>{</span><span class=cB2>//Split tag at i, insert DOCT_SOFT_NEW_LINE, DOCT_MARKER or DOCT_CURSOR</span><span class=cB0>
<a name="l157"></a>  </span><span class=cB1>U8</span><span class=cB0> *ptr;
<a name="l158"></a>  <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1292"></span><span class=cB9>CDocEntry</a></span><span class=cB0> *doc_e2;
<a name="l159"></a>  </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;type_u8==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1005"></span><span class=cB3>DOCT_TEXT</a></span><span class=cB0> &amp;&amp; i)
<a name="l160"></a>  </span><span class=cB7>{</span><span class=cB0>
<a name="l161"></a>    </span><span class=cB1>if</span><span class=cB0> (i&lt;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l61"></span><span class=cB5>StrLen</a></span><span class=cB7>(</span><span class=cB0>doc_e-&gt;tag</span><span class=cB7>)</span><span class=cB0>)
<a name="l162"></a>    {
<a name="l163"></a>      doc_e2=<a href="http://tinkeros.github.io/WbGit/Kernel/Mem/MAllocFree.html#l439"></span><span class=cB5>MAllocIdent</a></span><span class=cB0>(doc_e,doc-&gt;mem_task);
<a name="l164"></a>      doc_e2-&gt;tag=<a href="http://tinkeros.github.io/WbGit/Kernel/Mem/MAllocFree.html#l478"></span><span class=cB5>StrNew</a></span><span class=cB0>(doc_e-&gt;tag+i,doc-&gt;mem_task);
<a name="l165"></a>      doc_e2-&gt;de_flags=doc_e-&gt;de_flags&amp;~<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1132"></span><span class=cB3>DOCEG_HAS_ALLOC</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1070"></span><span class=cB3>DOCEF_TAG</a></span><span class=cB0>;
<a name="l166"></a>      <a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l68"></span><span class=cB5>QueIns</a></span><span class=cB0>(doc_e2,doc_e);
<a name="l167"></a>      </span><span class=cB1>if</span><span class=cB0> (doc-&gt;cur_entry==doc_e &amp;&amp; doc-&gt;cur_col&gt;=i)
<a name="l168"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l169"></a>        doc-&gt;cur_entry=doc_e2;
<a name="l170"></a>        doc-&gt;cur_col=doc-&gt;cur_col-i;
<a name="l171"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l172"></a>      doc_e-&gt;tag[i]=0;
<a name="l173"></a>      ptr=<a href="http://tinkeros.github.io/WbGit/Kernel/Mem/MAllocFree.html#l478"></span><span class=cB5>StrNew</a></span><span class=cB0>(doc_e-&gt;tag,doc-&gt;mem_task);
<a name="l174"></a>      <a href="http://tinkeros.github.io/WbGit/Kernel/Mem/MAllocFree.html#l415"></span><span class=cB5>Free</a></span><span class=cB0>(doc_e-&gt;tag);
<a name="l175"></a>      doc_e-&gt;tag=ptr;
<a name="l176"></a>    }
<a name="l177"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l178"></a>  </span><span class=cB1>else</span><span class=cB0>
<a name="l179"></a>    doc_e=doc_e-&gt;last;
<a name="l180"></a>  doc_e2=<a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocNew.html#l42"></span><span class=cB5>DocEntryNewBase</a></span><span class=cB0>(doc,type_u8|doc_e-&gt;type &amp; 0xFFFFFF00,
<a name="l181"></a>                         doc_e-&gt;de_flags&amp;~<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1136"></span><span class=cB3>DOCEG_HAS_ARG</a></span><span class=cB0>,x,y,doc_e-&gt;page_line_num);
<a name="l182"></a>  <a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l174"></span><span class=cB5>MemCpy64</a></span><span class=cB0>(&amp;doc_e2-&gt;settings,&amp;doc_e-&gt;settings,</span><span class=cB1>sizeof</span><span class=cB7>(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1258"></span><span class=cB9>CDocSettings</a></span><span class=cB7>)</span><span class=cB0>/8);
<a name="l183"></a>  <a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l68"></span><span class=cB5>QueIns</a></span><span class=cB0>(doc_e2,doc_e);
<a name="l184"></a>  </span><span class=cB1>return</span><span class=cB0> doc_e2;
<a name="l185"></a>}
<a name="l186"></a>
<a name="l187"></a><a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1292"></span><span class=cB9>CDocEntry</a></span><span class=cB0> *<a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocRecalc.html#l187"></span><span class=cB5>DocWordWrapAdd</a></span><span class=cB0>(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1468"></span><span class=cB9>CDoc</a></span><span class=cB0> *doc,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1292"></span><span class=cB9>CDocEntry</a></span><span class=cB0> *doc_e,
<a name="l188"></a>                          </span><span class=cB9>I64</span><span class=cB0> *_k,</span><span class=cB9>I64</span><span class=cB0> left,</span><span class=cB9>I64</span><span class=cB0> right_margin,</span><span class=cB9>I64</span><span class=cB0> x,</span><span class=cB9>I64</span><span class=cB0> y)
<a name="l189"></a>{
<a name="l190"></a>  <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1292"></span><span class=cB9>CDocEntry</a></span><span class=cB0> *doc_e2;
<a name="l191"></a>  </span><span class=cB9>I64</span><span class=cB0> j,i=right_margin+1-(x+left),  </span><span class=cB2>//Space left on line</span><span class=cB0>
<a name="l192"></a>        ii=x+1-doc_e-&gt;settings.left_margin;
<a name="l193"></a>  </span><span class=cB1>if</span><span class=cB0> (<a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocNew.html#l34"></span><span class=cB5>IsEditableText</a></span><span class=cB7>(</span><span class=cB0>doc_e</span><span class=cB7>)</span><span class=cB0>)
<a name="l194"></a>  </span><span class=cB7>{</span><span class=cB0>
<a name="l195"></a>    </span><span class=cB1>if</span><span class=cB0> (doc-&gt;cur_entry==doc_e-&gt;next)
<a name="l196"></a>    {
<a name="l197"></a>      </span><span class=cB1>if</span><span class=cB0> (doc-&gt;cur_col==doc_e-&gt;next-&gt;min_col)
<a name="l198"></a>        i--;
<a name="l199"></a>    }
<a name="l200"></a>    </span><span class=cB1>else</span><span class=cB0>
<a name="l201"></a>    {
<a name="l202"></a>      </span><span class=cB1>if</span><span class=cB0> (doc-&gt;cur_entry==doc_e &amp;&amp; doc-&gt;cur_col==i)
<a name="l203"></a>        i--;
<a name="l204"></a>    }
<a name="l205"></a>    </span><span class=cB1>if</span><span class=cB0> (*_k&gt;i)
<a name="l206"></a>    {
<a name="l207"></a>      </span><span class=cB1>for</span><span class=cB0> (j=i; j&gt;8-ii &amp;&amp; j&gt;=0; j--)
<a name="l208"></a>        </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;tag[j]==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l4199"></span><span class=cB3>CH_SPACE</a></span><span class=cB0> || doc_e-&gt;tag[j]==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l4198"></span><span class=cB3>CH_SHIFT_SPACE</a></span><span class=cB0>)
<a name="l209"></a>        </span><span class=cB7>{</span><span class=cB0>
<a name="l210"></a>          i=j+1;
<a name="l211"></a>          </span><span class=cB1>break</span><span class=cB0>;
<a name="l212"></a>        </span><span class=cB7>}</span><span class=cB0>
<a name="l213"></a>      </span><span class=cB1>if</span><span class=cB0> (0&lt;i&lt;*_k)
<a name="l214"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l215"></a>        <a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocRecalc.html#l155"></span><span class=cB5>DocSplitTag</a></span><span class=cB0>(doc,doc_e,i,x,y,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1007"></span><span class=cB3>DOCT_SOFT_NEW_LINE</a></span><span class=cB0>);
<a name="l216"></a>        *_k=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l61"></span><span class=cB5>StrLen</a></span><span class=cB0>(doc_e-&gt;tag);
<a name="l217"></a>        </span><span class=cB1>return</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l21"></span><span class=cB3>NULL</a></span><span class=cB0>;
<a name="l218"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l219"></a>    }
<a name="l220"></a>    </span><span class=cB1>if</span><span class=cB0> (*_k==i)
<a name="l221"></a>      </span><span class=cB1>return</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l21"></span><span class=cB3>NULL</a></span><span class=cB0>;
<a name="l222"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l223"></a>  </span><span class=cB1>if</span><span class=cB0> (*_k&gt;=i)
<a name="l224"></a>  </span><span class=cB7>{</span><span class=cB0>
<a name="l225"></a>    doc_e2=doc_e-&gt;last;
<a name="l226"></a>    </span><span class=cB1>if</span><span class=cB0> (doc_e2-&gt;type_u8!=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1007"></span><span class=cB3>DOCT_SOFT_NEW_LINE</a></span><span class=cB0> &amp;&amp;
<a name="l227"></a>        doc_e2-&gt;type_u8!=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1006"></span><span class=cB3>DOCT_NEW_LINE</a></span><span class=cB0> &amp;&amp;
<a name="l228"></a>        doc_e2-&gt;type_u8!=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1031"></span><span class=cB3>DOCT_CURSOR_MOVEMENT</a></span><span class=cB0>)
<a name="l229"></a>    {
<a name="l230"></a>      doc_e2=<a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocNew.html#l42"></span><span class=cB5>DocEntryNewBase</a></span><span class=cB0>(doc,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1007"></span><span class=cB3>DOCT_SOFT_NEW_LINE</a></span><span class=cB0>|doc_e-&gt;type&amp;0xFFFFFF00,
<a name="l231"></a>                             <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1145"></span><span class=cB3>DOCEF_WORD_WRAP</a></span><span class=cB0>|doc_e-&gt;de_flags&amp;</span><span class=cB7>(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1144"></span><span class=cB3>DOCEF_HIGHLIGHT</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1056"></span><span class=cB3>DOCG_BL_IV_UL</a></span><span class=cB0>|
<a name="l232"></a>                                 <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1123"></span><span class=cB3>DOCEF_SKIP</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1126"></span><span class=cB3>DOCEF_FILTER_SKIP</a></span><span class=cB7>)</span><span class=cB0>,x,y,doc_e-&gt;last-&gt;page_line_num);
<a name="l233"></a>      <a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l174"></span><span class=cB5>MemCpy64</a></span><span class=cB0>(&amp;doc_e2-&gt;settings,&amp;doc_e-&gt;settings,</span><span class=cB1>sizeof</span><span class=cB7>(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1258"></span><span class=cB9>CDocSettings</a></span><span class=cB7>)</span><span class=cB0>/8);
<a name="l234"></a>      <a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l68"></span><span class=cB5>QueIns</a></span><span class=cB0>(doc_e2,doc_e-&gt;last);
<a name="l235"></a>      </span><span class=cB1>return</span><span class=cB0> doc_e2;
<a name="l236"></a>    }
<a name="l237"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l238"></a>  </span><span class=cB1>return</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l21"></span><span class=cB3>NULL</a></span><span class=cB0>;
<a name="l239"></a>}
<a name="l240"></a>
<a name="l241"></a></span><span class=cB9>I64</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocRecalc.html#l241"></span><span class=cB5>DocTmpAttr</a></span><span class=cB0>(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1468"></span><span class=cB9>CDoc</a></span><span class=cB0> *doc,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1292"></span><span class=cB9>CDocEntry</a></span><span class=cB0> *doc_e,</span><span class=cB9>I64</span><span class=cB0> cur_u8_attr)
<a name="l242"></a>{
<a name="l243"></a>  </span><span class=cB9>I64</span><span class=cB0> tmp_u32_attr;
<a name="l244"></a>  doc_e-&gt;de_flags=doc-&gt;flags&amp; (<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1056"></span><span class=cB3>DOCG_BL_IV_UL</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1145"></span><span class=cB3>DOCEF_WORD_WRAP</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1144"></span><span class=cB3>DOCEF_HIGHLIGHT</a></span><span class=cB0>) |
<a name="l245"></a>                  doc_e-&gt;de_flags&amp;~(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1056"></span><span class=cB3>DOCG_BL_IV_UL</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1145"></span><span class=cB3>DOCEF_WORD_WRAP</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1144"></span><span class=cB3>DOCEF_HIGHLIGHT</a></span><span class=cB0>);
<a name="l246"></a>  tmp_u32_attr=(cur_u8_attr&amp;0xF0)&lt;&lt;8|
<a name="l247"></a>               doc-&gt;flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1056"></span><span class=cB3>DOCG_BL_IV_UL</a></span><span class=cB0>|(doc_e-&gt;settings.shifted_x&amp;0x1F)&lt;&lt;16|
<a name="l248"></a>               (doc_e-&gt;settings.shifted_y&amp;0x1F)&lt;&lt;21;
<a name="l249"></a>  </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1079"></span><span class=cB3>DOCEF_HAS_BIN</a></span><span class=cB0> &amp;&amp; *doc_e-&gt;tag==</span><span class=cB6>'&lt;'</span><span class=cB0>)
<a name="l250"></a>    tmp_u32_attr.u8[1]|=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1247"></span><span class=cB3>DOC_COLOR_BIN</a></span><span class=cB0>;
<a name="l251"></a>  </span><span class=cB1>else</span><span class=cB0>
<a name="l252"></a>    </span><span class=cB1>switch</span><span class=cB0> (doc_e-&gt;type_u8)
<a name="l253"></a>    </span><span class=cB7>{</span><span class=cB0>
<a name="l254"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1042"></span><span class=cB3>DOCT_SPRITE</a></span><span class=cB0>:
<a name="l255"></a>      </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1075"></span><span class=cB3>DOCEF_LEFT_EXP</a></span><span class=cB0>)
<a name="l256"></a>        tmp_u32_attr.u8[1]|=cur_u8_attr&amp;15;
<a name="l257"></a>      </span><span class=cB1>else</span><span class=cB0> </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1103"></span><span class=cB3>DOCEF_LINK</a></span><span class=cB0>)
<a name="l258"></a>        tmp_u32_attr.u8[1]|=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1241"></span><span class=cB3>DOC_COLOR_LINK</a></span><span class=cB0>;
<a name="l259"></a>      </span><span class=cB1>else</span><span class=cB0> </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1076"></span><span class=cB3>DOCEF_LEFT_MACRO</a></span><span class=cB0>)
<a name="l260"></a>        tmp_u32_attr.u8[1]|=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1242"></span><span class=cB3>DOC_COLOR_MACRO</a></span><span class=cB0>;
<a name="l261"></a>      </span><span class=cB1>else</span><span class=cB0> </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; </span><span class=cB7>(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1121"></span><span class=cB3>DOCEF_TREE</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1122"></span><span class=cB3>DOCEF_LST</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l262"></a>        tmp_u32_attr.u8[1]|=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1244"></span><span class=cB3>DOC_COLOR_TREE</a></span><span class=cB0>;
<a name="l263"></a>      </span><span class=cB1>else</span><span class=cB0>
<a name="l264"></a>        tmp_u32_attr.u8[1]|=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1247"></span><span class=cB3>DOC_COLOR_BIN</a></span><span class=cB0>;
<a name="l265"></a>      </span><span class=cB1>break</span><span class=cB0>;
<a name="l266"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1046"></span><span class=cB3>DOCT_HTML_CODE</a></span><span class=cB0>:
<a name="l267"></a>      tmp_u32_attr.u8[1]|=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1247"></span><span class=cB3>DOC_COLOR_BIN</a></span><span class=cB0>;
<a name="l268"></a>      </span><span class=cB1>break</span><span class=cB0>;
<a name="l269"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1033"></span><span class=cB3>DOCT_LINK</a></span><span class=cB0>:
<a name="l270"></a>      tmp_u32_attr.u8[1]|=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1241"></span><span class=cB3>DOC_COLOR_LINK</a></span><span class=cB0>;
<a name="l271"></a>      </span><span class=cB1>break</span><span class=cB0>;
<a name="l272"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1038"></span><span class=cB3>DOCT_MACRO</a></span><span class=cB0>:
<a name="l273"></a>      tmp_u32_attr.u8[1]|=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1242"></span><span class=cB3>DOC_COLOR_MACRO</a></span><span class=cB0>;
<a name="l274"></a>      </span><span class=cB1>break</span><span class=cB0>;
<a name="l275"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1032"></span><span class=cB3>DOCT_ANCHOR</a></span><span class=cB0>:
<a name="l276"></a>      tmp_u32_attr.u8[1]|=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1243"></span><span class=cB3>DOC_COLOR_ANCHOR</a></span><span class=cB0>;
<a name="l277"></a>      </span><span class=cB1>break</span><span class=cB0>;
<a name="l278"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1041"></span><span class=cB3>DOCT_TREE</a></span><span class=cB0>:
<a name="l279"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1037"></span><span class=cB3>DOCT_LST</a></span><span class=cB0>:
<a name="l280"></a>      tmp_u32_attr.u8[1]|=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1244"></span><span class=cB3>DOC_COLOR_TREE</a></span><span class=cB0>;
<a name="l281"></a>      </span><span class=cB1>break</span><span class=cB0>;
<a name="l282"></a>    </span><span class=cB1>default</span><span class=cB0>:
<a name="l283"></a>      tmp_u32_attr.u8[1]|=cur_u8_attr&amp;15;
<a name="l284"></a>    </span><span class=cB7>}</span><span class=cB0>
<a name="l285"></a>  doc_e-&gt;type.u8[1]=tmp_u32_attr.u8[1];
<a name="l286"></a>  tmp_u32_attr|=doc_e-&gt;type&amp;0xFFFF0000;
<a name="l287"></a>  </span><span class=cB1>if</span><span class=cB0> (doc_e==doc-&gt;cur_entry &amp;&amp; !</span><span class=cB7>(</span><span class=cB0>doc-&gt;flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1382"></span><span class=cB3>DOCF_DONT_HIGHLIGHT_CURSOR</a></span><span class=cB7>)</span><span class=cB0> &amp;&amp;
<a name="l288"></a>      doc_e-&gt;type_u8!=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1005"></span><span class=cB3>DOCT_TEXT</a></span><span class=cB0>)
<a name="l289"></a>    tmp_u32_attr^=0xFF00;
<a name="l290"></a>  doc_e-&gt;settings.final_u32_attr=tmp_u32_attr;
<a name="l291"></a>  </span><span class=cB1>return</span><span class=cB0> tmp_u32_attr;
<a name="l292"></a>}
<a name="l293"></a>
<a name="l294"></a></span><span class=cB1>public</span><span class=cB0> </span><span class=cB1>Bool</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocRecalc.html#l294"></span><span class=cB5>DocRecalc</a></span><span class=cB0>(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1468"></span><span class=cB9>CDoc</a></span><span class=cB0> *doc,</span><span class=cB9>I64</span><span class=cB0> recalc_flags=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1459"></span><span class=cB3>RECALCt_NORMAL</a></span><span class=cB0>)
<a name="l295"></a>{</span><span class=cB2>//Recalc and fmt.  Also used by WinMgr to draw on scrn.</span><span class=cB0>
<a name="l296"></a>  </span><span class=cB9>I64</span><span class=cB0> i,ii,j,k,x,x0,y,y0,<a href="http://tinkeros.github.io/WbGit/Kernel/KDbg.html#l192"></span><span class=cB5>D</a></span><span class=cB0>,d2,col,col2,best_col=0,best_d=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l39"></span><span class=cB3>I64_MAX</a></span><span class=cB0>,xx,yy,zz,
<a name="l297"></a>                                       num_entries=0,i_jif,cur_u8_attr,tmp_u32_attr,
<a name="l298"></a>                                       cursor_y=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l38"></span><span class=cB3>I64_MIN</a></span><span class=cB0>,left_margin,right_margin,y_plot_top,y_plot_bottom,
<a name="l299"></a>                                       top,left,bottom,right,width,height,scroll_x,scroll_y,pix_top,pix_left;
<a name="l300"></a>  <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1292"></span><span class=cB9>CDocEntry</a></span><span class=cB0> </span><span class=cB1>reg</span><span class=cB0> *doc_e,</span><span class=cB1>reg</span><span class=cB0> *doc_e2,*best_doc_e,*next_clear_found=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l21"></span><span class=cB3>NULL</a></span><span class=cB0>,
<a name="l301"></a>                                                *added_cursor=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l21"></span><span class=cB3>NULL</a></span><span class=cB0>;
<a name="l302"></a>  <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1219"></span><span class=cB9>CDocBin</a></span><span class=cB0> *tmpb;
<a name="l303"></a>  <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1258"></span><span class=cB9>CDocSettings</a></span><span class=cB0> *s;
<a name="l304"></a>  </span><span class=cB1>Bool</span><span class=cB0> del_doc_e,skipped_update,tree_collapsed,same_win,more=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l23"></span><span class=cB3>FALSE</a></span><span class=cB0>,
<a name="l305"></a>                                                        find_cursor=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l23"></span><span class=cB3>FALSE</a></span><span class=cB0>,blink_flag,full_refresh=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l22"></span><span class=cB3>TRUE</a></span><span class=cB0>,unlock,clear_holds;
<a name="l306"></a>  <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l4011"></span><span class=cB9>CTask</a></span><span class=cB0> *win_task,*mem_task;
<a name="l307"></a>  </span><span class=cB9>CDC</span><span class=cB0> *dc;
<a name="l308"></a>  </span><span class=cB1>U8</span><span class=cB0> *bptr,*ptr,buf[<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l43"></span><span class=cB3>STR_LEN</a></span><span class=cB0>],ch;
<a name="l309"></a>  </span><span class=cB9>U32</span><span class=cB0> *u32_ptr,*hl;
<a name="l310"></a>  </span><span class=cB9>I32</span><span class=cB0> *depth_buf=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l21"></span><span class=cB3>NULL</a></span><span class=cB0>;
<a name="l311"></a>  </span><span class=cB1>F64</span><span class=cB0> cur_time=<a href="http://tinkeros.github.io/WbGit/Kernel/KMisc.html#l110"></span><span class=cB5>tS</a></span><span class=cB0>;
<a name="l312"></a>  <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l3791"></span><span class=cB9>CWinScroll</a></span><span class=cB0> *vss,*hss;
<a name="l313"></a>  <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l929"></span><span class=cB9>CHashDefineStr</a></span><span class=cB0> *tmph;
<a name="l314"></a>  </span><span class=cB1>if</span><span class=cB0> (!doc || doc-&gt;doc_signature!=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1457"></span><span class=cB3>DOC_SIGNATURE_VAL</a></span><span class=cB0>) </span><span class=cB1>return</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l23"></span><span class=cB3>FALSE</a></span><span class=cB0>;
<a name="l315"></a>  </span><span class=cB2>//WinMgr updates all wins (30000.0/1001), 33.33333mS</span><span class=cB0>
<a name="l316"></a>  </span><span class=cB1>if</span><span class=cB0> (recalc_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1462"></span><span class=cB3>RECALCG_MASK</a></span><span class=cB0>==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1461"></span><span class=cB3>RECALCt_TO_SCRN</a></span><span class=cB0> &amp;&amp; doc-&gt;owning_task!=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l293"></span><span class=cB5>Fs</a></span><span class=cB0>)
<a name="l317"></a>  </span><span class=cB7>{</span><span class=cB0>
<a name="l318"></a>    i_jif=<a href="http://tinkeros.github.io/WbGit/Kernel/KGlbls.html#l30"></span><span class=cB6>cnts</a></span><span class=cB0>.jiffies+<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l670"></span><span class=cB3>JIFFY_FREQ</a></span><span class=cB0>/250; </span><span class=cB2>//4 ms</span><span class=cB0>
<a name="l319"></a>    </span><span class=cB1>while</span><span class=cB0> (<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l14"></span><span class=cB5>Bt</a></span><span class=cB7>(</span><span class=cB0>&amp;doc-&gt;locked_flags,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1446"></span><span class=cB3>DOClf_LOCKED</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l320"></a>    {
<a name="l321"></a>      </span><span class=cB1>if</span><span class=cB0> (<a href="http://tinkeros.github.io/WbGit/Kernel/KGlbls.html#l30"></span><span class=cB6>cnts</a></span><span class=cB0>.jiffies&gt;=i_jif)
<a name="l322"></a>        </span><span class=cB1>return</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l23"></span><span class=cB3>FALSE</a></span><span class=cB0>; </span><span class=cB2>//Bail-out if doc locked.</span><span class=cB0>
<a name="l323"></a>      <a href="http://tinkeros.github.io/WbGit/Kernel/Sched.html#l288"></span><span class=cB5>Yield</a></span><span class=cB0>;
<a name="l324"></a>    }
<a name="l325"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l326"></a>  unlock=<a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocNew.html#l3"></span><span class=cB5>DocLock</a></span><span class=cB0>(doc);
<a name="l327"></a>  </span><span class=cB1>if</span><span class=cB0> (doc-&gt;doc_signature!=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1457"></span><span class=cB3>DOC_SIGNATURE_VAL</a></span><span class=cB0>)
<a name="l328"></a>  </span><span class=cB7>{</span><span class=cB0>
<a name="l329"></a>    <a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocNew.html#l18"></span><span class=cB5>DocUnlock</a></span><span class=cB0>(doc);
<a name="l330"></a>    </span><span class=cB1>return</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l23"></span><span class=cB3>FALSE</a></span><span class=cB0>;
<a name="l331"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l332"></a>  win_task=doc-&gt;win_task;
<a name="l333"></a>  mem_task=doc-&gt;mem_task;
<a name="l334"></a>  blink_flag=<a href="http://tinkeros.github.io/WbGit/Kernel/KMisc.html#l115"></span><span class=cB5>Blink</a></span><span class=cB0>;
<a name="l335"></a>  dc=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l21"></span><span class=cB3>NULL</a></span><span class=cB0>;
<a name="l336"></a>  </span><span class=cB1>switch</span><span class=cB0> [recalc_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1462"></span><span class=cB3>RECALCG_MASK</a></span><span class=cB0>]
<a name="l337"></a>  </span><span class=cB7>{</span><span class=cB0>
<a name="l338"></a>  </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1460"></span><span class=cB3>RECALCt_FIND_CURSOR</a></span><span class=cB0>:
<a name="l339"></a>    find_cursor=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l22"></span><span class=cB3>TRUE</a></span><span class=cB0>;
<a name="l340"></a>    </span><span class=cB1>if</span><span class=cB0> (win_task)
<a name="l341"></a>      dc=<a href="http://tinkeros.github.io/WbGit/Adam/Gr/GrDC.html#l183"></span><span class=cB5>DCAlias</a></span><span class=cB0>(<a href="http://tinkeros.github.io/WbGit/Kernel/KGlbls.html#l15"></span><span class=cB6>gr</a></span><span class=cB0>.dc2,win_task); </span><span class=cB2>//Necessary for sprites</span><span class=cB0>
<a name="l342"></a>    </span><span class=cB1>break</span><span class=cB0>;
<a name="l343"></a>  </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1461"></span><span class=cB3>RECALCt_TO_SCRN</a></span><span class=cB0>:
<a name="l344"></a>    </span><span class=cB1>if</span><span class=cB0> (doc-&gt;updates_cnt++%</span><span class=cB7>(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l124"></span><span class=cB5>ToI64</a></span><span class=cB0>(<a href="http://tinkeros.github.io/WbGit/Kernel/KGlbls.html#l16"></span><span class=cB6>winmgr</a></span><span class=cB0>.fps/10)+1</span><span class=cB7>)</span><span class=cB0> &amp;&amp;
<a name="l345"></a>        !<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l14"></span><span class=cB5>Bt</a></span><span class=cB7>(</span><span class=cB0>&amp;doc-&gt;flags,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1428"></span><span class=cB3>DOCf_DO_FULL_REFRESH</a></span><span class=cB7>)</span><span class=cB0> &amp;&amp;
<a name="l346"></a>        !</span><span class=cB7>(</span><span class=cB0>doc-&gt;flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1388"></span><span class=cB3>DOCF_BWD_MOVEMENT</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l347"></a>      full_refresh=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l23"></span><span class=cB3>FALSE</a></span><span class=cB0>;
<a name="l348"></a>    </span><span class=cB1>if</span><span class=cB0> (win_task)
<a name="l349"></a>      dc=<a href="http://tinkeros.github.io/WbGit/Adam/Gr/GrDC.html#l183"></span><span class=cB5>DCAlias</a></span><span class=cB0>(<a href="http://tinkeros.github.io/WbGit/Kernel/KGlbls.html#l15"></span><span class=cB6>gr</a></span><span class=cB0>.dc2,win_task);
<a name="l350"></a>    </span><span class=cB1>break</span><span class=cB0>;
<a name="l351"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l352"></a>  </span><span class=cB1>PUSHFD</span><span class=cB0>
<a name="l353"></a>  </span><span class=cB1>CLI</span><span class=cB0>
<a name="l354"></a>  left  =win_task-&gt;win_left;
<a name="l355"></a>  right =win_task-&gt;win_right;
<a name="l356"></a>  width =win_task-&gt;win_width;
<a name="l357"></a>  scroll_x=win_task-&gt;scroll_x;
<a name="l358"></a>  scroll_y=win_task-&gt;scroll_y;
<a name="l359"></a>  top   =win_task-&gt;win_top;
<a name="l360"></a>  bottom=win_task-&gt;win_bottom;
<a name="l361"></a>  height=win_task-&gt;win_height;
<a name="l362"></a>  pix_left  =win_task-&gt;pix_left;
<a name="l363"></a>  pix_top   =win_task-&gt;pix_top;
<a name="l364"></a>  left_margin=left;
<a name="l365"></a>  right_margin=right;
<a name="l366"></a>  </span><span class=cB1>POPFD</span><span class=cB0>
<a name="l367"></a>  </span><span class=cB1>if</span><span class=cB0> (doc-&gt;flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1378"></span><span class=cB3>DOCF_BORDER_DOC</a></span><span class=cB0>)
<a name="l368"></a>  </span><span class=cB7>{</span><span class=cB0>
<a name="l369"></a>    scroll_x=0;
<a name="l370"></a>    scroll_y=0;
<a name="l371"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l372"></a>  best_doc_e=doc-&gt;cur_entry;
<a name="l373"></a>  </span><span class=cB1>if</span><span class=cB0> (!</span><span class=cB7>(</span><span class=cB0>doc-&gt;flags&amp;(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1370"></span><span class=cB3>DOCF_PLAIN_TEXT</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1371"></span><span class=cB3>DOCF_PLAIN_TEXT_TABS</a></span><span class=cB0>)</span><span class=cB7>)</span><span class=cB0> &amp;&amp;
<a name="l374"></a>      <a href="http://tinkeros.github.io/WbGit/Kernel/BlkDev/DskStrA.html#l42"></span><span class=cB5>FilesFindMatch</a></span><span class=cB7>(</span><span class=cB0>doc-&gt;filename.name,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l2652"></span><span class=cB3>FILEMASK_SRC</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l375"></a>    doc-&gt;flags|=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1394"></span><span class=cB3>DOCF_HIGHLIGHT</a></span><span class=cB0>;
<a name="l376"></a>  </span><span class=cB1>else</span><span class=cB0>
<a name="l377"></a>    doc-&gt;flags&amp;=~<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1394"></span><span class=cB3>DOCF_HIGHLIGHT</a></span><span class=cB0>;
<a name="l378"></a>  x=y=0;
<a name="l379"></a>  doc-&gt;page_line_num=0;
<a name="l380"></a>  </span><span class=cB1>if</span><span class=cB0> (full_refresh &amp;&amp; !find_cursor)
<a name="l381"></a>  </span><span class=cB7>{</span><span class=cB0>
<a name="l382"></a>    doc-&gt;x=x;
<a name="l383"></a>    doc-&gt;y=y;
<a name="l384"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l385"></a>  hss=&amp;win_task-&gt;horz_scroll;
<a name="l386"></a>  vss=&amp;win_task-&gt;vert_scroll;
<a name="l387"></a>  </span><span class=cB1>if</span><span class=cB0> (doc-&gt;flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1378"></span><span class=cB3>DOCF_BORDER_DOC</a></span><span class=cB0>)
<a name="l388"></a>  </span><span class=cB7>{</span><span class=cB0>
<a name="l389"></a>    doc-&gt;top_line_num=0;
<a name="l390"></a>    doc-&gt;line_start_col=0;
<a name="l391"></a>    recalc_flags&amp;=~<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1464"></span><span class=cB3>RECALCF_HAS_CURSOR</a></span><span class=cB0>;
<a name="l392"></a>    </span><span class=cB1>if</span><span class=cB0> (recalc_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1462"></span><span class=cB3>RECALCG_MASK</a></span><span class=cB0>==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1461"></span><span class=cB3>RECALCt_TO_SCRN</a></span><span class=cB0>)
<a name="l393"></a>      doc-&gt;settings_head.cur_text_attr=
<a name="l394"></a>      doc-&gt;settings_head.dft_text_attr=win_task-&gt;border_attr;
<a name="l395"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l396"></a>  </span><span class=cB1>else</span><span class=cB0>
<a name="l397"></a>  </span><span class=cB7>{</span><span class=cB0>
<a name="l398"></a>    </span><span class=cB1>if</span><span class=cB0> (recalc_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1464"></span><span class=cB3>RECALCF_HAS_CURSOR</a></span><span class=cB0> &amp;&amp; full_refresh)
<a name="l399"></a>    {
<a name="l400"></a>      </span><span class=cB1>if</span><span class=cB0> (<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l14"></span><span class=cB5>Bt</a></span><span class=cB7>(</span><span class=cB0>&amp;hss-&gt;flags,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l3789"></span><span class=cB3>WSSf_SET_TO_POS</a></span><span class=cB7>)</span><span class=cB0>||<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l14"></span><span class=cB5>Bt</a></span><span class=cB7>(</span><span class=cB0>&amp;vss-&gt;flags,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l3789"></span><span class=cB3>WSSf_SET_TO_POS</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l401"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l402"></a>        </span><span class=cB1>if</span><span class=cB0> (!</span><span class=cB7>(</span><span class=cB0>doc-&gt;flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1383"></span><span class=cB3>DOCF_NO_SCROLL_BARS</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l403"></a>        {
<a name="l404"></a>          </span><span class=cB1>if</span><span class=cB0> (<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l14"></span><span class=cB5>Bt</a></span><span class=cB7>(</span><span class=cB0>&amp;hss-&gt;flags,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l3789"></span><span class=cB3>WSSf_SET_TO_POS</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l405"></a>          </span><span class=cB7>{</span><span class=cB0>
<a name="l406"></a>            doc-&gt;line_start_col=hss-&gt;pos;
<a name="l407"></a>            <a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l24"></span><span class=cB5>LBtr</a></span><span class=cB0>(&amp;hss-&gt;flags,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l3789"></span><span class=cB3>WSSf_SET_TO_POS</a></span><span class=cB0>);
<a name="l408"></a>          </span><span class=cB7>}</span><span class=cB0>
<a name="l409"></a>          </span><span class=cB1>if</span><span class=cB0> (<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l14"></span><span class=cB5>Bt</a></span><span class=cB7>(</span><span class=cB0>&amp;vss-&gt;flags,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l3789"></span><span class=cB3>WSSf_SET_TO_POS</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l410"></a>          </span><span class=cB7>{</span><span class=cB0>
<a name="l411"></a>            doc-&gt;top_line_num=vss-&gt;pos;
<a name="l412"></a>            <a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l24"></span><span class=cB5>LBtr</a></span><span class=cB0>(&amp;vss-&gt;flags,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l3789"></span><span class=cB3>WSSf_SET_TO_POS</a></span><span class=cB0>);
<a name="l413"></a>          </span><span class=cB7>}</span><span class=cB0>
<a name="l414"></a>        }
<a name="l415"></a>        doc-&gt;x=doc-&gt;line_start_col+width/2;
<a name="l416"></a>        doc-&gt;y=doc-&gt;top_line_num+height/2;
<a name="l417"></a>        find_cursor=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l22"></span><span class=cB3>TRUE</a></span><span class=cB0>;
<a name="l418"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l419"></a>    }
<a name="l420"></a>    </span><span class=cB1>if</span><span class=cB0> (recalc_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1462"></span><span class=cB3>RECALCG_MASK</a></span><span class=cB0>==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1461"></span><span class=cB3>RECALCt_TO_SCRN</a></span><span class=cB0>)
<a name="l421"></a>      doc-&gt;settings_head.cur_text_attr=
<a name="l422"></a>      doc-&gt;settings_head.dft_text_attr=win_task-&gt;text_attr;
<a name="l423"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l424"></a>  x0=doc-&gt;line_start_col;
<a name="l425"></a>  y0=doc-&gt;top_line_num;
<a name="l426"></a>  same_win=top   ==doc-&gt;old_win_top &amp;&amp;
<a name="l427"></a>           bottom==doc-&gt;old_win_bottom &amp;&amp;
<a name="l428"></a>           left  ==doc-&gt;old_win_left &amp;&amp;
<a name="l429"></a>           right ==doc-&gt;old_win_right &amp;&amp;
<a name="l430"></a>           doc-&gt;cur_entry==doc-&gt;old_cur_entry &amp;&amp;
<a name="l431"></a>           doc-&gt;cur_col==doc-&gt;old_cur_col;
<a name="l432"></a>  </span><span class=cB1>if</span><span class=cB0> (recalc_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1462"></span><span class=cB3>RECALCG_MASK</a></span><span class=cB0>==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1461"></span><span class=cB3>RECALCt_TO_SCRN</a></span><span class=cB0>)
<a name="l433"></a>  </span><span class=cB7>{</span><span class=cB0>
<a name="l434"></a>    y_plot_top=y0-scroll_y/<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l4306"></span><span class=cB3>FONT_HEIGHT</a></span><span class=cB0>;
<a name="l435"></a>    y_plot_bottom=y0+height-1-scroll_y/<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l4306"></span><span class=cB3>FONT_HEIGHT</a></span><span class=cB0>;
<a name="l436"></a>    </span><span class=cB1>if</span><span class=cB0> (!</span><span class=cB7>(</span><span class=cB0>doc-&gt;flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1378"></span><span class=cB3>DOCF_BORDER_DOC</a></span><span class=cB7>)</span><span class=cB0> &amp;&amp;
<a name="l437"></a>        !<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l14"></span><span class=cB5>Bt</a></span><span class=cB7>(</span><span class=cB0>&amp;win_task-&gt;display_flags,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l3990"></span><span class=cB3>DISPLAYf_NO_BORDER</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l438"></a>      <a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocRecalcLib.html#l49"></span><span class=cB5>DocBorderLstDraw</a></span><span class=cB0>(doc);
<a name="l439"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l440"></a>  </span><span class=cB1>if</span><span class=cB0> (doc-&gt;cur_col&lt;=doc-&gt;cur_entry-&gt;min_col)
<a name="l441"></a>    doc-&gt;cur_col=doc-&gt;cur_entry-&gt;min_col;
<a name="l442"></a>  doc_e=doc-&gt;head.next;
<a name="l443"></a>  doc_e-&gt;de_flags&amp;=~(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1056"></span><span class=cB3>DOCG_BL_IV_UL</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1145"></span><span class=cB3>DOCEF_WORD_WRAP</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1144"></span><span class=cB3>DOCEF_HIGHLIGHT</a></span><span class=cB0>);
<a name="l444"></a>  </span><span class=cB1>if</span><span class=cB0> (doc_e==doc-&gt;head.next)
<a name="l445"></a>    s=&amp;doc-&gt;settings_head;
<a name="l446"></a>  </span><span class=cB1>else</span><span class=cB0>
<a name="l447"></a>    s=&amp;doc_e-&gt;last-&gt;settings;
<a name="l448"></a>  doc-&gt;flags=doc_e-&gt;de_flags&amp; (<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1056"></span><span class=cB3>DOCG_BL_IV_UL</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1145"></span><span class=cB3>DOCEF_WORD_WRAP</a></span><span class=cB0>) |
<a name="l449"></a>             doc-&gt;flags&amp;~(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1056"></span><span class=cB3>DOCG_BL_IV_UL</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1145"></span><span class=cB3>DOCEF_WORD_WRAP</a></span><span class=cB0>);
<a name="l450"></a>  cur_u8_attr=s-&gt;cur_text_attr;
<a name="l451"></a>  </span><span class=cB1>if</span><span class=cB0> (doc_e==doc-&gt;head.next)
<a name="l452"></a>  </span><span class=cB7>{</span><span class=cB0>
<a name="l453"></a>    doc-&gt;flags&amp;=~<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1388"></span><span class=cB3>DOCF_BWD_MOVEMENT</a></span><span class=cB0>;
<a name="l454"></a>    </span><span class=cB1>if</span><span class=cB0> (recalc_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1462"></span><span class=cB3>RECALCG_MASK</a></span><span class=cB0>==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1461"></span><span class=cB3>RECALCt_TO_SCRN</a></span><span class=cB0> &amp;&amp; full_refresh)
<a name="l455"></a>      doc-&gt;flags&amp;=~<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1386"></span><span class=cB3>DOCF_HAS_SONG</a></span><span class=cB0>;
<a name="l456"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l457"></a>  </span><span class=cB1>else</span><span class=cB0>
<a name="l458"></a>    doc-&gt;flags=doc_e-&gt;de_flags&amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1144"></span><span class=cB3>DOCEF_HIGHLIGHT</a></span><span class=cB0> |
<a name="l459"></a>               doc-&gt;flags&amp;~<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1144"></span><span class=cB3>DOCEF_HIGHLIGHT</a></span><span class=cB0>;
<a name="l460"></a>  </span><span class=cB1>if</span><span class=cB0> (doc-&gt;head.next==doc)
<a name="l461"></a>  </span><span class=cB7>{</span><span class=cB0>
<a name="l462"></a>    best_doc_e=doc;
<a name="l463"></a>    best_col=0;
<a name="l464"></a>    doc-&gt;cur_entry=doc;
<a name="l465"></a>    doc-&gt;cur_col=0;
<a name="l466"></a>    doc_e=doc;
<a name="l467"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l468"></a>  skipped_update= doc_e==doc &amp;&amp; doc-&gt;head.next!=doc;
<a name="l469"></a>  </span><span class=cB1>if</span><span class=cB0> (full_refresh)
<a name="l470"></a>  </span><span class=cB7>{</span><span class=cB0>
<a name="l471"></a>    doc-&gt;min_x=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l35"></span><span class=cB3>I32_MAX</a></span><span class=cB0>;
<a name="l472"></a>    doc-&gt;min_y=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l35"></span><span class=cB3>I32_MAX</a></span><span class=cB0>;
<a name="l473"></a>    doc-&gt;max_x=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l34"></span><span class=cB3>I32_MIN</a></span><span class=cB0>;
<a name="l474"></a>    doc-&gt;max_y=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l34"></span><span class=cB3>I32_MIN</a></span><span class=cB0>;
<a name="l475"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l476"></a>  </span><span class=cB1>while</span><span class=cB0> (doc_e!=doc)
<a name="l477"></a>  </span><span class=cB7>{</span><span class=cB0>
<a name="l478"></a>    </span><span class=cB1>while</span><span class=cB0> (<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l22"></span><span class=cB3>TRUE</a></span><span class=cB0>)
<a name="l479"></a>    {
<a name="l480"></a>      del_doc_e=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l23"></span><span class=cB3>FALSE</a></span><span class=cB0>;
<a name="l481"></a>      </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; </span><span class=cB7>(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1123"></span><span class=cB3>DOCEF_SKIP</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1126"></span><span class=cB3>DOCEF_FILTER_SKIP</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l482"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l483"></a>        doc_e2=doc_e;
<a name="l484"></a>        </span><span class=cB1>goto</span><span class=cB0> rc_skip;
<a name="l485"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l486"></a>      <a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l174"></span><span class=cB5>MemCpy64</a></span><span class=cB0>(&amp;doc_e-&gt;settings,s,</span><span class=cB1>sizeof</span><span class=cB7>(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1258"></span><span class=cB9>CDocSettings</a></span><span class=cB7>)</span><span class=cB0>/8);
<a name="l487"></a>      s=&amp;doc_e-&gt;settings;
<a name="l488"></a>      </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; </span><span class=cB7>(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1099"></span><span class=cB3>DOCEF_TAG_CB</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1073"></span><span class=cB3>DOCEF_DEFINE</a></span><span class=cB7>)</span><span class=cB0> &amp;&amp;
<a name="l489"></a>          !</span><span class=cB7>(</span><span class=cB0>doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1122"></span><span class=cB3>DOCEF_LST</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l490"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l491"></a>        <a href="http://tinkeros.github.io/WbGit/Kernel/Mem/MAllocFree.html#l415"></span><span class=cB5>Free</a></span><span class=cB0>(doc_e-&gt;tag);
<a name="l492"></a>        </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1099"></span><span class=cB3>DOCEF_TAG_CB</a></span><span class=cB0>)
<a name="l493"></a>        {
<a name="l494"></a>          </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;tag_cb)
<a name="l495"></a>            doc_e-&gt;tag=(*doc_e-&gt;tag_cb)(doc,doc_e,mem_task);
<a name="l496"></a>          </span><span class=cB1>else</span><span class=cB0>
<a name="l497"></a>            doc_e-&gt;tag=<a href="http://tinkeros.github.io/WbGit/Kernel/Mem/MAllocFree.html#l478"></span><span class=cB5>StrNew</a></span><span class=cB0>(</span><span class=cB6>&quot;&quot;</span><span class=cB0>,mem_task);
<a name="l498"></a>        }
<a name="l499"></a>        </span><span class=cB1>else</span><span class=cB0>
<a name="l500"></a>        {
<a name="l501"></a>          </span><span class=cB1>if</span><span class=cB0> (tmph=<a href="http://tinkeros.github.io/WbGit/Kernel/KHashA.html#l255"></span><span class=cB5>HashFind</a></span><span class=cB7>(</span><span class=cB0>doc_e-&gt;define_str,
<a name="l502"></a>                            win_task-&gt;hash_table,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l789"></span><span class=cB3>HTT_DEFINE_STR</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l503"></a>            doc_e-&gt;tag=<a href="http://tinkeros.github.io/WbGit/Kernel/Mem/MAllocFree.html#l478"></span><span class=cB5>StrNew</a></span><span class=cB0>(tmph-&gt;data,mem_task);
<a name="l504"></a>          </span><span class=cB1>else</span><span class=cB0>
<a name="l505"></a>            doc_e-&gt;tag=<a href="http://tinkeros.github.io/WbGit/Kernel/Mem/MAllocFree.html#l427"></span><span class=cB5>CAlloc</a></span><span class=cB0>(1,mem_task);
<a name="l506"></a>        }
<a name="l507"></a>        doc_e-&gt;max_col=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l61"></span><span class=cB5>StrLen</a></span><span class=cB0>(doc_e-&gt;tag);
<a name="l508"></a>        </span><span class=cB1>if</span><span class=cB0> (doc-&gt;cur_entry==doc_e &amp;&amp; doc-&gt;cur_col&gt;=doc_e-&gt;max_col)
<a name="l509"></a>        {
<a name="l510"></a>          </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;max_col)
<a name="l511"></a>            doc-&gt;cur_col=doc_e-&gt;max_col-1;
<a name="l512"></a>          </span><span class=cB1>else</span><span class=cB0>
<a name="l513"></a>            doc-&gt;cur_col=0;
<a name="l514"></a>        }
<a name="l515"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l516"></a>      k=<a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocRecalc.html#l3"></span><span class=cB5>DocWordWrapDel</a></span><span class=cB0>(doc,doc_e,full_refresh,same_win,
<a name="l517"></a>                       left_margin,right_margin,&amp;best_doc_e,&amp;best_col);
<a name="l518"></a>      </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; </span><span class=cB7>(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1092"></span><span class=cB3>DOCEF_LEFT_X</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1094"></span><span class=cB3>DOCEF_RIGHT_X</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1093"></span><span class=cB3>DOCEF_CENTER_X</a></span><span class=cB0>|
<a name="l519"></a>                             <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1095"></span><span class=cB3>DOCEF_TOP_Y</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1097"></span><span class=cB3>DOCEF_BOTTOM_Y</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1096"></span><span class=cB3>DOCEF_CENTER_Y</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l520"></a>        <a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocRecalc.html#l64"></span><span class=cB5>DocRecalcXY</a></span><span class=cB0>(doc,doc_e,k,
<a name="l521"></a>                    left,width,height,left_margin,right_margin,x0,y0,&amp;x,&amp;y);
<a name="l522"></a>      </span><span class=cB1>if</span><span class=cB0> (full_refresh &amp;&amp; k&gt;0 &amp;&amp; doc-&gt;flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1395"></span><span class=cB3>DOCF_WORD_WRAP</a></span><span class=cB0> &amp;&amp;
<a name="l523"></a>          </span><span class=cB7>(</span><span class=cB0>doc_e2=<a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocRecalc.html#l187"></span><span class=cB5>DocWordWrapAdd</a></span><span class=cB0>(doc,doc_e,&amp;k,left,right_margin,x,y)</span><span class=cB7>)</span><span class=cB0>)
<a name="l524"></a>        doc_e=doc_e2;
<a name="l525"></a>      </span><span class=cB1>else</span><span class=cB0>
<a name="l526"></a>        </span><span class=cB1>break</span><span class=cB0>;
<a name="l527"></a>    }
<a name="l528"></a>    </span><span class=cB1>if</span><span class=cB0> (full_refresh)
<a name="l529"></a>    {
<a name="l530"></a>      doc_e-&gt;x=x;
<a name="l531"></a>      doc_e-&gt;y=y;
<a name="l532"></a>      doc_e-&gt;page_line_num=doc-&gt;page_line_num;
<a name="l533"></a>      </span><span class=cB1>if</span><span class=cB0> (x&lt;doc-&gt;min_x) doc-&gt;min_x=x;
<a name="l534"></a>      </span><span class=cB1>if</span><span class=cB0> (y&lt;doc-&gt;min_y) doc-&gt;min_y=y;
<a name="l535"></a>      </span><span class=cB1>if</span><span class=cB0> (find_cursor)
<a name="l536"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l537"></a>        <a href="http://tinkeros.github.io/WbGit/Kernel/KDbg.html#l192"></span><span class=cB5>D</a></span><span class=cB0>=<a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocRecalcLib.html#l3"></span><span class=cB5>DocCharDist</a></span><span class=cB0>(doc,x,y);
<a name="l538"></a>        col=0;
<a name="l539"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l540"></a>    }
<a name="l541"></a>    col2=0;
<a name="l542"></a>    tmp_u32_attr=<a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocRecalc.html#l241"></span><span class=cB5>DocTmpAttr</a></span><span class=cB0>(doc,doc_e,cur_u8_attr);
<a name="l543"></a>    </span><span class=cB1>if</span><span class=cB0> (doc_e==doc-&gt;cur_entry)
<a name="l544"></a>    {
<a name="l545"></a>      cursor_y=doc_e-&gt;y;
<a name="l546"></a>      </span><span class=cB1>if</span><span class=cB0> (recalc_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1465"></span><span class=cB3>RECALCF_ADD_CURSOR</a></span><span class=cB0> &amp;&amp; !added_cursor)
<a name="l547"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l548"></a>        </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;type_u8==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1005"></span><span class=cB3>DOCT_TEXT</a></span><span class=cB0> &amp;&amp; 0&lt;doc-&gt;cur_col&lt;k &amp;&amp;
<a name="l549"></a>            !</span><span class=cB7>(</span><span class=cB0>doc_e-&gt;de_flags &amp; ~(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1070"></span><span class=cB3>DOCEF_TAG</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1056"></span><span class=cB3>DOCG_BL_IV_UL</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1145"></span><span class=cB3>DOCEF_WORD_WRAP</a></span><span class=cB0>|
<a name="l550"></a>                                  <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1144"></span><span class=cB3>DOCEF_HIGHLIGHT</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1123"></span><span class=cB3>DOCEF_SKIP</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1126"></span><span class=cB3>DOCEF_FILTER_SKIP</a></span><span class=cB0>)</span><span class=cB7>)</span><span class=cB0> &amp;&amp;
<a name="l551"></a>            !</span><span class=cB7>(</span><span class=cB0>doc_e-&gt;type&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1056"></span><span class=cB3>DOCG_BL_IV_UL</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l552"></a>        {
<a name="l553"></a>          added_cursor=<a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocRecalc.html#l155"></span><span class=cB5>DocSplitTag</a></span><span class=cB0>(doc,doc_e,doc-&gt;cur_col,x,y,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1010"></span><span class=cB3>DOCT_CURSOR</a></span><span class=cB0>);
<a name="l554"></a>          k=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l61"></span><span class=cB5>StrLen</a></span><span class=cB0>(doc_e-&gt;tag);
<a name="l555"></a>        }
<a name="l556"></a>        </span><span class=cB1>else</span><span class=cB0>
<a name="l557"></a>        {
<a name="l558"></a>          added_cursor=doc_e2=<a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocNew.html#l42"></span><span class=cB5>DocEntryNewBase</a></span><span class=cB0>(doc,
<a name="l559"></a>                                              <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1010"></span><span class=cB3>DOCT_CURSOR</a></span><span class=cB0>|doc_e-&gt;type&amp;0xFFFFFF00,
<a name="l560"></a>                                              doc_e-&gt;de_flags&amp;~<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1136"></span><span class=cB3>DOCEG_HAS_ARG</a></span><span class=cB0>,x,y,doc-&gt;page_line_num);
<a name="l561"></a>          <a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l174"></span><span class=cB5>MemCpy64</a></span><span class=cB0>(&amp;doc_e2-&gt;settings,&amp;doc_e-&gt;settings,</span><span class=cB1>sizeof</span><span class=cB7>(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1258"></span><span class=cB9>CDocSettings</a></span><span class=cB7>)</span><span class=cB0>/8);
<a name="l562"></a>          </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;type_u8==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1005"></span><span class=cB3>DOCT_TEXT</a></span><span class=cB0> &amp;&amp; doc-&gt;cur_col&gt;=k)
<a name="l563"></a>            <a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l68"></span><span class=cB5>QueIns</a></span><span class=cB0>(doc_e2,doc_e);
<a name="l564"></a>          </span><span class=cB1>else</span><span class=cB0>
<a name="l565"></a>            <a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l70"></span><span class=cB5>QueInsRev</a></span><span class=cB0>(doc_e2,doc_e);
<a name="l566"></a>        }
<a name="l567"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l568"></a>    }
<a name="l569"></a>    </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1112"></span><span class=cB3>DOCEF_REFRESH_DATA</a></span><span class=cB0> &amp;&amp;
<a name="l570"></a>        </span><span class=cB7>(</span><span class=cB0>doc_e-&gt;type_u8==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1035"></span><span class=cB3>DOCT_DATA</a></span><span class=cB0> || doc_e-&gt;type_u8==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1036"></span><span class=cB3>DOCT_CHECK_BOX</a></span><span class=cB0> ||
<a name="l571"></a>         doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1122"></span><span class=cB3>DOCEF_LST</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l572"></a>    {
<a name="l573"></a>      <a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocForm.html#l71"></span><span class=cB5>DocDataFmt</a></span><span class=cB0>(doc,doc_e);
<a name="l574"></a>      k=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l61"></span><span class=cB5>StrLen</a></span><span class=cB0>(doc_e-&gt;tag);
<a name="l575"></a>    }
<a name="l576"></a>    </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1070"></span><span class=cB3>DOCEF_TAG</a></span><span class=cB0>)
<a name="l577"></a>    {
<a name="l578"></a>      ptr=doc_e-&gt;tag;
<a name="l579"></a>      </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1121"></span><span class=cB3>DOCEF_TREE</a></span><span class=cB0>)
<a name="l580"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l581"></a>        </span><span class=cB1>if</span><span class=cB0> (k&gt;=2)
<a name="l582"></a>        {
<a name="l583"></a>          </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1110"></span><span class=cB3>DOCEF_CHECKED_COLLAPSED</a></span><span class=cB0>)
<a name="l584"></a>            *ptr++=</span><span class=cB6>'+'</span><span class=cB0>;
<a name="l585"></a>          </span><span class=cB1>else</span><span class=cB0>
<a name="l586"></a>            *ptr++=</span><span class=cB6>'-'</span><span class=cB0>;
<a name="l587"></a>          *ptr++=</span><span class=cB6>']'</span><span class=cB0>;
<a name="l588"></a>          ptr=doc_e-&gt;tag;
<a name="l589"></a>        }
<a name="l590"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l591"></a>      </span><span class=cB1>else</span><span class=cB0> </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1079"></span><span class=cB3>DOCEF_HAS_BIN</a></span><span class=cB0>)
<a name="l592"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l593"></a>        </span><span class=cB1>if</span><span class=cB0> (*ptr==</span><span class=cB6>'&lt;'</span><span class=cB0> &amp;&amp; full_refresh &amp;&amp; </span><span class=cB6>'0'</span><span class=cB0>&lt;=ptr[1]&lt;=</span><span class=cB6>'9'</span><span class=cB0>)
<a name="l594"></a>        {
<a name="l595"></a>          ptr=<a href="http://tinkeros.github.io/WbGit/Kernel/StrPrint.html#l1065"></span><span class=cB5>MStrPrint</a></span><span class=cB0>(</span><span class=cB6>&quot;&lt;%d&gt;&quot;</span><span class=cB0>,doc_e-&gt;bin_num);
<a name="l596"></a>          <a href="http://tinkeros.github.io/WbGit/Kernel/Mem/MAllocFree.html#l415"></span><span class=cB5>Free</a></span><span class=cB0>(doc_e-&gt;tag);
<a name="l597"></a>          doc_e-&gt;tag=<a href="http://tinkeros.github.io/WbGit/Kernel/Mem/MAllocFree.html#l478"></span><span class=cB5>StrNew</a></span><span class=cB0>(ptr,mem_task);
<a name="l598"></a>          <a href="http://tinkeros.github.io/WbGit/Kernel/Mem/MAllocFree.html#l415"></span><span class=cB5>Free</a></span><span class=cB0>(ptr);
<a name="l599"></a>          ptr=doc_e-&gt;tag;
<a name="l600"></a>          k=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l61"></span><span class=cB5>StrLen</a></span><span class=cB0>(ptr);
<a name="l601"></a>        }
<a name="l602"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l603"></a>      </span><span class=cB1>else</span><span class=cB0> </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;type_u8==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1036"></span><span class=cB3>DOCT_CHECK_BOX</a></span><span class=cB0>)
<a name="l604"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l605"></a>        </span><span class=cB1>if</span><span class=cB0> (k&gt;=3)
<a name="l606"></a>        {
<a name="l607"></a>          *ptr++=</span><span class=cB6>'['</span><span class=cB0>;
<a name="l608"></a>          </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1110"></span><span class=cB3>DOCEF_CHECKED_COLLAPSED</a></span><span class=cB0>)
<a name="l609"></a>            *ptr++=</span><span class=cB6>'X'</span><span class=cB0>;
<a name="l610"></a>          </span><span class=cB1>else</span><span class=cB0>
<a name="l611"></a>            *ptr++=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l4199"></span><span class=cB3>CH_SPACE</a></span><span class=cB0>;
<a name="l612"></a>          *ptr++=</span><span class=cB6>']'</span><span class=cB0>;
<a name="l613"></a>          ptr=doc_e-&gt;tag;
<a name="l614"></a>        }
<a name="l615"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l616"></a>      </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1084"></span><span class=cB3>DOCEF_SCROLLING_X</a></span><span class=cB0>)
<a name="l617"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l618"></a>        j=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l61"></span><span class=cB5>StrLen</a></span><span class=cB0>(doc_e-&gt;tag);
<a name="l619"></a>        </span><span class=cB1>if</span><span class=cB0> (j &amp;&amp; doc_e-&gt;scroll_len)
<a name="l620"></a>        {
<a name="l621"></a>          i_jif=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l124"></span><span class=cB5>ToI64</a></span><span class=cB0>(cur_time*<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l4305"></span><span class=cB3>FONT_WIDTH</a></span><span class=cB0>*<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1231"></span><span class=cB3>DOC_SCROLL_SPEED</a></span><span class=cB0>)%(j*<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l4305"></span><span class=cB3>FONT_WIDTH</a></span><span class=cB0>);
<a name="l622"></a>          </span><span class=cB1>if</span><span class=cB0> (<a href="http://tinkeros.github.io/WbGit/Kernel/KGlbls.html#l10"></span><span class=cB6>scroll_master_flag</a></span><span class=cB0> == 0)
<a name="l623"></a>          </span><span class=cB7>{</span><span class=cB0>
<a name="l624"></a>            i_jif=0;
<a name="l625"></a>          </span><span class=cB7>}</span><span class=cB0>
<a name="l626"></a>          tmp_u32_attr=tmp_u32_attr &amp; 0xFFE0FF00|
<a name="l627"></a>                       (<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l4305"></span><span class=cB3>FONT_WIDTH</a></span><span class=cB0>-1-i_jif&amp;</span><span class=cB7>(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l4305"></span><span class=cB3>FONT_WIDTH</a></span><span class=cB0>-1</span><span class=cB7>)</span><span class=cB0>)&lt;&lt;16;
<a name="l628"></a>#</span><span class=cB1>assert</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l4305"></span><span class=cB3>FONT_WIDTH</a></span><span class=cB0>==8
<a name="l629"></a>          i_jif&gt;&gt;=3;
<a name="l630"></a>          </span><span class=cB1>for</span><span class=cB0> (k=0; k&lt;doc_e-&gt;scroll_len; k++)
<a name="l631"></a>          </span><span class=cB7>{</span><span class=cB0>
<a name="l632"></a>            ch=ptr[(i_jif+k)%j];
<a name="l633"></a>            </span><span class=cB1>if</span><span class=cB0> (!<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l14"></span><span class=cB5>Bt</a></span><span class=cB7>(<a href="http://tinkeros.github.io/WbGit/Kernel/StrA.html#l397"></span><span class=cB6>char_bmp_displayable</a></span><span class=cB0>,ch</span><span class=cB7>)</span><span class=cB0>) ch=</span><span class=cB6>'.'</span><span class=cB0>;
<a name="l634"></a>            </span><span class=cB1>if</span><span class=cB0> (recalc_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1462"></span><span class=cB3>RECALCG_MASK</a></span><span class=cB0>==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1461"></span><span class=cB3>RECALCt_TO_SCRN</a></span><span class=cB0> &amp;&amp;
<a name="l635"></a>                !</span><span class=cB7>(</span><span class=cB0>doc_e-&gt;de_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1128"></span><span class=cB3>DOCEF_DONT_DRAW</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l636"></a>            {
<a name="l637"></a>              </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1109"></span><span class=cB3>DOCEF_BORDER_PLOT</a></span><span class=cB0> &amp;&amp;
<a name="l638"></a>                  !<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l14"></span><span class=cB5>Bt</a></span><span class=cB7>(</span><span class=cB0>&amp;win_task-&gt;display_flags,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l3990"></span><span class=cB3>DISPLAYf_NO_BORDER</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l639"></a>                <a href="http://tinkeros.github.io/WbGit/Kernel/GrTextBase.html#l312"></span><span class=cB5>TextChar</a></span><span class=cB0>(win_task,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l22"></span><span class=cB3>TRUE</a></span><span class=cB0>,x-x0,y-y0,tmp_u32_attr+ch);
<a name="l640"></a>              </span><span class=cB1>else</span><span class=cB0>
<a name="l641"></a>                <a href="http://tinkeros.github.io/WbGit/Kernel/GrTextBase.html#l312"></span><span class=cB5>TextChar</a></span><span class=cB0>(win_task,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l23"></span><span class=cB3>FALSE</a></span><span class=cB0>,x-x0,y-y0,tmp_u32_attr+ch);
<a name="l642"></a>            }
<a name="l643"></a>            x++;
<a name="l644"></a>          </span><span class=cB7>}</span><span class=cB0>
<a name="l645"></a>        }
<a name="l646"></a>        </span><span class=cB1>if</span><span class=cB0> (find_cursor)
<a name="l647"></a>        {
<a name="l648"></a>          <a href="http://tinkeros.github.io/WbGit/Kernel/KDbg.html#l192"></span><span class=cB5>D</a></span><span class=cB0>=<a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocRecalcLib.html#l3"></span><span class=cB5>DocCharDist</a></span><span class=cB0>(doc,doc_e-&gt;x,doc_e-&gt;y);
<a name="l649"></a>          col=doc_e-&gt;min_col;
<a name="l650"></a>        }
<a name="l651"></a>        col2=doc_e-&gt;scroll_len; </span><span class=cB2>//TODO This is flawed</span><span class=cB0>
<a name="l652"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l653"></a>      </span><span class=cB1>else</span><span class=cB0>
<a name="l654"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l655"></a>        </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1109"></span><span class=cB3>DOCEF_BORDER_PLOT</a></span><span class=cB0> &amp;&amp;
<a name="l656"></a>            !<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l14"></span><span class=cB5>Bt</a></span><span class=cB7>(</span><span class=cB0>&amp;win_task-&gt;display_flags,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l3990"></span><span class=cB3>DISPLAYf_NO_BORDER</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l657"></a>        {
<a name="l658"></a>          </span><span class=cB1>while</span><span class=cB0> (ch=*ptr++)
<a name="l659"></a>          </span><span class=cB7>{</span><span class=cB0>
<a name="l660"></a>            </span><span class=cB1>if</span><span class=cB0> (recalc_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1462"></span><span class=cB3>RECALCG_MASK</a></span><span class=cB0>==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1461"></span><span class=cB3>RECALCt_TO_SCRN</a></span><span class=cB0> &amp;&amp;
<a name="l661"></a>                !</span><span class=cB7>(</span><span class=cB0>doc_e-&gt;de_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1128"></span><span class=cB3>DOCEF_DONT_DRAW</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l662"></a>              <a href="http://tinkeros.github.io/WbGit/Kernel/GrTextBase.html#l312"></span><span class=cB5>TextChar</a></span><span class=cB0>(win_task,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l22"></span><span class=cB3>TRUE</a></span><span class=cB0>,x-x0,y-y0,tmp_u32_attr+ch);
<a name="l663"></a>            </span><span class=cB1>else</span><span class=cB0> </span><span class=cB1>if</span><span class=cB0> (find_cursor)
<a name="l664"></a>            {
<a name="l665"></a>              d2=<a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocRecalcLib.html#l3"></span><span class=cB5>DocCharDist</a></span><span class=cB0>(doc,x,y);
<a name="l666"></a>              </span><span class=cB1>if</span><span class=cB0> (d2&lt;<a href="http://tinkeros.github.io/WbGit/Kernel/KDbg.html#l192"></span><span class=cB5>D</a></span><span class=cB0>)
<a name="l667"></a>              </span><span class=cB7>{</span><span class=cB0>
<a name="l668"></a>                <a href="http://tinkeros.github.io/WbGit/Kernel/KDbg.html#l192"></span><span class=cB5>D</a></span><span class=cB0>=d2;
<a name="l669"></a>                col=col2;
<a name="l670"></a>              </span><span class=cB7>}</span><span class=cB0>
<a name="l671"></a>            }
<a name="l672"></a>            col2++;
<a name="l673"></a>            x++;
<a name="l674"></a>          </span><span class=cB7>}</span><span class=cB0>
<a name="l675"></a>        }
<a name="l676"></a>        </span><span class=cB1>else</span><span class=cB0>
<a name="l677"></a>        {
<a name="l678"></a>          </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;type_u8==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1005"></span><span class=cB3>DOCT_TEXT</a></span><span class=cB0> &amp;&amp; doc_e-&gt;de_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1144"></span><span class=cB3>DOCEF_HIGHLIGHT</a></span><span class=cB0>)
<a name="l679"></a>            hl=<a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocHighlight.html#l9"></span><span class=cB5>DocHighlight</a></span><span class=cB0>(doc_e,ptr,k,tmp_u32_attr);
<a name="l680"></a>          </span><span class=cB1>else</span><span class=cB0>
<a name="l681"></a>            hl=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l21"></span><span class=cB3>NULL</a></span><span class=cB0>;
<a name="l682"></a>          </span><span class=cB1>if</span><span class=cB0> (recalc_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1462"></span><span class=cB3>RECALCG_MASK</a></span><span class=cB0>==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1461"></span><span class=cB3>RECALCt_TO_SCRN</a></span><span class=cB0> &amp;&amp;
<a name="l683"></a>              !</span><span class=cB7>(</span><span class=cB0>doc_e-&gt;de_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1128"></span><span class=cB3>DOCEF_DONT_DRAW</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l684"></a>          </span><span class=cB7>{</span><span class=cB0>
<a name="l685"></a></span><span class=cB2>//Technically we should do this for scrolling_x, too.</span><span class=cB0>
<a name="l686"></a>            </span><span class=cB1>if</span><span class=cB0> (y&gt;y_plot_bottom)
<a name="l687"></a>              more=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l22"></span><span class=cB3>TRUE</a></span><span class=cB0>;
<a name="l688"></a>            </span><span class=cB1>else</span><span class=cB0> </span><span class=cB1>if</span><span class=cB0> (y&gt;=y_plot_top)
<a name="l689"></a>            {
<a name="l690"></a>              </span><span class=cB1>if</span><span class=cB0> (hl)
<a name="l691"></a>                <a href="http://tinkeros.github.io/WbGit/Kernel/GrTextBase.html#l316"></span><span class=cB5>TextLenAttrStr</a></span><span class=cB0>(win_task,x-x0,y-y0,k,hl);
<a name="l692"></a>              </span><span class=cB1>else</span><span class=cB0>
<a name="l693"></a>                <a href="http://tinkeros.github.io/WbGit/Kernel/GrTextBase.html#l314"></span><span class=cB5>TextLenStr</a></span><span class=cB0>(win_task,x-x0,y-y0,k,tmp_u32_attr,ptr);
<a name="l694"></a>            }
<a name="l695"></a>            col2+=k;
<a name="l696"></a>            x+=k;
<a name="l697"></a>          </span><span class=cB7>}</span><span class=cB0>
<a name="l698"></a>          </span><span class=cB1>else</span><span class=cB0>
<a name="l699"></a>          </span><span class=cB7>{</span><span class=cB0>
<a name="l700"></a>            </span><span class=cB1>if</span><span class=cB0> (find_cursor)
<a name="l701"></a>            {
<a name="l702"></a>              </span><span class=cB1>while</span><span class=cB0> (k--)
<a name="l703"></a>              </span><span class=cB7>{</span><span class=cB0>
<a name="l704"></a>                d2=<a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocRecalcLib.html#l3"></span><span class=cB5>DocCharDist</a></span><span class=cB0>(doc,x,y);
<a name="l705"></a>                </span><span class=cB1>if</span><span class=cB0> (d2&lt;<a href="http://tinkeros.github.io/WbGit/Kernel/KDbg.html#l192"></span><span class=cB5>D</a></span><span class=cB0>)
<a name="l706"></a>                {
<a name="l707"></a>                  <a href="http://tinkeros.github.io/WbGit/Kernel/KDbg.html#l192"></span><span class=cB5>D</a></span><span class=cB0>=d2;
<a name="l708"></a>                  col=col2;
<a name="l709"></a>                }
<a name="l710"></a>                col2++;
<a name="l711"></a>                x++;
<a name="l712"></a>              </span><span class=cB7>}</span><span class=cB0>
<a name="l713"></a>            }
<a name="l714"></a>            </span><span class=cB1>else</span><span class=cB0>
<a name="l715"></a>            {
<a name="l716"></a>              col2+=k;
<a name="l717"></a>              x+=k;
<a name="l718"></a>            }
<a name="l719"></a>          </span><span class=cB7>}</span><span class=cB0>
<a name="l720"></a>          <a href="http://tinkeros.github.io/WbGit/Kernel/Mem/MAllocFree.html#l415"></span><span class=cB5>Free</a></span><span class=cB0>(hl);
<a name="l721"></a>        }
<a name="l722"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l723"></a>    }
<a name="l724"></a>    </span><span class=cB1>switch</span><span class=cB0> [doc_e-&gt;type_u8]
<a name="l725"></a>    {
<a name="l726"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1005"></span><span class=cB3>DOCT_TEXT</a></span><span class=cB0>:
<a name="l727"></a>      </span><span class=cB1>if</span><span class=cB0> (!col2 &amp;&amp; !</span><span class=cB7>(</span><span class=cB0>doc_e-&gt;de_flags
<a name="l728"></a>                     &amp;(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1121"></span><span class=cB3>DOCEF_TREE</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1122"></span><span class=cB3>DOCEF_LST</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1099"></span><span class=cB3>DOCEF_TAG_CB</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1073"></span><span class=cB3>DOCEF_DEFINE</a></span><span class=cB0>|
<a name="l729"></a>                       <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1072"></span><span class=cB3>DOCEF_AUX_STR</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1074"></span><span class=cB3>DOCEF_HTML_LINK</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1080"></span><span class=cB3>DOCEF_BIN_PTR_LINK</a></span><span class=cB0>)</span><span class=cB7>)</span><span class=cB0>)
<a name="l730"></a>        del_doc_e=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l22"></span><span class=cB3>TRUE</a></span><span class=cB0>;
<a name="l731"></a>      </span><span class=cB1>break</span><span class=cB0>;
<a name="l732"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1040"></span><span class=cB3>DOCT_HEX_ED</a></span><span class=cB0>:
<a name="l733"></a>      </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1116"></span><span class=cB3>DOCEF_DEREF_DATA</a></span><span class=cB0> &amp;&amp;
<a name="l734"></a>          !</span><span class=cB7>(</span><span class=cB0>doc_e-&gt;de_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1117"></span><span class=cB3>DOCEF_REMALLOC_DATA</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l735"></a>        bptr=doc_e-&gt;data;
<a name="l736"></a>      </span><span class=cB1>else</span><span class=cB0>
<a name="l737"></a>        bptr=&amp;doc_e-&gt;data;
<a name="l738"></a>      k=doc_e-&gt;hex_ed_width; </span><span class=cB2>//columns</span><span class=cB0>
<a name="l739"></a>      </span><span class=cB1>for</span><span class=cB0> (i=0; i&lt;doc_e-&gt;len; i+=k)
<a name="l740"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l741"></a>        </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1119"></span><span class=cB3>DOCEF_ZERO_BASED</a></span><span class=cB0>)
<a name="l742"></a>          <a href="http://tinkeros.github.io/WbGit/Kernel/StrPrint.html#l1043"></span><span class=cB5>StrPrint</a></span><span class=cB0>(buf,</span><span class=cB6>&quot;%08tX &quot;</span><span class=cB0>,i);
<a name="l743"></a>        </span><span class=cB1>else</span><span class=cB0>
<a name="l744"></a>          <a href="http://tinkeros.github.io/WbGit/Kernel/StrPrint.html#l1043"></span><span class=cB5>StrPrint</a></span><span class=cB0>(buf,</span><span class=cB6>&quot;%08tX &quot;</span><span class=cB0>,bptr);
<a name="l745"></a>        ptr=buf;
<a name="l746"></a>        </span><span class=cB1>while</span><span class=cB0> (ch=*ptr++)
<a name="l747"></a>        {
<a name="l748"></a>          </span><span class=cB1>if</span><span class=cB0> (recalc_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1462"></span><span class=cB3>RECALCG_MASK</a></span><span class=cB0>==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1461"></span><span class=cB3>RECALCt_TO_SCRN</a></span><span class=cB0> &amp;&amp;
<a name="l749"></a>              !</span><span class=cB7>(</span><span class=cB0>doc_e-&gt;de_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1128"></span><span class=cB3>DOCEF_DONT_DRAW</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l750"></a>          </span><span class=cB7>{</span><span class=cB0>
<a name="l751"></a>            </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1109"></span><span class=cB3>DOCEF_BORDER_PLOT</a></span><span class=cB0> &amp;&amp;
<a name="l752"></a>                !<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l14"></span><span class=cB5>Bt</a></span><span class=cB7>(</span><span class=cB0>&amp;win_task-&gt;display_flags,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l3990"></span><span class=cB3>DISPLAYf_NO_BORDER</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l753"></a>              <a href="http://tinkeros.github.io/WbGit/Kernel/GrTextBase.html#l312"></span><span class=cB5>TextChar</a></span><span class=cB0>(win_task,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l22"></span><span class=cB3>TRUE</a></span><span class=cB0>,x-x0,y-y0,tmp_u32_attr+ch);
<a name="l754"></a>            </span><span class=cB1>else</span><span class=cB0>
<a name="l755"></a>              <a href="http://tinkeros.github.io/WbGit/Kernel/GrTextBase.html#l312"></span><span class=cB5>TextChar</a></span><span class=cB0>(win_task,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l23"></span><span class=cB3>FALSE</a></span><span class=cB0>,x-x0,y-y0,tmp_u32_attr+ch);
<a name="l756"></a>          </span><span class=cB7>}</span><span class=cB0>
<a name="l757"></a>          </span><span class=cB1>if</span><span class=cB0> (find_cursor)
<a name="l758"></a>          </span><span class=cB7>{</span><span class=cB0>
<a name="l759"></a>            d2=<a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocRecalcLib.html#l3"></span><span class=cB5>DocCharDist</a></span><span class=cB0>(doc,x,y);
<a name="l760"></a>            </span><span class=cB1>if</span><span class=cB0> (d2&lt;<a href="http://tinkeros.github.io/WbGit/Kernel/KDbg.html#l192"></span><span class=cB5>D</a></span><span class=cB0>)
<a name="l761"></a>            {
<a name="l762"></a>              <a href="http://tinkeros.github.io/WbGit/Kernel/KDbg.html#l192"></span><span class=cB5>D</a></span><span class=cB0>=d2;
<a name="l763"></a>              col=i*3;
<a name="l764"></a>            }
<a name="l765"></a>          </span><span class=cB7>}</span><span class=cB0>
<a name="l766"></a>          x++;
<a name="l767"></a>        }
<a name="l768"></a>        </span><span class=cB1>if</span><span class=cB0> (i+k&gt;doc_e-&gt;len) k=doc_e-&gt;len-i;
<a name="l769"></a>        </span><span class=cB1>for</span><span class=cB0> (j=0; j&lt;k; j++)
<a name="l770"></a>        {
<a name="l771"></a>          <a href="http://tinkeros.github.io/WbGit/Kernel/StrPrint.html#l1043"></span><span class=cB5>StrPrint</a></span><span class=cB0>(buf,</span><span class=cB6>&quot;%02tX&quot;</span><span class=cB0>,*bptr++);
<a name="l772"></a>          ptr=buf;
<a name="l773"></a>          </span><span class=cB1>while</span><span class=cB0> (ch=*ptr++)
<a name="l774"></a>          </span><span class=cB7>{</span><span class=cB0>
<a name="l775"></a>            </span><span class=cB1>if</span><span class=cB0> (recalc_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1462"></span><span class=cB3>RECALCG_MASK</a></span><span class=cB0>==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1461"></span><span class=cB3>RECALCt_TO_SCRN</a></span><span class=cB0> &amp;&amp;
<a name="l776"></a>                !</span><span class=cB7>(</span><span class=cB0>doc_e-&gt;de_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1128"></span><span class=cB3>DOCEF_DONT_DRAW</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l777"></a>            {
<a name="l778"></a>              </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1109"></span><span class=cB3>DOCEF_BORDER_PLOT</a></span><span class=cB0> &amp;&amp;
<a name="l779"></a>                  !<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l14"></span><span class=cB5>Bt</a></span><span class=cB7>(</span><span class=cB0>&amp;win_task-&gt;display_flags,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l3990"></span><span class=cB3>DISPLAYf_NO_BORDER</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l780"></a>                <a href="http://tinkeros.github.io/WbGit/Kernel/GrTextBase.html#l312"></span><span class=cB5>TextChar</a></span><span class=cB0>(win_task,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l22"></span><span class=cB3>TRUE</a></span><span class=cB0>,x-x0,y-y0,tmp_u32_attr+ch);
<a name="l781"></a>              </span><span class=cB1>else</span><span class=cB0>
<a name="l782"></a>                <a href="http://tinkeros.github.io/WbGit/Kernel/GrTextBase.html#l312"></span><span class=cB5>TextChar</a></span><span class=cB0>(win_task,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l23"></span><span class=cB3>FALSE</a></span><span class=cB0>,x-x0,y-y0,tmp_u32_attr+ch);
<a name="l783"></a>            }
<a name="l784"></a>            </span><span class=cB1>if</span><span class=cB0> (find_cursor)
<a name="l785"></a>            {
<a name="l786"></a>              d2=<a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocRecalcLib.html#l3"></span><span class=cB5>DocCharDist</a></span><span class=cB0>(doc,x,y);
<a name="l787"></a>              </span><span class=cB1>if</span><span class=cB0> (d2&lt;<a href="http://tinkeros.github.io/WbGit/Kernel/KDbg.html#l192"></span><span class=cB5>D</a></span><span class=cB0>)
<a name="l788"></a>              </span><span class=cB7>{</span><span class=cB0>
<a name="l789"></a>                <a href="http://tinkeros.github.io/WbGit/Kernel/KDbg.html#l192"></span><span class=cB5>D</a></span><span class=cB0>=d2;
<a name="l790"></a>                col=col2;
<a name="l791"></a>              </span><span class=cB7>}</span><span class=cB0>
<a name="l792"></a>            }
<a name="l793"></a>            col2++;
<a name="l794"></a>            x++;
<a name="l795"></a>          </span><span class=cB7>}</span><span class=cB0>
<a name="l796"></a>          x++;
<a name="l797"></a>        }
<a name="l798"></a>        bptr-=j;
<a name="l799"></a>        x+=(doc_e-&gt;hex_ed_width-k)*3;
<a name="l800"></a>        </span><span class=cB1>for</span><span class=cB0> (j=0; j&lt;k; j++)
<a name="l801"></a>        {
<a name="l802"></a>          ch=*bptr++;
<a name="l803"></a>          </span><span class=cB1>if</span><span class=cB0> (!<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l14"></span><span class=cB5>Bt</a></span><span class=cB7>(<a href="http://tinkeros.github.io/WbGit/Kernel/StrA.html#l397"></span><span class=cB6>char_bmp_displayable</a></span><span class=cB0>,ch</span><span class=cB7>)</span><span class=cB0>) ch=</span><span class=cB6>'.'</span><span class=cB0>;
<a name="l804"></a>          </span><span class=cB1>if</span><span class=cB0> (recalc_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1462"></span><span class=cB3>RECALCG_MASK</a></span><span class=cB0>==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1461"></span><span class=cB3>RECALCt_TO_SCRN</a></span><span class=cB0> &amp;&amp;
<a name="l805"></a>              !</span><span class=cB7>(</span><span class=cB0>doc_e-&gt;de_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1128"></span><span class=cB3>DOCEF_DONT_DRAW</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l806"></a>          </span><span class=cB7>{</span><span class=cB0>
<a name="l807"></a>            </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1109"></span><span class=cB3>DOCEF_BORDER_PLOT</a></span><span class=cB0> &amp;&amp;
<a name="l808"></a>                !<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l14"></span><span class=cB5>Bt</a></span><span class=cB7>(</span><span class=cB0>&amp;win_task-&gt;display_flags,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l3990"></span><span class=cB3>DISPLAYf_NO_BORDER</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l809"></a>              <a href="http://tinkeros.github.io/WbGit/Kernel/GrTextBase.html#l312"></span><span class=cB5>TextChar</a></span><span class=cB0>(win_task,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l22"></span><span class=cB3>TRUE</a></span><span class=cB0>,x-x0,y-y0,tmp_u32_attr+ch);
<a name="l810"></a>            </span><span class=cB1>else</span><span class=cB0>
<a name="l811"></a>              <a href="http://tinkeros.github.io/WbGit/Kernel/GrTextBase.html#l312"></span><span class=cB5>TextChar</a></span><span class=cB0>(win_task,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l23"></span><span class=cB3>FALSE</a></span><span class=cB0>,x-x0,y-y0,tmp_u32_attr+ch);
<a name="l812"></a>          </span><span class=cB7>}</span><span class=cB0>
<a name="l813"></a>          </span><span class=cB1>if</span><span class=cB0> (find_cursor)
<a name="l814"></a>          </span><span class=cB7>{</span><span class=cB0>
<a name="l815"></a>            d2=<a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocRecalcLib.html#l3"></span><span class=cB5>DocCharDist</a></span><span class=cB0>(doc,x,y);
<a name="l816"></a>            </span><span class=cB1>if</span><span class=cB0> (d2&lt;<a href="http://tinkeros.github.io/WbGit/Kernel/KDbg.html#l192"></span><span class=cB5>D</a></span><span class=cB0>)
<a name="l817"></a>            {
<a name="l818"></a>              <a href="http://tinkeros.github.io/WbGit/Kernel/KDbg.html#l192"></span><span class=cB5>D</a></span><span class=cB0>=d2;
<a name="l819"></a>              col=col2;
<a name="l820"></a>            }
<a name="l821"></a>          </span><span class=cB7>}</span><span class=cB0>
<a name="l822"></a>          col2++;
<a name="l823"></a>          x++;
<a name="l824"></a>        }
<a name="l825"></a>        y++;
<a name="l826"></a>        x-=doc_e-&gt;hex_ed_width*3+k+9;
<a name="l827"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l828"></a>      </span><span class=cB1>break</span><span class=cB0>;
<a name="l829"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1006"></span><span class=cB3>DOCT_NEW_LINE</a></span><span class=cB0>:
<a name="l830"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1007"></span><span class=cB3>DOCT_SOFT_NEW_LINE</a></span><span class=cB0>:
<a name="l831"></a>      </span><span class=cB1>if</span><span class=cB0> (recalc_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1462"></span><span class=cB3>RECALCG_MASK</a></span><span class=cB0>==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1461"></span><span class=cB3>RECALCt_TO_SCRN</a></span><span class=cB0> &amp;&amp;
<a name="l832"></a>          !</span><span class=cB7>(</span><span class=cB0>doc_e-&gt;de_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1128"></span><span class=cB3>DOCEF_DONT_DRAW</a></span><span class=cB7>)</span><span class=cB0>&amp;&amp;
<a name="l833"></a>          y_plot_top&lt;=y&lt;=y_plot_bottom)
<a name="l834"></a>        <a href="http://tinkeros.github.io/WbGit/Kernel/GrTextBase.html#l318"></span><span class=cB5>TextLenAttr</a></span><span class=cB0>(win_task,x-x0,y-y0,width-</span><span class=cB7>(</span><span class=cB0>x-x0</span><span class=cB7>)</span><span class=cB0>,cur_u8_attr&lt;&lt;8);
<a name="l835"></a>      </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1144"></span><span class=cB3>DOCEF_HIGHLIGHT</a></span><span class=cB0> &amp;&amp; s-&gt;state==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1237"></span><span class=cB3>DOCSS_CPP_Z_COMMENT</a></span><span class=cB0>)
<a name="l836"></a>        s-&gt;state=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1233"></span><span class=cB3>DOCSS_NORMAL</a></span><span class=cB0>;
<a name="l837"></a>      y++;
<a name="l838"></a>      doc-&gt;page_line_num++;
<a name="l839"></a>rc_start_of_line:
<a name="l840"></a>      </span><span class=cB1>if</span><span class=cB0> (s-&gt;left_margin==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1268"></span><span class=cB3>DOC_DFT</a></span><span class=cB0>)
<a name="l841"></a>        x=s-&gt;indent;
<a name="l842"></a>      </span><span class=cB1>else</span><span class=cB0>
<a name="l843"></a>        x=s-&gt;indent+s-&gt;left_margin;
<a name="l844"></a>rc_adjust_xy:
<a name="l845"></a>      i=s-&gt;indent+s-&gt;left_margin;
<a name="l846"></a>      </span><span class=cB1>if</span><span class=cB0> (x&lt;i)
<a name="l847"></a>        x=i;
<a name="l848"></a>      </span><span class=cB1>if</span><span class=cB0> (doc-&gt;page_line_num&lt;0)
<a name="l849"></a>        doc-&gt;page_line_num=s-&gt;page_len+doc-&gt;page_line_num%s-&gt;page_len;
<a name="l850"></a>      </span><span class=cB1>else</span><span class=cB0>
<a name="l851"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l852"></a>        </span><span class=cB1>if</span><span class=cB0> (doc-&gt;page_line_num&gt;=s-&gt;page_len)
<a name="l853"></a>        {
<a name="l854"></a>          doc-&gt;page_line_num-=s-&gt;page_len;
<a name="l855"></a>          </span><span class=cB1>if</span><span class=cB0> (doc-&gt;page_line_num&gt;=s-&gt;page_len) </span><span class=cB2>//avoid extra divide</span><span class=cB0>
<a name="l856"></a>            doc-&gt;page_line_num=doc-&gt;page_line_num%s-&gt;page_len;
<a name="l857"></a>        }
<a name="l858"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l859"></a>      </span><span class=cB1>if</span><span class=cB0> (s-&gt;header!=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1268"></span><span class=cB3>DOC_DFT</a></span><span class=cB0>)
<a name="l860"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l861"></a>        </span><span class=cB1>if</span><span class=cB0> (doc-&gt;page_line_num&lt;s-&gt;header)
<a name="l862"></a>        {
<a name="l863"></a>          y+=s-&gt;header-doc-&gt;page_line_num;
<a name="l864"></a>          doc-&gt;page_line_num=s-&gt;header;
<a name="l865"></a>          </span><span class=cB1>goto</span><span class=cB0> rc_start_of_line;
<a name="l866"></a>        }
<a name="l867"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l868"></a>      </span><span class=cB1>if</span><span class=cB0> (s-&gt;footer==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1268"></span><span class=cB3>DOC_DFT</a></span><span class=cB0>)
<a name="l869"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l870"></a>        </span><span class=cB1>if</span><span class=cB0> (doc-&gt;page_line_num&gt;=s-&gt;page_len)
<a name="l871"></a>        {
<a name="l872"></a>          </span><span class=cB1>if</span><span class=cB0> (s-&gt;header==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1268"></span><span class=cB3>DOC_DFT</a></span><span class=cB0>)
<a name="l873"></a>            doc-&gt;page_line_num=0;
<a name="l874"></a>          </span><span class=cB1>else</span><span class=cB0>
<a name="l875"></a>          </span><span class=cB7>{</span><span class=cB0>
<a name="l876"></a>            doc-&gt;page_line_num=s-&gt;header;
<a name="l877"></a>            y+=s-&gt;header;
<a name="l878"></a>          </span><span class=cB7>}</span><span class=cB0>
<a name="l879"></a>          </span><span class=cB1>goto</span><span class=cB0> rc_start_of_line;
<a name="l880"></a>        }
<a name="l881"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l882"></a>      </span><span class=cB1>else</span><span class=cB0>
<a name="l883"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l884"></a>        </span><span class=cB1>if</span><span class=cB0> (doc-&gt;page_line_num&gt;=s-&gt;page_len-s-&gt;footer)
<a name="l885"></a>        {
<a name="l886"></a>          y+=s-&gt;footer;
<a name="l887"></a>          </span><span class=cB1>if</span><span class=cB0> (s-&gt;header==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1268"></span><span class=cB3>DOC_DFT</a></span><span class=cB0>)
<a name="l888"></a>            doc-&gt;page_line_num=0;
<a name="l889"></a>          </span><span class=cB1>else</span><span class=cB0>
<a name="l890"></a>          </span><span class=cB7>{</span><span class=cB0>
<a name="l891"></a>            doc-&gt;page_line_num=s-&gt;header;
<a name="l892"></a>            y+=s-&gt;header;
<a name="l893"></a>          </span><span class=cB7>}</span><span class=cB0>
<a name="l894"></a>          </span><span class=cB1>goto</span><span class=cB0> rc_start_of_line;
<a name="l895"></a>        }
<a name="l896"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l897"></a>      </span><span class=cB1>break</span><span class=cB0>;
<a name="l898"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1008"></span><span class=cB3>DOCT_TAB</a></span><span class=cB0>:
<a name="l899"></a>      k=(x+8) &amp; ~7;
<a name="l900"></a>      </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1109"></span><span class=cB3>DOCEF_BORDER_PLOT</a></span><span class=cB0> &amp;&amp;
<a name="l901"></a>          !<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l14"></span><span class=cB5>Bt</a></span><span class=cB7>(</span><span class=cB0>&amp;win_task-&gt;display_flags,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l3990"></span><span class=cB3>DISPLAYf_NO_BORDER</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l902"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l903"></a>        </span><span class=cB1>while</span><span class=cB0> (x&lt;k)
<a name="l904"></a>        {
<a name="l905"></a>          </span><span class=cB1>if</span><span class=cB0> (recalc_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1462"></span><span class=cB3>RECALCG_MASK</a></span><span class=cB0>==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1461"></span><span class=cB3>RECALCt_TO_SCRN</a></span><span class=cB0> &amp;&amp;
<a name="l906"></a>              !</span><span class=cB7>(</span><span class=cB0>doc_e-&gt;de_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1128"></span><span class=cB3>DOCEF_DONT_DRAW</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l907"></a>            <a href="http://tinkeros.github.io/WbGit/Kernel/GrTextBase.html#l312"></span><span class=cB5>TextChar</a></span><span class=cB0>(win_task,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l22"></span><span class=cB3>TRUE</a></span><span class=cB0>,x-x0,y-y0,tmp_u32_attr+<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l4199"></span><span class=cB3>CH_SPACE</a></span><span class=cB0>);
<a name="l908"></a>          </span><span class=cB1>if</span><span class=cB0> (find_cursor)
<a name="l909"></a>          </span><span class=cB7>{</span><span class=cB0>
<a name="l910"></a>            d2=<a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocRecalcLib.html#l3"></span><span class=cB5>DocCharDist</a></span><span class=cB0>(doc,x,y);
<a name="l911"></a>            </span><span class=cB1>if</span><span class=cB0> (d2&lt;<a href="http://tinkeros.github.io/WbGit/Kernel/KDbg.html#l192"></span><span class=cB5>D</a></span><span class=cB0>)
<a name="l912"></a>              <a href="http://tinkeros.github.io/WbGit/Kernel/KDbg.html#l192"></span><span class=cB5>D</a></span><span class=cB0>=d2;
<a name="l913"></a>          </span><span class=cB7>}</span><span class=cB0>
<a name="l914"></a>          x++;
<a name="l915"></a>        }
<a name="l916"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l917"></a>      </span><span class=cB1>else</span><span class=cB0>
<a name="l918"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l919"></a>        k-=x;
<a name="l920"></a>        </span><span class=cB1>if</span><span class=cB0> (recalc_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1462"></span><span class=cB3>RECALCG_MASK</a></span><span class=cB0>==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1461"></span><span class=cB3>RECALCt_TO_SCRN</a></span><span class=cB0> &amp;&amp;
<a name="l921"></a>            !</span><span class=cB7>(</span><span class=cB0>doc_e-&gt;de_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1128"></span><span class=cB3>DOCEF_DONT_DRAW</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l922"></a>        {
<a name="l923"></a>          </span><span class=cB1>if</span><span class=cB0> (y_plot_top&lt;=y&lt;=y_plot_bottom)
<a name="l924"></a>            <a href="http://tinkeros.github.io/WbGit/Kernel/GrTextBase.html#l314"></span><span class=cB5>TextLenStr</a></span><span class=cB0>(win_task,x-x0,y-y0,k,tmp_u32_attr,</span><span class=cB6>&quot;        &quot;</span><span class=cB0>);
<a name="l925"></a>          x+=k;
<a name="l926"></a>        }
<a name="l927"></a>        </span><span class=cB1>else</span><span class=cB0>
<a name="l928"></a>        {
<a name="l929"></a>          </span><span class=cB1>if</span><span class=cB0> (find_cursor)
<a name="l930"></a>          </span><span class=cB7>{</span><span class=cB0>
<a name="l931"></a>            </span><span class=cB1>while</span><span class=cB0> (k--)
<a name="l932"></a>            {
<a name="l933"></a>              d2=<a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocRecalcLib.html#l3"></span><span class=cB5>DocCharDist</a></span><span class=cB0>(doc,x,y);
<a name="l934"></a>              </span><span class=cB1>if</span><span class=cB0> (d2&lt;<a href="http://tinkeros.github.io/WbGit/Kernel/KDbg.html#l192"></span><span class=cB5>D</a></span><span class=cB0>)
<a name="l935"></a>                <a href="http://tinkeros.github.io/WbGit/Kernel/KDbg.html#l192"></span><span class=cB5>D</a></span><span class=cB0>=d2;
<a name="l936"></a>              x++;
<a name="l937"></a>            }
<a name="l938"></a>          </span><span class=cB7>}</span><span class=cB0>
<a name="l939"></a>          </span><span class=cB1>else</span><span class=cB0>
<a name="l940"></a>            x+=k;
<a name="l941"></a>        }
<a name="l942"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l943"></a>      </span><span class=cB1>break</span><span class=cB0>;
<a name="l944"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1009"></span><span class=cB3>DOCT_PAGE_BREAK</a></span><span class=cB0>:
<a name="l945"></a>      doc-&gt;flags|=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1388"></span><span class=cB3>DOCF_BWD_MOVEMENT</a></span><span class=cB0>;
<a name="l946"></a>      y+=s-&gt;page_len-doc_e-&gt;page_line_num;
<a name="l947"></a>      doc-&gt;page_line_num=0;
<a name="l948"></a>      </span><span class=cB1>goto</span><span class=cB0> rc_start_of_line;
<a name="l949"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1010"></span><span class=cB3>DOCT_CURSOR</a></span><span class=cB0>:
<a name="l950"></a>      </span><span class=cB1>if</span><span class=cB0> (!find_cursor &amp;&amp; !</span><span class=cB7>(</span><span class=cB0>doc-&gt;flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1373"></span><span class=cB3>DOCF_NO_CURSOR</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l951"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l952"></a>        doc-&gt;cur_entry=doc_e-&gt;next;
<a name="l953"></a>        doc-&gt;cur_col=doc-&gt;cur_entry-&gt;min_col;
<a name="l954"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l955"></a>      </span><span class=cB1>if</span><span class=cB0> (doc_e!=added_cursor)
<a name="l956"></a>        del_doc_e=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l22"></span><span class=cB3>TRUE</a></span><span class=cB0>;
<a name="l957"></a>      </span><span class=cB1>break</span><span class=cB0>;
<a name="l958"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1012"></span><span class=cB3>DOCT_PMT</a></span><span class=cB0>:
<a name="l959"></a>      cur_u8_attr=cur_u8_attr&amp;0xF0|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1245"></span><span class=cB3>DOC_COLOR_PMT</a></span><span class=cB0>;
<a name="l960"></a>      </span><span class=cB1>if</span><span class=cB0> (y==cursor_y)
<a name="l961"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l962"></a>        doc-&gt;cur_entry=doc_e-&gt;next;
<a name="l963"></a>        doc-&gt;cur_col=doc-&gt;cur_entry-&gt;min_col;
<a name="l964"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l965"></a>      </span><span class=cB1>break</span><span class=cB0>;
<a name="l966"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1013"></span><span class=cB3>DOCT_CLEAR</a></span><span class=cB0>:
<a name="l967"></a>      next_clear_found=doc_e;
<a name="l968"></a>      </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1120"></span><span class=cB3>DOCEF_HOLD</a></span><span class=cB0>)
<a name="l969"></a>        clear_holds=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l22"></span><span class=cB3>TRUE</a></span><span class=cB0>;
<a name="l970"></a>      </span><span class=cB1>else</span><span class=cB0>
<a name="l971"></a>        clear_holds=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l23"></span><span class=cB3>FALSE</a></span><span class=cB0>;
<a name="l972"></a>      </span><span class=cB1>break</span><span class=cB0>;
<a name="l973"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1014"></span><span class=cB3>DOCT_PAGE_LEN</a></span><span class=cB0>:
<a name="l974"></a>      s-&gt;page_len=doc_e-&gt;attr;
<a name="l975"></a>      </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1102"></span><span class=cB3>DOCEF_WIN_REL</a></span><span class=cB0>)
<a name="l976"></a>        s-&gt;page_len+=height;
<a name="l977"></a>      </span><span class=cB1>goto</span><span class=cB0> rc_adjust_xy;
<a name="l978"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1015"></span><span class=cB3>DOCT_LEFT_MARGIN</a></span><span class=cB0>:
<a name="l979"></a>      i=doc_e-&gt;attr;
<a name="l980"></a>      left_margin=left+i;
<a name="l981"></a>      s-&gt;left_margin=i;
<a name="l982"></a>      </span><span class=cB1>goto</span><span class=cB0> rc_start_of_line;
<a name="l983"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1016"></span><span class=cB3>DOCT_RIGHT_MARGIN</a></span><span class=cB0>:
<a name="l984"></a>      </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1102"></span><span class=cB3>DOCEF_WIN_REL</a></span><span class=cB0>)
<a name="l985"></a>        i=width-1-doc_e-&gt;attr;
<a name="l986"></a>      </span><span class=cB1>else</span><span class=cB0>
<a name="l987"></a>        i=doc_e-&gt;attr;
<a name="l988"></a>      right_margin=left+i;
<a name="l989"></a>      s-&gt;right_margin=i;
<a name="l990"></a>      </span><span class=cB1>goto</span><span class=cB0> rc_adjust_xy;
<a name="l991"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1017"></span><span class=cB3>DOCT_HEADER</a></span><span class=cB0>:
<a name="l992"></a>      s-&gt;header=doc_e-&gt;attr;
<a name="l993"></a>      </span><span class=cB1>goto</span><span class=cB0> rc_adjust_xy;
<a name="l994"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1018"></span><span class=cB3>DOCT_FOOTER</a></span><span class=cB0>:
<a name="l995"></a>      s-&gt;footer=doc_e-&gt;attr;
<a name="l996"></a>      </span><span class=cB1>goto</span><span class=cB0> rc_adjust_xy;
<a name="l997"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1019"></span><span class=cB3>DOCT_INDENT</a></span><span class=cB0>:
<a name="l998"></a>      </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1092"></span><span class=cB3>DOCEF_LEFT_X</a></span><span class=cB0>)
<a name="l999"></a>        i=doc_e-&gt;attr;
<a name="l1000"></a>      </span><span class=cB1>else</span><span class=cB0>
<a name="l1001"></a>        i=s-&gt;indent+doc_e-&gt;attr;
<a name="l1002"></a>      s-&gt;indent=i;
<a name="l1003"></a>      </span><span class=cB1>goto</span><span class=cB0> rc_start_of_line;
<a name="l1004"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1020"></span><span class=cB3>DOCT_FOREGROUND</a></span><span class=cB0>:
<a name="l1005"></a>      cur_u8_attr&amp;=0xF0;
<a name="l1006"></a>      </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;attr==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1268"></span><span class=cB3>DOC_DFT</a></span><span class=cB0>)
<a name="l1007"></a>        cur_u8_attr|=s-&gt;dft_text_attr&amp;0x0F;
<a name="l1008"></a>      </span><span class=cB1>else</span><span class=cB0>
<a name="l1009"></a>        cur_u8_attr|=doc_e-&gt;attr;
<a name="l1010"></a>      s-&gt;cur_text_attr=cur_u8_attr;
<a name="l1011"></a>      </span><span class=cB1>break</span><span class=cB0>;
<a name="l1012"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1021"></span><span class=cB3>DOCT_BACKGROUND</a></span><span class=cB0>:
<a name="l1013"></a>      cur_u8_attr&amp;=0x0F;
<a name="l1014"></a>      </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;attr==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1268"></span><span class=cB3>DOC_DFT</a></span><span class=cB0>)
<a name="l1015"></a>        cur_u8_attr|=s-&gt;dft_text_attr&amp;0xF0;
<a name="l1016"></a>      </span><span class=cB1>else</span><span class=cB0>
<a name="l1017"></a>        cur_u8_attr|=doc_e-&gt;attr&lt;&lt;4;
<a name="l1018"></a>      s-&gt;cur_text_attr=cur_u8_attr;
<a name="l1019"></a>      </span><span class=cB1>break</span><span class=cB0>;
<a name="l1020"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1022"></span><span class=cB3>DOCT_DFT_FOREGROUND</a></span><span class=cB0>:
<a name="l1021"></a>      cur_u8_attr&amp;=0xF0;
<a name="l1022"></a>      </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;attr==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1268"></span><span class=cB3>DOC_DFT</a></span><span class=cB0>)
<a name="l1023"></a>        cur_u8_attr|=s-&gt;dft_text_attr&amp;0xF;
<a name="l1024"></a>      </span><span class=cB1>else</span><span class=cB0>
<a name="l1025"></a>        cur_u8_attr|=doc_e-&gt;attr;
<a name="l1026"></a>      s-&gt;dft_text_attr=s-&gt;dft_text_attr&amp;0xF0|cur_u8_attr&amp;0x0F;
<a name="l1027"></a>      s-&gt;cur_text_attr=cur_u8_attr;
<a name="l1028"></a>      </span><span class=cB1>break</span><span class=cB0>;
<a name="l1029"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1023"></span><span class=cB3>DOCT_DFT_BACKGROUND</a></span><span class=cB0>:
<a name="l1030"></a>      cur_u8_attr&amp;=0x0F;
<a name="l1031"></a>      </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;attr==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1268"></span><span class=cB3>DOC_DFT</a></span><span class=cB0>)
<a name="l1032"></a>        cur_u8_attr|=s-&gt;dft_text_attr&amp;0xF0;
<a name="l1033"></a>      </span><span class=cB1>else</span><span class=cB0>
<a name="l1034"></a>        cur_u8_attr|=doc_e-&gt;attr&lt;&lt;4;
<a name="l1035"></a>      s-&gt;dft_text_attr=s-&gt;dft_text_attr&amp;0x0F|cur_u8_attr&amp;0xF0;
<a name="l1036"></a>      s-&gt;cur_text_attr=cur_u8_attr;
<a name="l1037"></a>      </span><span class=cB1>break</span><span class=cB0>;
<a name="l1038"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1024"></span><span class=cB3>DOCT_WORD_WRAP</a></span><span class=cB0>:
<a name="l1039"></a>      </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;attr)
<a name="l1040"></a>        doc-&gt;flags|=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1395"></span><span class=cB3>DOCF_WORD_WRAP</a></span><span class=cB0>;
<a name="l1041"></a>      </span><span class=cB1>else</span><span class=cB0>
<a name="l1042"></a>        doc-&gt;flags&amp;=~<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1395"></span><span class=cB3>DOCF_WORD_WRAP</a></span><span class=cB0>;
<a name="l1043"></a>      </span><span class=cB1>break</span><span class=cB0>;
<a name="l1044"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1025"></span><span class=cB3>DOCT_HIGHLIGHT</a></span><span class=cB0>:
<a name="l1045"></a>      </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;attr)
<a name="l1046"></a>        doc-&gt;flags|=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1394"></span><span class=cB3>DOCF_HIGHLIGHT</a></span><span class=cB0>;
<a name="l1047"></a>      </span><span class=cB1>else</span><span class=cB0>
<a name="l1048"></a>        doc-&gt;flags&amp;=~<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1394"></span><span class=cB3>DOCF_HIGHLIGHT</a></span><span class=cB0>;
<a name="l1049"></a>      </span><span class=cB1>break</span><span class=cB0>;
<a name="l1050"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1026"></span><span class=cB3>DOCT_BLINK</a></span><span class=cB0>:
<a name="l1051"></a>      </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;attr)
<a name="l1052"></a>        doc-&gt;flags|=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1396"></span><span class=cB3>DOCF_BLINK</a></span><span class=cB0>;
<a name="l1053"></a>      </span><span class=cB1>else</span><span class=cB0>
<a name="l1054"></a>        doc-&gt;flags&amp;=~<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1396"></span><span class=cB3>DOCF_BLINK</a></span><span class=cB0>;
<a name="l1055"></a>      </span><span class=cB1>break</span><span class=cB0>;
<a name="l1056"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1027"></span><span class=cB3>DOCT_INVERT</a></span><span class=cB0>:
<a name="l1057"></a>      </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;attr)
<a name="l1058"></a>        doc-&gt;flags|=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1397"></span><span class=cB3>DOCF_INVERT</a></span><span class=cB0>;
<a name="l1059"></a>      </span><span class=cB1>else</span><span class=cB0>
<a name="l1060"></a>        doc-&gt;flags&amp;=~<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1397"></span><span class=cB3>DOCF_INVERT</a></span><span class=cB0>;
<a name="l1061"></a>      </span><span class=cB1>break</span><span class=cB0>;
<a name="l1062"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1028"></span><span class=cB3>DOCT_UNDERLINE</a></span><span class=cB0>:
<a name="l1063"></a>      </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;attr)
<a name="l1064"></a>        doc-&gt;flags|=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1399"></span><span class=cB3>DOCF_UNDERLINE</a></span><span class=cB0>;
<a name="l1065"></a>      </span><span class=cB1>else</span><span class=cB0>
<a name="l1066"></a>        doc-&gt;flags&amp;=~<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1399"></span><span class=cB3>DOCF_UNDERLINE</a></span><span class=cB0>;
<a name="l1067"></a>      </span><span class=cB1>break</span><span class=cB0>;
<a name="l1068"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1029"></span><span class=cB3>DOCT_SHIFTED_X</a></span><span class=cB0>:
<a name="l1069"></a>      s-&gt;shifted_x=doc_e-&gt;attr;
<a name="l1070"></a>      </span><span class=cB1>break</span><span class=cB0>;
<a name="l1071"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1030"></span><span class=cB3>DOCT_SHIFTED_Y</a></span><span class=cB0>:
<a name="l1072"></a>      s-&gt;shifted_y=doc_e-&gt;attr;
<a name="l1073"></a>      </span><span class=cB1>break</span><span class=cB0>;
<a name="l1074"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1031"></span><span class=cB3>DOCT_CURSOR_MOVEMENT</a></span><span class=cB0>:
<a name="l1075"></a>      doc-&gt;flags|=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1388"></span><span class=cB3>DOCF_BWD_MOVEMENT</a></span><span class=cB0>;
<a name="l1076"></a>      x+=doc_e-&gt;cursor_x_offset;
<a name="l1077"></a>      </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1100"></span><span class=cB3>DOCEF_PAGE_REL_Y</a></span><span class=cB0>)
<a name="l1078"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l1079"></a>        i=doc-&gt;page_line_num;
<a name="l1080"></a>        </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1095"></span><span class=cB3>DOCEF_TOP_Y</a></span><span class=cB0>)
<a name="l1081"></a>          doc-&gt;page_line_num=0;
<a name="l1082"></a>        </span><span class=cB1>else</span><span class=cB0> </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1097"></span><span class=cB3>DOCEF_BOTTOM_Y</a></span><span class=cB0>)
<a name="l1083"></a>          doc-&gt;page_line_num=s-&gt;page_len-1;
<a name="l1084"></a>        </span><span class=cB1>else</span><span class=cB0> </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1096"></span><span class=cB3>DOCEF_CENTER_Y</a></span><span class=cB0>)
<a name="l1085"></a>          doc-&gt;page_line_num=s-&gt;page_len&gt;&gt;1;
<a name="l1086"></a>        y+=doc-&gt;page_line_num-i;
<a name="l1087"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l1088"></a>      y+=doc_e-&gt;cursor_y_offset;
<a name="l1089"></a>      doc-&gt;page_line_num+=doc_e-&gt;cursor_y_offset;
<a name="l1090"></a>      </span><span class=cB1>goto</span><span class=cB0> rc_adjust_xy;
<a name="l1091"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1042"></span><span class=cB3>DOCT_SPRITE</a></span><span class=cB0>:
<a name="l1092"></a>      </span><span class=cB1>if</span><span class=cB0> (!doc_e-&gt;bin_data &amp;&amp; doc-&gt;flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1079"></span><span class=cB3>DOCEF_HAS_BIN</a></span><span class=cB0>)
<a name="l1093"></a>        doc_e-&gt;bin_data=<a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocBin.html#l3"></span><span class=cB5>DocBinFindNum</a></span><span class=cB0>(doc,doc_e-&gt;bin_num);
<a name="l1094"></a>      </span><span class=cB1>if</span><span class=cB0> (</span><span class=cB7>(</span><span class=cB0>tmpb=doc_e-&gt;bin_data</span><span class=cB7>)</span><span class=cB0> &amp;&amp;
<a name="l1095"></a>          !tmpb-&gt;tag &amp;&amp; doc_e-&gt;tag &amp;&amp; *doc_e-&gt;tag)
<a name="l1096"></a>        tmpb-&gt;tag=<a href="http://tinkeros.github.io/WbGit/Kernel/Mem/MAllocFree.html#l478"></span><span class=cB5>StrNew</a></span><span class=cB0>(doc_e-&gt;tag,mem_task);
<a name="l1097"></a>      </span><span class=cB1>if</span><span class=cB0> (tmpb &amp;&amp; dc)
<a name="l1098"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l1099"></a>        <a href="http://tinkeros.github.io/WbGit/Adam/Gr/GrDC.html#l149"></span><span class=cB5>DCRst</a></span><span class=cB0>(dc);
<a name="l1100"></a>        dc-&gt;flags&amp;=~(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l4331"></span><span class=cB3>DCF_DONT_DRAW</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l4330"></span><span class=cB3>DCF_LOCATE_NEAREST</a></span><span class=cB0>);
<a name="l1101"></a>        </span><span class=cB1>if</span><span class=cB0> (recalc_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1462"></span><span class=cB3>RECALCG_MASK</a></span><span class=cB0>!=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1461"></span><span class=cB3>RECALCt_TO_SCRN</a></span><span class=cB0> ||
<a name="l1102"></a>            doc_e-&gt;de_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1128"></span><span class=cB3>DOCEF_DONT_DRAW</a></span><span class=cB0>)
<a name="l1103"></a>          dc-&gt;flags|=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l4331"></span><span class=cB3>DCF_DONT_DRAW</a></span><span class=cB0>;
<a name="l1104"></a>        bptr=tmpb-&gt;data;
<a name="l1105"></a>        ii=<a href="http://tinkeros.github.io/WbGit/Adam/Gr/SpriteNew.html#l90"></span><span class=cB5>SpriteTypeMask</a></span><span class=cB0>(bptr);
<a name="l1106"></a>        </span><span class=cB1>if</span><span class=cB0> (ii&amp;1&lt;&lt;<a href="http://tinkeros.github.io/WbGit/Adam/Gr/Gr.html#l150"></span><span class=cB3>SPT_TYPES_NUM</a></span><span class=cB0>)
<a name="l1107"></a>        {
<a name="l1108"></a>          bptr=<a href="http://tinkeros.github.io/WbGit/Kernel/KGlbls.html#l15"></span><span class=cB6>gr</a></span><span class=cB0>.empty_sprite;
<a name="l1109"></a>          ii=<a href="http://tinkeros.github.io/WbGit/Adam/Gr/SpriteNew.html#l90"></span><span class=cB5>SpriteTypeMask</a></span><span class=cB0>(bptr);
<a name="l1110"></a>        }
<a name="l1111"></a>        </span><span class=cB1>if</span><span class=cB0> (ii&amp;</span><span class=cB7>(</span><span class=cB0>1&lt;&lt;<a href="http://tinkeros.github.io/WbGit/Adam/Gr/Gr.html#l141"></span><span class=cB3>SPT_FLOOD_FILL</a></span><span class=cB0>|1&lt;&lt;<a href="http://tinkeros.github.io/WbGit/Adam/Gr/Gr.html#l142"></span><span class=cB3>SPT_FLOOD_FILL_NOT</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l1112"></a>          i=cur_u8_attr&gt;&gt;4 &amp;0xF ^ win_task-&gt;text_attr&gt;&gt;4 &amp; 0xF;
<a name="l1113"></a>        </span><span class=cB1>else</span><span class=cB0>
<a name="l1114"></a>        {
<a name="l1115"></a>          i=tmp_u32_attr&gt;&gt;12&amp;0xF ^ win_task-&gt;text_attr&gt;&gt;4 &amp; 0xF;
<a name="l1116"></a>          </span><span class=cB1>if</span><span class=cB0> (tmp_u32_attr &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1054"></span><span class=cB3>DOCET_SEL</a></span><span class=cB0>)
<a name="l1117"></a>            i^=0xF;
<a name="l1118"></a>          </span><span class=cB1>if</span><span class=cB0> (tmp_u32_attr &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1053"></span><span class=cB3>DOCET_INVERT</a></span><span class=cB0>)
<a name="l1119"></a>            i^=0xF;
<a name="l1120"></a>          </span><span class=cB1>if</span><span class=cB0> (blink_flag &amp;&amp;
<a name="l1121"></a>              </span><span class=cB7>(</span><span class=cB0>doc_e==doc-&gt;cur_entry || tmp_u32_attr&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1052"></span><span class=cB3>DOCET_BLINK</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l1122"></a>            i^=0xF;
<a name="l1123"></a>        }
<a name="l1124"></a>        dc-&gt;color=i;
<a name="l1125"></a>        </span><span class=cB1>if</span><span class=cB0> (find_cursor)
<a name="l1126"></a>          dc-&gt;flags|=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l4330"></span><span class=cB3>DCF_LOCATE_NEAREST</a></span><span class=cB0>;
<a name="l1127"></a>        dc-&gt;cur_x=(doc-&gt;x-x0)*<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l4305"></span><span class=cB3>FONT_WIDTH</a></span><span class=cB0>+pix_left+scroll_x;
<a name="l1128"></a>        dc-&gt;cur_y=(doc-&gt;y-y0)*<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l4306"></span><span class=cB3>FONT_HEIGHT</a></span><span class=cB0>+pix_top+scroll_y;
<a name="l1129"></a>        dc-&gt;cur_z=0;
<a name="l1130"></a>        dc-&gt;bkcolor=i;
<a name="l1131"></a>        </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1106"></span><span class=cB3>DOCEF_FROM_START</a></span><span class=cB0>)
<a name="l1132"></a>        {
<a name="l1133"></a>          xx=(x-k-x0)*<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l4305"></span><span class=cB3>FONT_WIDTH</a></span><span class=cB0>; </span><span class=cB2>//TODO: scrolling text is not length k</span><span class=cB0>
<a name="l1134"></a>          yy=(y-y0)*<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l4306"></span><span class=cB3>FONT_HEIGHT</a></span><span class=cB0>;
<a name="l1135"></a>          zz=0;
<a name="l1136"></a>        }
<a name="l1137"></a>        </span><span class=cB1>else</span><span class=cB0>
<a name="l1138"></a>        {
<a name="l1139"></a>          xx=(x-x0)*<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l4305"></span><span class=cB3>FONT_WIDTH</a></span><span class=cB0>;
<a name="l1140"></a>          yy=(y-y0)*<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l4306"></span><span class=cB3>FONT_HEIGHT</a></span><span class=cB0>;
<a name="l1141"></a>          zz=0;
<a name="l1142"></a>        }
<a name="l1143"></a>        </span><span class=cB1>if</span><span class=cB0> (ii&amp;</span><span class=cB7>(</span><span class=cB0>1&lt;&lt;<a href="http://tinkeros.github.io/WbGit/Adam/Gr/Gr.html#l144"></span><span class=cB3>SPT_MESH</a></span><span class=cB0>|1&lt;&lt;<a href="http://tinkeros.github.io/WbGit/Adam/Gr/Gr.html#l145"></span><span class=cB3>SPT_SHIFTABLE_MESH</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l1144"></a>        {
<a name="l1145"></a>          </span><span class=cB1>if</span><span class=cB0> (!depth_buf)
<a name="l1146"></a>          </span><span class=cB7>{</span><span class=cB0>
<a name="l1147"></a>            <a href="http://tinkeros.github.io/WbGit/Adam/Gr/GrDC.html#l251"></span><span class=cB5>DCDepthBufAlloc</a></span><span class=cB0>(dc);
<a name="l1148"></a>            depth_buf=dc-&gt;depth_buf;
<a name="l1149"></a>          </span><span class=cB7>}</span><span class=cB0>
<a name="l1150"></a>          </span><span class=cB1>else</span><span class=cB0>
<a name="l1151"></a>            dc-&gt;depth_buf=depth_buf;
<a name="l1152"></a>          <a href="http://tinkeros.github.io/WbGit/Adam/Gr/GrDC.html#l38"></span><span class=cB5>Mat4x4IdentEqu</a></span><span class=cB0>(dc-&gt;r);
<a name="l1153"></a>          <a href="http://tinkeros.github.io/WbGit/Adam/Gr/GrMath.html#l198"></span><span class=cB5>Mat4x4RotZ</a></span><span class=cB0>(dc-&gt;r,cur_time*3.1);
<a name="l1154"></a>          <a href="http://tinkeros.github.io/WbGit/Adam/Gr/GrMath.html#l184"></span><span class=cB5>Mat4x4RotY</a></span><span class=cB0>(dc-&gt;r,cur_time*1.9);
<a name="l1155"></a>          <a href="http://tinkeros.github.io/WbGit/Adam/Gr/GrMath.html#l154"></span><span class=cB5>Mat4x4RotX</a></span><span class=cB0>(dc-&gt;r,cur_time);
<a name="l1156"></a>          dc-&gt;flags|=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l4321"></span><span class=cB3>DCF_TRANSFORMATION</a></span><span class=cB0>;
<a name="l1157"></a>          dc-&gt;x=xx;
<a name="l1158"></a>          dc-&gt;y=yy;
<a name="l1159"></a>          dc-&gt;z=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l4313"></span><span class=cB3>GR_Z_ALL</a></span><span class=cB0>;
<a name="l1160"></a>          xx=0;
<a name="l1161"></a>          yy=0;
<a name="l1162"></a>          zz=0;
<a name="l1163"></a>        }
<a name="l1164"></a>        <a href="http://tinkeros.github.io/WbGit/Adam/Gr/GrSpritePlot.html#l18"></span><span class=cB5>Sprite3</a></span><span class=cB0>(dc,xx,yy,zz,bptr);
<a name="l1165"></a>        dc-&gt;depth_buf=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l21"></span><span class=cB3>NULL</a></span><span class=cB0>;
<a name="l1166"></a>        dc-&gt;flags&amp;=~(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l4330"></span><span class=cB3>DCF_LOCATE_NEAREST</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l4331"></span><span class=cB3>DCF_DONT_DRAW</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l4321"></span><span class=cB3>DCF_TRANSFORMATION</a></span><span class=cB0>);
<a name="l1167"></a>        </span><span class=cB1>if</span><span class=cB0> (dc-&gt;nearest_dist&lt;=<a href="http://tinkeros.github.io/WbGit/Kernel/KDbg.html#l192"></span><span class=cB5>D</a></span><span class=cB0>)
<a name="l1168"></a>        {
<a name="l1169"></a>          <a href="http://tinkeros.github.io/WbGit/Kernel/KDbg.html#l192"></span><span class=cB5>D</a></span><span class=cB0>=dc-&gt;nearest_dist;
<a name="l1170"></a>          col=doc_e-&gt;min_col;
<a name="l1171"></a>        }
<a name="l1172"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l1173"></a>      </span><span class=cB1>break</span><span class=cB0>;
<a name="l1174"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1045"></span><span class=cB3>DOCT_SONG</a></span><span class=cB0>:
<a name="l1175"></a>      </span><span class=cB1>if</span><span class=cB0> (<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l205"></span><span class=cB6>sys_focus_task</a></span><span class=cB0>==win_task &amp;&amp;
<a name="l1176"></a>          recalc_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1462"></span><span class=cB3>RECALCG_MASK</a></span><span class=cB0>==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1461"></span><span class=cB3>RECALCt_TO_SCRN</a></span><span class=cB0> &amp;&amp;
<a name="l1177"></a>          !</span><span class=cB7>(</span><span class=cB0>doc_e-&gt;de_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1128"></span><span class=cB3>DOCEF_DONT_DRAW</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l1178"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l1179"></a>        </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;aux_str &amp;&amp;
<a name="l1180"></a>            </span><span class=cB7>(</span><span class=cB0>!<a href="http://tinkeros.github.io/WbGit/Adam/Snd/ASnd.html#l112"></span><span class=cB6>music</a></span><span class=cB0>.cur_song || <a href="http://tinkeros.github.io/WbGit/Kernel/StrA.html#l311"></span><span class=cB5>StrCmp</a></span><span class=cB0>(<a href="http://tinkeros.github.io/WbGit/Adam/Snd/ASnd.html#l112"></span><span class=cB6>music</a></span><span class=cB0>.cur_song,doc_e-&gt;aux_str)</span><span class=cB7>)</span><span class=cB0>)
<a name="l1181"></a>        {
<a name="l1182"></a>          <a href="http://tinkeros.github.io/WbGit/Kernel/Mem/MAllocFree.html#l415"></span><span class=cB5>Free</a></span><span class=cB0>(<a href="http://tinkeros.github.io/WbGit/Adam/Snd/ASnd.html#l112"></span><span class=cB6>music</a></span><span class=cB0>.cur_song);
<a name="l1183"></a>          <a href="http://tinkeros.github.io/WbGit/Adam/Snd/ASnd.html#l334"></span><span class=cB5>MusicSettingsRst</a></span><span class=cB0>;
<a name="l1184"></a>          <a href="http://tinkeros.github.io/WbGit/Adam/Snd/ASnd.html#l112"></span><span class=cB6>music</a></span><span class=cB0>.cur_song=<a href="http://tinkeros.github.io/WbGit/Kernel/Mem/MAllocFree.html#l496"></span><span class=cB5>AStrNew</a></span><span class=cB0>(doc_e-&gt;aux_str);
<a name="l1185"></a>        }
<a name="l1186"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l1187"></a>      doc-&gt;flags|=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1386"></span><span class=cB3>DOCF_HAS_SONG</a></span><span class=cB0>;
<a name="l1188"></a>      </span><span class=cB1>break</span><span class=cB0>;
<a name="l1189"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1046"></span><span class=cB3>DOCT_HTML_CODE</a></span><span class=cB0>:
<a name="l1190"></a>      </span><span class=cB1>if</span><span class=cB0> (recalc_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1466"></span><span class=cB3>RECALCF_TO_HTML</a></span><span class=cB0> &amp;&amp;
<a name="l1191"></a>          doc_e-&gt;de_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1070"></span><span class=cB3>DOCEF_TAG</a></span><span class=cB0> &amp;&amp; doc_e-&gt;tag)
<a name="l1192"></a>        x-=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l61"></span><span class=cB5>StrLen</a></span><span class=cB0>(doc_e-&gt;tag);
<a name="l1193"></a>      </span><span class=cB1>break</span><span class=cB0>;
<a name="l1194"></a>    </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1049"></span><span class=cB3>DOCT_TYPES_NUM</a></span><span class=cB0>-1: </span><span class=cB2>//nobound switch</span><span class=cB0>
<a name="l1195"></a>    </span><span class=cB1>default</span><span class=cB0>:
<a name="l1196"></a>      </span><span class=cB1>break</span><span class=cB0>;
<a name="l1197"></a>    }
<a name="l1198"></a>    </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1107"></span><span class=cB3>DOCEF_HAS_BORDER</a></span><span class=cB0>)
<a name="l1199"></a>      <a href="http://tinkeros.github.io/WbGit/Kernel/GrTextBase.html#l329"></span><span class=cB5>TextBorder</a></span><span class=cB0>(win_task,doc_e-&gt;x-x0,x-x0-1,doc_e-&gt;y-y0,y-y0,
<a name="l1200"></a>                 tmp_u32_attr.u8[1],<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l122"></span><span class=cB5>ToBool</a></span><span class=cB7>(</span><span class=cB0>doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1108"></span><span class=cB3>DOCEF_SOLID_BORDER</a></span><span class=cB7>)</span><span class=cB0>);
<a name="l1201"></a>    </span><span class=cB1>if</span><span class=cB0> (full_refresh)
<a name="l1202"></a>    {
<a name="l1203"></a>      </span><span class=cB1>switch</span><span class=cB0> (doc_e-&gt;type_u8)
<a name="l1204"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l1205"></a>      </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1036"></span><span class=cB3>DOCT_CHECK_BOX</a></span><span class=cB0>:
<a name="l1206"></a>        doc_e-&gt;max_col=2;
<a name="l1207"></a>        </span><span class=cB1>break</span><span class=cB0>;
<a name="l1208"></a>      </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1037"></span><span class=cB3>DOCT_LST</a></span><span class=cB0>:
<a name="l1209"></a>      </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1041"></span><span class=cB3>DOCT_TREE</a></span><span class=cB0>:
<a name="l1210"></a>      </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1034"></span><span class=cB3>DOCT_BTTN</a></span><span class=cB0>:
<a name="l1211"></a>      </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1033"></span><span class=cB3>DOCT_LINK</a></span><span class=cB0>:
<a name="l1212"></a>      </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1039"></span><span class=cB3>DOCT_MENU_VAL</a></span><span class=cB0>:
<a name="l1213"></a>      </span><span class=cB1>case</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1038"></span><span class=cB3>DOCT_MACRO</a></span><span class=cB0>:
<a name="l1214"></a>        doc_e-&gt;max_col=1;
<a name="l1215"></a>        </span><span class=cB1>break</span><span class=cB0>;
<a name="l1216"></a>      </span><span class=cB1>default</span><span class=cB0>:
<a name="l1217"></a>        </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; </span><span class=cB7>(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1121"></span><span class=cB3>DOCEF_TREE</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1122"></span><span class=cB3>DOCEF_LST</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l1218"></a>          doc_e-&gt;max_col=1;
<a name="l1219"></a>        </span><span class=cB1>else</span><span class=cB0>
<a name="l1220"></a>          doc_e-&gt;max_col=col2;
<a name="l1221"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l1222"></a>      </span><span class=cB1>if</span><span class=cB0> (x&gt;doc-&gt;max_x) doc-&gt;max_x=x;
<a name="l1223"></a>      </span><span class=cB1>if</span><span class=cB0> (y&gt;doc-&gt;max_y) doc-&gt;max_y=y;
<a name="l1224"></a>      </span><span class=cB1>if</span><span class=cB0> (<a href="http://tinkeros.github.io/WbGit/Kernel/KDbg.html#l192"></span><span class=cB5>D</a></span><span class=cB0>&lt;=best_d &amp;&amp; !</span><span class=cB7>(</span><span class=cB0>doc_e-&gt;de_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1127"></span><span class=cB3>DOCEF_NO_CLICK_ON</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l1225"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l1226"></a>        best_d=<a href="http://tinkeros.github.io/WbGit/Kernel/KDbg.html#l192"></span><span class=cB5>D</a></span><span class=cB0>;
<a name="l1227"></a>        best_doc_e=doc_e;
<a name="l1228"></a>        best_col=col;
<a name="l1229"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l1230"></a>      </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1121"></span><span class=cB3>DOCEF_TREE</a></span><span class=cB0>)
<a name="l1231"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l1232"></a>        </span><span class=cB1>if</span><span class=cB0> (doc_e-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1110"></span><span class=cB3>DOCEF_CHECKED_COLLAPSED</a></span><span class=cB0>)
<a name="l1233"></a>          tree_collapsed=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l22"></span><span class=cB3>TRUE</a></span><span class=cB0>;
<a name="l1234"></a>        </span><span class=cB1>else</span><span class=cB0>
<a name="l1235"></a>          tree_collapsed=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l23"></span><span class=cB3>FALSE</a></span><span class=cB0>;
<a name="l1236"></a>        doc_e2=doc_e-&gt;next;
<a name="l1237"></a>        </span><span class=cB1>while</span><span class=cB0> (doc_e2!=doc &amp;&amp; doc_e2-&gt;type_u8!=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1019"></span><span class=cB3>DOCT_INDENT</a></span><span class=cB0> &amp;&amp;
<a name="l1238"></a>               !</span><span class=cB7>(</span><span class=cB0>doc_e2-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1121"></span><span class=cB3>DOCEF_TREE</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l1239"></a>          doc_e2=doc_e2-&gt;next;
<a name="l1240"></a>        </span><span class=cB1>if</span><span class=cB0> (doc_e2-&gt;type_u8==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1019"></span><span class=cB3>DOCT_INDENT</a></span><span class=cB0>)
<a name="l1241"></a>        {
<a name="l1242"></a>          j=i=s-&gt;indent;
<a name="l1243"></a>          </span><span class=cB1>do</span><span class=cB0>
<a name="l1244"></a>          </span><span class=cB7>{</span><span class=cB0>
<a name="l1245"></a>            </span><span class=cB1>if</span><span class=cB0> (tree_collapsed)
<a name="l1246"></a>              doc_e2-&gt;de_flags|=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1123"></span><span class=cB3>DOCEF_SKIP</a></span><span class=cB0>;
<a name="l1247"></a>            </span><span class=cB1>else</span><span class=cB0>
<a name="l1248"></a>              doc_e2-&gt;de_flags&amp;=~<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1123"></span><span class=cB3>DOCEF_SKIP</a></span><span class=cB0>;
<a name="l1249"></a>            </span><span class=cB1>if</span><span class=cB0> (doc_e2-&gt;type_u8==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1019"></span><span class=cB3>DOCT_INDENT</a></span><span class=cB0>)
<a name="l1250"></a>            {
<a name="l1251"></a>              </span><span class=cB1>if</span><span class=cB0> (doc_e2-&gt;de_flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1092"></span><span class=cB3>DOCEF_LEFT_X</a></span><span class=cB0>)
<a name="l1252"></a>                j=doc_e2-&gt;attr;
<a name="l1253"></a>              </span><span class=cB1>else</span><span class=cB0>
<a name="l1254"></a>                j+=doc_e2-&gt;attr;
<a name="l1255"></a>            }
<a name="l1256"></a>            doc_e2=doc_e2-&gt;next;
<a name="l1257"></a>          </span><span class=cB7>}</span><span class=cB0>
<a name="l1258"></a>          </span><span class=cB1>while</span><span class=cB0> (doc_e2!=doc &amp;&amp; j&gt;i);
<a name="l1259"></a>        }
<a name="l1260"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l1261"></a>    }
<a name="l1262"></a>    doc_e2=doc_e-&gt;next;
<a name="l1263"></a>rc_skip:
<a name="l1264"></a>    </span><span class=cB1>while</span><span class=cB0> (doc_e2!=doc &amp;&amp; doc_e2-&gt;de_flags&amp;</span><span class=cB7>(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1123"></span><span class=cB3>DOCEF_SKIP</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1126"></span><span class=cB3>DOCEF_FILTER_SKIP</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l1265"></a>    {
<a name="l1266"></a>      </span><span class=cB1>if</span><span class=cB0> (doc_e2==doc-&gt;cur_entry)
<a name="l1267"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l1268"></a>        doc-&gt;cur_entry=doc_e2-&gt;next;
<a name="l1269"></a>        doc-&gt;cur_col=doc-&gt;cur_entry-&gt;min_col;
<a name="l1270"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l1271"></a>      </span><span class=cB1>if</span><span class=cB0> (full_refresh)
<a name="l1272"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l1273"></a>        doc_e2-&gt;x=x;
<a name="l1274"></a>        doc_e2-&gt;y=y;
<a name="l1275"></a>        doc_e2-&gt;page_line_num=doc-&gt;page_line_num;
<a name="l1276"></a>        <a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l174"></span><span class=cB5>MemCpy64</a></span><span class=cB0>(&amp;doc_e2-&gt;settings,s,</span><span class=cB1>sizeof</span><span class=cB7>(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1258"></span><span class=cB9>CDocSettings</a></span><span class=cB7>)</span><span class=cB0>/8);
<a name="l1277"></a>        doc_e2-&gt;type.u8[1]=cur_u8_attr;
<a name="l1278"></a>        doc_e2-&gt;de_flags=doc-&gt;flags
<a name="l1279"></a>                         &amp;(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1056"></span><span class=cB3>DOCG_BL_IV_UL</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1145"></span><span class=cB3>DOCEF_WORD_WRAP</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1144"></span><span class=cB3>DOCEF_HIGHLIGHT</a></span><span class=cB0>) |
<a name="l1280"></a>                         doc_e2-&gt;de_flags&amp;~(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1056"></span><span class=cB3>DOCG_BL_IV_UL</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1145"></span><span class=cB3>DOCEF_WORD_WRAP</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1144"></span><span class=cB3>DOCEF_HIGHLIGHT</a></span><span class=cB0>);
<a name="l1281"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l1282"></a>      doc_e2=doc_e2-&gt;next;
<a name="l1283"></a>    }
<a name="l1284"></a>    </span><span class=cB1>if</span><span class=cB0> (full_refresh)
<a name="l1285"></a>    {
<a name="l1286"></a>      </span><span class=cB1>if</span><span class=cB0> (del_doc_e)
<a name="l1287"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l1288"></a>        </span><span class=cB1>if</span><span class=cB0> (!</span><span class=cB7>(</span><span class=cB0>doc_e-&gt;de_flags &amp; (<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1120"></span><span class=cB3>DOCEF_HOLD</a></span><span class=cB0>|<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1126"></span><span class=cB3>DOCEF_FILTER_SKIP</a></span><span class=cB0>)</span><span class=cB7>)</span><span class=cB0>)
<a name="l1289"></a>        {
<a name="l1290"></a>          </span><span class=cB1>if</span><span class=cB0> (doc_e==doc-&gt;cur_entry)
<a name="l1291"></a>          </span><span class=cB7>{</span><span class=cB0>
<a name="l1292"></a>            doc-&gt;cur_entry=doc_e2;
<a name="l1293"></a>            doc-&gt;cur_col=doc_e2-&gt;min_col;
<a name="l1294"></a>          </span><span class=cB7>}</span><span class=cB0>
<a name="l1295"></a>          </span><span class=cB1>if</span><span class=cB0> (best_doc_e==doc_e)
<a name="l1296"></a>          </span><span class=cB7>{</span><span class=cB0>
<a name="l1297"></a>            best_doc_e=doc_e2;
<a name="l1298"></a>            best_col=doc_e2-&gt;min_col;  </span><span class=cB2>//TODO: might be bug</span><span class=cB0>
<a name="l1299"></a>          </span><span class=cB7>}</span><span class=cB0>
<a name="l1300"></a>          <a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocNew.html#l67"></span><span class=cB5>DocEntryDel</a></span><span class=cB0>(doc,doc_e);
<a name="l1301"></a>        }
<a name="l1302"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l1303"></a>    }
<a name="l1304"></a>    num_entries++;
<a name="l1305"></a>    </span><span class=cB1>if</span><span class=cB0> (!full_refresh &amp;&amp; doc_e-&gt;y&gt;y_plot_bottom)
<a name="l1306"></a>      </span><span class=cB1>break</span><span class=cB0>;
<a name="l1307"></a>    doc_e=doc_e2;
<a name="l1308"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l1309"></a>  </span><span class=cB1>if</span><span class=cB0> (full_refresh)
<a name="l1310"></a>  </span><span class=cB7>{</span><span class=cB0>
<a name="l1311"></a>    </span><span class=cB1>if</span><span class=cB0> (doc-&gt;cur_entry==doc &amp;&amp; recalc_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1465"></span><span class=cB3>RECALCF_ADD_CURSOR</a></span><span class=cB0>)
<a name="l1312"></a>    {
<a name="l1313"></a>      doc_e2=<a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocNew.html#l42"></span><span class=cB5>DocEntryNewBase</a></span><span class=cB0>(doc,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1010"></span><span class=cB3>DOCT_CURSOR</a></span><span class=cB0>,,x,y,doc-&gt;page_line_num);
<a name="l1314"></a>      <a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l174"></span><span class=cB5>MemCpy64</a></span><span class=cB0>(&amp;doc_e2-&gt;settings,s,</span><span class=cB1>sizeof</span><span class=cB7>(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1258"></span><span class=cB9>CDocSettings</a></span><span class=cB7>)</span><span class=cB0>/8);
<a name="l1315"></a>      <a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l70"></span><span class=cB5>QueInsRev</a></span><span class=cB0>(doc_e2,doc);
<a name="l1316"></a>    }
<a name="l1317"></a>    </span><span class=cB1>if</span><span class=cB0> (doc-&gt;min_x&gt;doc-&gt;max_x)
<a name="l1318"></a>    {
<a name="l1319"></a>      doc-&gt;max_x=0;
<a name="l1320"></a>      doc-&gt;min_x=0;
<a name="l1321"></a>    }
<a name="l1322"></a>    </span><span class=cB1>if</span><span class=cB0> (doc-&gt;min_y&gt;doc-&gt;max_y)
<a name="l1323"></a>    {
<a name="l1324"></a>      doc-&gt;max_y=0;
<a name="l1325"></a>      doc-&gt;min_y=0;
<a name="l1326"></a>    }
<a name="l1327"></a>    </span><span class=cB2>//Update header</span><span class=cB0>
<a name="l1328"></a>    </span><span class=cB1>if</span><span class=cB0> (!skipped_update)
<a name="l1329"></a>    {
<a name="l1330"></a>      doc_e-&gt;x=x;
<a name="l1331"></a>      doc_e-&gt;y=y;
<a name="l1332"></a>      doc_e-&gt;page_line_num=doc-&gt;page_line_num;
<a name="l1333"></a>      <a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l174"></span><span class=cB5>MemCpy64</a></span><span class=cB0>(&amp;doc_e-&gt;settings,s,</span><span class=cB1>sizeof</span><span class=cB7>(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1258"></span><span class=cB9>CDocSettings</a></span><span class=cB7>)</span><span class=cB0>/8);
<a name="l1334"></a>      doc_e-&gt;type.u8[1]=cur_u8_attr;
<a name="l1335"></a>      </span><span class=cB1>if</span><span class=cB0> (find_cursor)
<a name="l1336"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l1337"></a>        <a href="http://tinkeros.github.io/WbGit/Kernel/KDbg.html#l192"></span><span class=cB5>D</a></span><span class=cB0>=<a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocRecalcLib.html#l3"></span><span class=cB5>DocCharDist</a></span><span class=cB0>(doc,x,y);
<a name="l1338"></a>        </span><span class=cB1>if</span><span class=cB0> (<a href="http://tinkeros.github.io/WbGit/Kernel/KDbg.html#l192"></span><span class=cB5>D</a></span><span class=cB0>&lt;best_d &amp;&amp; !</span><span class=cB7>(</span><span class=cB0>doc_e-&gt;de_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1127"></span><span class=cB3>DOCEF_NO_CLICK_ON</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l1339"></a>        {
<a name="l1340"></a>          best_d=<a href="http://tinkeros.github.io/WbGit/Kernel/KDbg.html#l192"></span><span class=cB5>D</a></span><span class=cB0>;
<a name="l1341"></a>          best_doc_e=doc_e;
<a name="l1342"></a>          best_col=0;
<a name="l1343"></a>        }
<a name="l1344"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l1345"></a>    }
<a name="l1346"></a>    </span><span class=cB1>if</span><span class=cB0> (doc-&gt;flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1380"></span><span class=cB3>DOCF_SIZE_MIN</a></span><span class=cB0>)
<a name="l1347"></a>    {
<a name="l1348"></a>      </span><span class=cB1>if</span><span class=cB0> (<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l14"></span><span class=cB5>Bt</a></span><span class=cB7>(</span><span class=cB0>&amp;win_task-&gt;display_flags,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l3990"></span><span class=cB3>DISPLAYf_NO_BORDER</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l1349"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l1350"></a>        </span><span class=cB1>if</span><span class=cB0> (left&lt;0)
<a name="l1351"></a>          left=0;
<a name="l1352"></a>        i=left+doc-&gt;max_x-doc-&gt;min_x;
<a name="l1353"></a>        </span><span class=cB1>if</span><span class=cB0> (i&gt;<a href="http://tinkeros.github.io/WbGit/Adam/Gr/GrGlbls.html#l18"></span><span class=cB3>TEXT_COLS</a></span><span class=cB0>-1)
<a name="l1354"></a>          i=<a href="http://tinkeros.github.io/WbGit/Adam/Gr/GrGlbls.html#l18"></span><span class=cB3>TEXT_COLS</a></span><span class=cB0>-1;
<a name="l1355"></a>        <a href="http://tinkeros.github.io/WbGit/Adam/Win.html#l414"></span><span class=cB5>WinHorz</a></span><span class=cB0>(left,i,win_task);
<a name="l1356"></a>        </span><span class=cB1>if</span><span class=cB0> (top&lt;0)
<a name="l1357"></a>          top=0;
<a name="l1358"></a>        i=top+doc-&gt;max_y-doc-&gt;min_y;
<a name="l1359"></a>        </span><span class=cB1>if</span><span class=cB0> (i&gt;<a href="http://tinkeros.github.io/WbGit/Adam/Gr/GrGlbls.html#l16"></span><span class=cB3>TEXT_ROWS</a></span><span class=cB0>-1)
<a name="l1360"></a>          i=<a href="http://tinkeros.github.io/WbGit/Adam/Gr/GrGlbls.html#l16"></span><span class=cB3>TEXT_ROWS</a></span><span class=cB0>-1;
<a name="l1361"></a>        <a href="http://tinkeros.github.io/WbGit/Adam/Win.html#l454"></span><span class=cB5>WinVert</a></span><span class=cB0>(top,i,win_task);
<a name="l1362"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l1363"></a>      </span><span class=cB1>else</span><span class=cB0>
<a name="l1364"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l1365"></a>        </span><span class=cB1>if</span><span class=cB0> (left&lt;1)
<a name="l1366"></a>          left=1;
<a name="l1367"></a>        i=left+doc-&gt;max_x-doc-&gt;min_x;
<a name="l1368"></a>        </span><span class=cB1>if</span><span class=cB0> (i&gt;<a href="http://tinkeros.github.io/WbGit/Adam/Gr/GrGlbls.html#l18"></span><span class=cB3>TEXT_COLS</a></span><span class=cB0>-2)
<a name="l1369"></a>          i=<a href="http://tinkeros.github.io/WbGit/Adam/Gr/GrGlbls.html#l18"></span><span class=cB3>TEXT_COLS</a></span><span class=cB0>-2;
<a name="l1370"></a>        <a href="http://tinkeros.github.io/WbGit/Adam/Win.html#l414"></span><span class=cB5>WinHorz</a></span><span class=cB0>(left,i,win_task);
<a name="l1371"></a>        </span><span class=cB1>if</span><span class=cB0> (top&lt;1)
<a name="l1372"></a>          top=1;
<a name="l1373"></a>        i=top+doc-&gt;max_y-doc-&gt;min_y;
<a name="l1374"></a>        </span><span class=cB1>if</span><span class=cB0> (i&gt;<a href="http://tinkeros.github.io/WbGit/Adam/Gr/GrGlbls.html#l16"></span><span class=cB3>TEXT_ROWS</a></span><span class=cB0>-2)
<a name="l1375"></a>          i=<a href="http://tinkeros.github.io/WbGit/Adam/Gr/GrGlbls.html#l16"></span><span class=cB3>TEXT_ROWS</a></span><span class=cB0>-2;
<a name="l1376"></a>        <a href="http://tinkeros.github.io/WbGit/Adam/Win.html#l454"></span><span class=cB5>WinVert</a></span><span class=cB0>(top,i,win_task);
<a name="l1377"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l1378"></a>    }
<a name="l1379"></a>    </span><span class=cB1>if</span><span class=cB0> (find_cursor)
<a name="l1380"></a>    {
<a name="l1381"></a>      doc-&gt;cur_entry=best_doc_e;
<a name="l1382"></a>      doc-&gt;cur_col=best_col;
<a name="l1383"></a>      <a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocForm.html#l38"></span><span class=cB5>DocFormBwd</a></span><span class=cB0>(doc);
<a name="l1384"></a></span><span class=cB2>//We need this because text coordinates are used</span><span class=cB0>
<a name="l1385"></a>      </span><span class=cB1>if</span><span class=cB0> (best_d&lt;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l4305"></span><span class=cB3>FONT_WIDTH</a></span><span class=cB0>)
<a name="l1386"></a>        best_d=0;
<a name="l1387"></a>      doc-&gt;best_d=best_d;
<a name="l1388"></a>    }
<a name="l1389"></a>    </span><span class=cB1>if</span><span class=cB0> (doc-&gt;cur_entry-&gt;type_u8!=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1040"></span><span class=cB3>DOCT_HEX_ED</a></span><span class=cB0>)
<a name="l1390"></a>    {
<a name="l1391"></a>      doc-&gt;y=doc-&gt;cur_entry-&gt;y;
<a name="l1392"></a>      doc-&gt;x=doc-&gt;cur_entry-&gt;x+doc-&gt;cur_col;
<a name="l1393"></a>    }
<a name="l1394"></a>    </span><span class=cB1>else</span><span class=cB0>
<a name="l1395"></a>    {
<a name="l1396"></a>      doc-&gt;y=doc-&gt;cur_entry-&gt;y+doc-&gt;cur_col/3/doc-&gt;cur_entry-&gt;hex_ed_width;
<a name="l1397"></a>      x=doc-&gt;cur_col%(doc-&gt;cur_entry-&gt;hex_ed_width*3);
<a name="l1398"></a>      i=x/doc-&gt;cur_entry-&gt;hex_ed_width;
<a name="l1399"></a>      doc-&gt;x=doc-&gt;cur_entry-&gt;x+9;
<a name="l1400"></a>      </span><span class=cB1>if</span><span class=cB0> (i&lt;2)
<a name="l1401"></a>        doc-&gt;x+=x&gt;&gt;1*3+x&amp;1;
<a name="l1402"></a>      </span><span class=cB1>else</span><span class=cB0>
<a name="l1403"></a>        doc-&gt;x+=doc-&gt;cur_entry-&gt;hex_ed_width*3+
<a name="l1404"></a>                (x-doc-&gt;cur_entry-&gt;hex_ed_width&lt;&lt;1);
<a name="l1405"></a>    }
<a name="l1406"></a>    doc-&gt;line=doc-&gt;y+1;
<a name="l1407"></a>    doc-&gt;col=doc-&gt;x+1;
<a name="l1408"></a>    </span><span class=cB1>if</span><span class=cB0> (recalc_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1464"></span><span class=cB3>RECALCF_HAS_CURSOR</a></span><span class=cB0>)
<a name="l1409"></a>    {
<a name="l1410"></a>      </span><span class=cB1>if</span><span class=cB0> (recalc_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1462"></span><span class=cB3>RECALCG_MASK</a></span><span class=cB0>==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1461"></span><span class=cB3>RECALCt_TO_SCRN</a></span><span class=cB0>)
<a name="l1411"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l1412"></a>        x=0;
<a name="l1413"></a>        y=0;
<a name="l1414"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l1415"></a>      </span><span class=cB1>else</span><span class=cB0>
<a name="l1416"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l1417"></a>        x=scroll_x/<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l4305"></span><span class=cB3>FONT_WIDTH</a></span><span class=cB0>;
<a name="l1418"></a>        y=scroll_y/<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l4306"></span><span class=cB3>FONT_HEIGHT</a></span><span class=cB0>;
<a name="l1419"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l1420"></a>      </span><span class=cB1>if</span><span class=cB0> (doc-&gt;top_line_num-y+height-1&gt;doc-&gt;max_y)
<a name="l1421"></a>        doc-&gt;top_line_num=doc-&gt;max_y-(height-1)+y;
<a name="l1422"></a>      </span><span class=cB1>if</span><span class=cB0> (doc-&gt;top_line_num-y&lt;doc-&gt;min_y)
<a name="l1423"></a>        doc-&gt;top_line_num=doc-&gt;min_y+y;
<a name="l1424"></a>      </span><span class=cB1>if</span><span class=cB0> (doc-&gt;y-doc-&gt;top_line_num+y&gt;height-1)
<a name="l1425"></a>        doc-&gt;top_line_num=doc-&gt;y-(height-1)+y;
<a name="l1426"></a>      </span><span class=cB1>if</span><span class=cB0> (doc-&gt;y-doc-&gt;top_line_num+y&lt;0)
<a name="l1427"></a>        doc-&gt;top_line_num=doc-&gt;y+y;
<a name="l1428"></a>      </span><span class=cB1>if</span><span class=cB0> (doc-&gt;line_start_col-x+width-1&gt;doc-&gt;max_x)
<a name="l1429"></a>        doc-&gt;line_start_col=doc-&gt;max_x-(width-1)+x;
<a name="l1430"></a>      </span><span class=cB1>if</span><span class=cB0> (doc-&gt;line_start_col-x&lt;doc-&gt;min_x)
<a name="l1431"></a>        doc-&gt;line_start_col=doc-&gt;min_x+x;
<a name="l1432"></a>      </span><span class=cB1>if</span><span class=cB0> (doc-&gt;x-doc-&gt;line_start_col+x&gt;width-1)
<a name="l1433"></a>        doc-&gt;line_start_col=doc-&gt;x-(width-1)+x;
<a name="l1434"></a>      </span><span class=cB1>if</span><span class=cB0> (doc-&gt;x-doc-&gt;line_start_col+x&lt;0)
<a name="l1435"></a>        doc-&gt;line_start_col=doc-&gt;x+x;
<a name="l1436"></a>    }
<a name="l1437"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l1438"></a>  </span><span class=cB1>if</span><span class=cB0> (recalc_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1462"></span><span class=cB3>RECALCG_MASK</a></span><span class=cB0>==<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1461"></span><span class=cB3>RECALCt_TO_SCRN</a></span><span class=cB0> &amp;&amp;
<a name="l1439"></a>      recalc_flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1464"></span><span class=cB3>RECALCF_HAS_CURSOR</a></span><span class=cB0>)
<a name="l1440"></a>  </span><span class=cB7>{</span><span class=cB0>
<a name="l1441"></a>    x=doc-&gt;x-doc-&gt;line_start_col+left +scroll_x/<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l4305"></span><span class=cB3>FONT_WIDTH</a></span><span class=cB0>;
<a name="l1442"></a>    y=doc-&gt;y-doc-&gt;top_line_num+top+scroll_y/<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l4306"></span><span class=cB3>FONT_HEIGHT</a></span><span class=cB0>;
<a name="l1443"></a>    </span><span class=cB1>if</span><span class=cB0> (0&lt;=x&lt;=right &amp;&amp; 0&lt;=y&lt;=bottom &amp;&amp;
<a name="l1444"></a>        x&lt;<a href="http://tinkeros.github.io/WbGit/Adam/Gr/GrGlbls.html#l18"></span><span class=cB3>TEXT_COLS</a></span><span class=cB0> &amp;&amp; y&lt;<a href="http://tinkeros.github.io/WbGit/Adam/Gr/GrGlbls.html#l16"></span><span class=cB3>TEXT_ROWS</a></span><span class=cB0> &amp;&amp;
<a name="l1445"></a>        !</span><span class=cB7>(</span><span class=cB0>doc-&gt;flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1381"></span><span class=cB3>DOCF_HIDE_CURSOR</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l1446"></a>    {
<a name="l1447"></a>      u32_ptr=<a href="http://tinkeros.github.io/WbGit/Kernel/KGlbls.html#l15"></span><span class=cB6>gr</a></span><span class=cB0>.text_base+y*<a href="http://tinkeros.github.io/WbGit/Adam/Gr/GrGlbls.html#l18"></span><span class=cB3>TEXT_COLS</a></span><span class=cB0>+x;
<a name="l1448"></a>      *u32_ptr|=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1052"></span><span class=cB3>DOCET_BLINK</a></span><span class=cB0>;
<a name="l1449"></a>      *u32_ptr^=0xFF00;
<a name="l1450"></a>    }
<a name="l1451"></a>    </span><span class=cB1>if</span><span class=cB0> (full_refresh)
<a name="l1452"></a>    {
<a name="l1453"></a>      </span><span class=cB1>if</span><span class=cB0> (!</span><span class=cB7>(</span><span class=cB0>doc-&gt;flags&amp;<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1383"></span><span class=cB3>DOCF_NO_SCROLL_BARS</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l1454"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l1455"></a>        </span><span class=cB1>if</span><span class=cB0> (!<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l14"></span><span class=cB5>Bt</a></span><span class=cB7>(</span><span class=cB0>&amp;hss-&gt;flags,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l3789"></span><span class=cB3>WSSf_SET_TO_POS</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l1456"></a>        {
<a name="l1457"></a>          hss-&gt;min=doc-&gt;min_x;
<a name="l1458"></a>          </span><span class=cB1>if</span><span class=cB0> (doc-&gt;max_x-width+1&lt;hss-&gt;min)
<a name="l1459"></a>            hss-&gt;max=hss-&gt;min;
<a name="l1460"></a>          </span><span class=cB1>else</span><span class=cB0>
<a name="l1461"></a>            hss-&gt;max=doc-&gt;max_x-width+1;
<a name="l1462"></a>          hss-&gt;pos=doc-&gt;line_start_col;
<a name="l1463"></a>        }
<a name="l1464"></a>        </span><span class=cB1>if</span><span class=cB0> (!<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l14"></span><span class=cB5>Bt</a></span><span class=cB7>(</span><span class=cB0>&amp;vss-&gt;flags,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l3789"></span><span class=cB3>WSSf_SET_TO_POS</a></span><span class=cB7>)</span><span class=cB0>)
<a name="l1465"></a>        {
<a name="l1466"></a>          vss-&gt;min=doc-&gt;min_y;
<a name="l1467"></a>          </span><span class=cB1>if</span><span class=cB0> (doc-&gt;max_y-height+1&lt;vss-&gt;min)
<a name="l1468"></a>            vss-&gt;max=vss-&gt;min;
<a name="l1469"></a>          </span><span class=cB1>else</span><span class=cB0>
<a name="l1470"></a>            vss-&gt;max=doc-&gt;max_y-height+1;
<a name="l1471"></a>          vss-&gt;pos=doc-&gt;top_line_num;
<a name="l1472"></a>        }
<a name="l1473"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l1474"></a>      <a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l34"></span><span class=cB5>LBEqu</a></span><span class=cB0>(&amp;doc-&gt;flags,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1424"></span><span class=cB3>DOCf_MORE</a></span><span class=cB0>,more);
<a name="l1475"></a>    }
<a name="l1476"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l1477"></a>  </span><span class=cB1>if</span><span class=cB0> (!same_win)
<a name="l1478"></a>  </span><span class=cB7>{</span><span class=cB0>
<a name="l1479"></a>    doc-&gt;old_win_top=top;
<a name="l1480"></a>    doc-&gt;old_win_bottom=bottom;
<a name="l1481"></a>    doc-&gt;old_win_left=left;
<a name="l1482"></a>    doc-&gt;old_win_right=right;
<a name="l1483"></a>    doc-&gt;old_cur_entry=doc-&gt;cur_entry;
<a name="l1484"></a>    doc-&gt;old_cur_col=doc-&gt;old_cur_col;
<a name="l1485"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l1486"></a>  </span><span class=cB1>if</span><span class=cB0> (doc-&gt;flags &amp; <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l1386"></span><span class=cB3>DOCF_HAS_SONG</a></span><span class=cB0>)
<a name="l1487"></a>    <a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l26"></span><span class=cB5>LBts</a></span><span class=cB0>(&amp;win_task-&gt;task_flags,<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l3976"></span><span class=cB3>TASKf_HAS_SONG</a></span><span class=cB0>);
<a name="l1488"></a>  </span><span class=cB1>if</span><span class=cB0> (full_refresh)
<a name="l1489"></a>  </span><span class=cB7>{</span><span class=cB0>
<a name="l1490"></a>    i=num_entries-doc-&gt;max_entries;
<a name="l1491"></a>    </span><span class=cB1>if</span><span class=cB0> (next_clear_found)
<a name="l1492"></a>    {
<a name="l1493"></a>      <a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocRecalcLib.html#l28"></span><span class=cB5>DocDelToEntry</a></span><span class=cB0>(doc,next_clear_found,clear_holds);
<a name="l1494"></a>      <a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocRecalc.html#l294"></span><span class=cB5>DocRecalc</a></span><span class=cB0>(doc,recalc_flags);
<a name="l1495"></a>    }
<a name="l1496"></a>    </span><span class=cB1>else</span><span class=cB0> </span><span class=cB1>if</span><span class=cB0> (i&gt;1024)
<a name="l1497"></a>    {
<a name="l1498"></a>      <a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocRecalcLib.html#l9"></span><span class=cB5>DocDelToNum</a></span><span class=cB0>(doc,i);
<a name="l1499"></a>      <a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocRecalc.html#l294"></span><span class=cB5>DocRecalc</a></span><span class=cB0>(doc,recalc_flags);
<a name="l1500"></a>    }
<a name="l1501"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l1502"></a>  <a href="http://tinkeros.github.io/WbGit/Adam/Gr/GrDC.html#l223"></span><span class=cB5>DCDel</a></span><span class=cB0>(dc);
<a name="l1503"></a>  <a href="http://tinkeros.github.io/WbGit/Kernel/Mem/MAllocFree.html#l415"></span><span class=cB5>Free</a></span><span class=cB0>(depth_buf);
<a name="l1504"></a>  </span><span class=cB1>if</span><span class=cB0> (unlock)
<a name="l1505"></a>    <a href="http://tinkeros.github.io/WbGit/Adam/DolDoc/DocNew.html#l18"></span><span class=cB5>DocUnlock</a></span><span class=cB0>(doc);
<a name="l1506"></a>  </span><span class=cB1>return</span><span class=cB0> <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l22"></span><span class=cB3>TRUE</a></span><span class=cB0>;
<a name="l1507"></a>}
</span></div></pre></body>
</html>
