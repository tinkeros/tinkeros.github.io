<!DOCTYPE HTML>
<html style="background-color:#FFFFFF;">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=US-ASCII">
<title>The Temple Operating System</title>
<meta name="keywords" content="Operating System,64-Bit,64 Bit,Temple,OS,TempleOS,Free,Open Source,Public Domain,x86_64">
<meta name="generator" content="TinkerOS V5.19">
<style type="text/css">
.cB0{color:#000000;background-color:#55ffff;}
.cB1{color:#0000aa;background-color:#55ffff;}
.cB2{color:#00aa00;background-color:#55ffff;}
.cB3{color:#00aaaa;background-color:#55ffff;}
.cB5{color:#aa00aa;background-color:#55ffff;}
.cB6{color:#aa5500;background-color:#55ffff;}
.cB7{color:#aaaaaa;background-color:#55ffff;}
.cB9{color:#5555ff;background-color:#55ffff;}
.cF0{color:#000000;background-color:#ffffff;}
.cF1{color:#0000aa;background-color:#ffffff;}
.cF2{color:#00aa00;background-color:#ffffff;}
.cF3{color:#00aaaa;background-color:#ffffff;}
.cF4{color:#aa0000;background-color:#ffffff;}
.cF5{color:#aa00aa;background-color:#ffffff;}
.cF6{color:#aa5500;background-color:#ffffff;}
.cF7{color:#aaaaaa;background-color:#ffffff;}
.cF8{color:#555555;background-color:#ffffff;}
.cF9{color:#5555ff;background-color:#ffffff;}
.cFA{color:#55ff55;background-color:#ffffff;}
.cFB{color:#55ffff;background-color:#ffffff;}
.cFC{color:#ff5555;background-color:#ffffff;}
.cFD{color:#ff55ff;background-color:#ffffff;}
.cFE{color:#ffff55;background-color:#ffffff;}
.cFF{color:#ffffff;background-color:#ffffff;}
</style>
</head>
<body style="background-color:#55FFFF; border-style:solid;
	  border-width:8px; border-color:#0000AA;
	  margin-left:auto; margin-right:auto; width:800px; ">
<pre style="font-family:courier;font-size:10pt;font-variant-ligatures: none;">
<div style="margin-left:auto; margin-right:auto; width: 640px;">
<a name="l1"></a><span class=cB2>// All information public domain</span><span class=cB0>
<a name="l2"></a></span><span class=cB2>// Datasheet: https://www.alsa-project.org/files/pub/datasheets/forte_media/FM801-AU-Data.PDF</span><span class=cB0>
<a name="l3"></a>
<a name="l4"></a></span><span class=cB2>// TODO Add gameport read functions</span><span class=cB0>
<a name="l5"></a>
<a name="l6"></a>#</span><span class=cB1>define</span><span class=cB0> PCIV_FM801 0x1319
<a name="l7"></a>#</span><span class=cB1>define</span><span class=cB0> PCID_FM801 0x0801
<a name="l8"></a>
<a name="l9"></a>#</span><span class=cB1>define</span><span class=cB0> FM801_PCM_VOL           0x00    </span><span class=cB2>/* PCM Output Volume */</span><span class=cB0>
<a name="l10"></a>#</span><span class=cB1>define</span><span class=cB0> FM801_FM_VOL            0x02    </span><span class=cB2>/* FM Output Volume */</span><span class=cB0>
<a name="l11"></a>#</span><span class=cB1>define</span><span class=cB0> FM801_I2S_VOL           0x04    </span><span class=cB2>/* I2S Volume */</span><span class=cB0>
<a name="l12"></a>#</span><span class=cB1>define</span><span class=cB0> FM801_REC_SRC           0x06    </span><span class=cB2>/* Record Source */</span><span class=cB0>
<a name="l13"></a>#</span><span class=cB1>define</span><span class=cB0> FM801_PLY_CTRL          0x08    </span><span class=cB2>/* Playback Control */</span><span class=cB0>
<a name="l14"></a>#</span><span class=cB1>define</span><span class=cB0> FM801_PLY_COUNT         0x0a    </span><span class=cB2>/* Playback Count */</span><span class=cB0>
<a name="l15"></a>#</span><span class=cB1>define</span><span class=cB0> FM801_PLY_BUF1          0x0c    </span><span class=cB2>/* Playback Bufer I */</span><span class=cB0>
<a name="l16"></a>#</span><span class=cB1>define</span><span class=cB0> FM801_PLY_BUF2          0x10    </span><span class=cB2>/* Playback Buffer II */</span><span class=cB0>
<a name="l17"></a>#</span><span class=cB1>define</span><span class=cB0> FM801_CAP_CTRL          0x14    </span><span class=cB2>/* Capture Control */</span><span class=cB0>
<a name="l18"></a>#</span><span class=cB1>define</span><span class=cB0> FM801_CAP_COUNT         0x16    </span><span class=cB2>/* Capture Count */</span><span class=cB0>
<a name="l19"></a>#</span><span class=cB1>define</span><span class=cB0> FM801_CAP_BUF1          0x18    </span><span class=cB2>/* Capture Buffer I */</span><span class=cB0>
<a name="l20"></a>#</span><span class=cB1>define</span><span class=cB0> FM801_CAP_BUF2          0x1c    </span><span class=cB2>/* Capture Buffer II */</span><span class=cB0>
<a name="l21"></a>#</span><span class=cB1>define</span><span class=cB0> FM801_CODEC_CTRL        0x22    </span><span class=cB2>/* Codec Control */</span><span class=cB0>
<a name="l22"></a>#</span><span class=cB1>define</span><span class=cB0> FM801_I2S_MODE          0x24    </span><span class=cB2>/* I2S Mode Control */</span><span class=cB0>
<a name="l23"></a>#</span><span class=cB1>define</span><span class=cB0> FM801_VOLUME            0x26    </span><span class=cB2>/* Volume Up/Down/Mute Status */</span><span class=cB0>
<a name="l24"></a>#</span><span class=cB1>define</span><span class=cB0> FM801_I2C_CTRL          0x29    </span><span class=cB2>/* I2C Control */</span><span class=cB0>
<a name="l25"></a>#</span><span class=cB1>define</span><span class=cB0> FM801_AC97_CMD          0x2a    </span><span class=cB2>/* AC'97 Command */</span><span class=cB0>
<a name="l26"></a>#</span><span class=cB1>define</span><span class=cB0> FM801_AC97_DATA         0x2c    </span><span class=cB2>/* AC'97 Data */</span><span class=cB0>
<a name="l27"></a>#</span><span class=cB1>define</span><span class=cB0> FM801_MPU401_DATA       0x30    </span><span class=cB2>/* MPU401 Data */</span><span class=cB0>
<a name="l28"></a>#</span><span class=cB1>define</span><span class=cB0> FM801_MPU401_CMD        0x31    </span><span class=cB2>/* MPU401 Command */</span><span class=cB0>
<a name="l29"></a>#</span><span class=cB1>define</span><span class=cB0> FM801_GPIO_CTRL         0x52    </span><span class=cB2>/* General Purpose I/O Control */</span><span class=cB0>
<a name="l30"></a>#</span><span class=cB1>define</span><span class=cB0> FM801_GEN_CTRL          0x54    </span><span class=cB2>/* General Control */</span><span class=cB0>
<a name="l31"></a>#</span><span class=cB1>define</span><span class=cB0> FM801_IRQ_MASK          0x56    </span><span class=cB2>/* Interrupt Mask */</span><span class=cB0>
<a name="l32"></a>#</span><span class=cB1>define</span><span class=cB0> FM801_IRQ_STATUS        0x5a    </span><span class=cB2>/* Interrupt Status */</span><span class=cB0>
<a name="l33"></a>#</span><span class=cB1>define</span><span class=cB0> FM801_OPL3_BANK0        0x68    </span><span class=cB2>/* OPL3 Status Read / Bank 0 Write */</span><span class=cB0>
<a name="l34"></a>#</span><span class=cB1>define</span><span class=cB0> FM801_OPL3_DATA0        0x69    </span><span class=cB2>/* OPL3 Data 0 Write */</span><span class=cB0>
<a name="l35"></a>#</span><span class=cB1>define</span><span class=cB0> FM801_OPL3_BANK1        0x6a    </span><span class=cB2>/* OPL3 Bank 1 Write */</span><span class=cB0>
<a name="l36"></a>#</span><span class=cB1>define</span><span class=cB0> FM801_OPL3_DATA1        0x6b    </span><span class=cB2>/* OPL3 Bank 1 Write */</span><span class=cB0>
<a name="l37"></a>#</span><span class=cB1>define</span><span class=cB0> FM801_POWERDOWN         0x70    </span><span class=cB2>/* Blocks Power Down Control */</span><span class=cB0>
<a name="l38"></a>
<a name="l39"></a>#</span><span class=cB1>define</span><span class=cB0> FM801_AC97_BUSY         (1&lt;&lt;9)  </span><span class=cB2>/* busy=1 */</span><span class=cB0>
<a name="l40"></a>
<a name="l41"></a></span><span class=cB1>static</span><span class=cB0> </span><span class=cB9>I64</span><span class=cB0> fm801_io_bar=0;
<a name="l42"></a></span><span class=cB1>static</span><span class=cB0> </span><span class=cB1>Bool</span><span class=cB0> codec_ok=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l22"></span><span class=cB3>TRUE</a></span><span class=cB0>;
<a name="l43"></a></span><span class=cB1>static</span><span class=cB0> </span><span class=cB1>U8</span><span class=cB0> cur_vol_percent=50;
<a name="l44"></a>
<a name="l45"></a></span><span class=cB1>static</span><span class=cB0> </span><span class=cB1>U0</span><span class=cB0> OutU16D(</span><span class=cB9>I64</span><span class=cB0> port, </span><span class=cB9>I64</span><span class=cB0> val)
<a name="l46"></a>{
<a name="l47"></a>  <a href="http://tinkeros.github.io/WbGit/Kernel/KMisc.html#l137"></span><span class=cB5>Sleep</a></span><span class=cB0>(1);
<a name="l48"></a>  <a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l78"></span><span class=cB5>OutU16</a></span><span class=cB0>(port,val);
<a name="l49"></a>}
<a name="l50"></a>
<a name="l51"></a></span><span class=cB1>public</span><span class=cB0> </span><span class=cB1>U0</span><span class=cB0> FM801SetVol(</span><span class=cB1>U8</span><span class=cB0> percent)
<a name="l52"></a>{
<a name="l53"></a>  </span><span class=cB9>I64</span><span class=cB0> vol=(31*<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l125"></span><span class=cB5>ClampI64</a></span><span class=cB7>(</span><span class=cB0>percent,0,100</span><span class=cB7>)</span><span class=cB0>/100)&amp;31;
<a name="l54"></a>  vol=31 - vol;
<a name="l55"></a>  </span><span class=cB1>if</span><span class=cB0> (percent)
<a name="l56"></a>    OutU16D(fm801_io_bar+FM801_FM_VOL, vol|vol&lt;&lt;8);
<a name="l57"></a>  </span><span class=cB1>else</span><span class=cB0>
<a name="l58"></a>    OutU16D(fm801_io_bar+FM801_FM_VOL, vol|vol&lt;&lt;8|0x8000);
<a name="l59"></a>  cur_vol_percent=percent;
<a name="l60"></a>}
<a name="l61"></a>
<a name="l62"></a></span><span class=cB1>public</span><span class=cB0> </span><span class=cB1>U8</span><span class=cB0> FM801GetVol()
<a name="l63"></a>{
<a name="l64"></a>  </span><span class=cB1>return</span><span class=cB0> cur_vol_percent;
<a name="l65"></a>}
<a name="l66"></a>
<a name="l67"></a></span><span class=cB1>static</span><span class=cB0> </span><span class=cB1>U0</span><span class=cB0> CodecWrite(</span><span class=cB9>I64</span><span class=cB0> val, </span><span class=cB9>I64</span><span class=cB0> r, </span><span class=cB9>I64</span><span class=cB0> max_tries=10)
<a name="l68"></a>{
<a name="l69"></a>  </span><span class=cB9>I64</span><span class=cB0> i,j;
<a name="l70"></a>
<a name="l71"></a>  </span><span class=cB1>if</span><span class=cB0> (!codec_ok) </span><span class=cB1>return</span><span class=cB0>;
<a name="l72"></a>
<a name="l73"></a>  </span><span class=cB1>for</span><span class=cB0> (i=0; i&lt;max_tries; i++)
<a name="l74"></a>  </span><span class=cB7>{</span><span class=cB0>
<a name="l75"></a>    </span><span class=cB1>if</span><span class=cB0> (!</span><span class=cB7>(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l75"></span><span class=cB5>InU16</a></span><span class=cB0>(fm801_io_bar+FM801_AC97_CMD) &amp; FM801_AC97_BUSY</span><span class=cB7>)</span><span class=cB0>)
<a name="l76"></a>    {
<a name="l77"></a>      <a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l78"></span><span class=cB5>OutU16</a></span><span class=cB0>(fm801_io_bar+FM801_AC97_DATA,val);
<a name="l78"></a>      <a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l78"></span><span class=cB5>OutU16</a></span><span class=cB0>(fm801_io_bar+FM801_AC97_CMD,r);
<a name="l79"></a>      </span><span class=cB1>for</span><span class=cB0> (j=0; j&lt;max_tries; j++)
<a name="l80"></a>      </span><span class=cB7>{</span><span class=cB0>
<a name="l81"></a>        <a href="http://tinkeros.github.io/WbGit/Kernel/KMisc.html#l137"></span><span class=cB5>Sleep</a></span><span class=cB0>(1);
<a name="l82"></a>        </span><span class=cB1>if</span><span class=cB0> (!</span><span class=cB7>(<a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l75"></span><span class=cB5>InU16</a></span><span class=cB0>(fm801_io_bar+FM801_AC97_CMD) &amp; FM801_AC97_BUSY</span><span class=cB7>)</span><span class=cB0>)
<a name="l83"></a>          </span><span class=cB1>return</span><span class=cB0>;
<a name="l84"></a>      </span><span class=cB7>}</span><span class=cB0>
<a name="l85"></a>    }
<a name="l86"></a>    <a href="http://tinkeros.github.io/WbGit/Kernel/KMisc.html#l137"></span><span class=cB5>Sleep</a></span><span class=cB0>(1);
<a name="l87"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l88"></a>  </span><span class=cB6>&quot;Failed to CodecWrite failed to write %04x to register %04x\n&quot;</span><span class=cB0>,val,r;
<a name="l89"></a>  codec_ok=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l23"></span><span class=cB3>FALSE</a></span><span class=cB0>;
<a name="l90"></a>  </span><span class=cB1>return</span><span class=cB0>;
<a name="l91"></a>}
<a name="l92"></a>
<a name="l93"></a></span><span class=cB1>static</span><span class=cB0> </span><span class=cB1>U0</span><span class=cB0> FM801Init()
<a name="l94"></a>{
<a name="l95"></a>  </span><span class=cB9>I64</span><span class=cB0> b, d, f;
<a name="l96"></a>  </span><span class=cB9>U32</span><span class=cB0> bar=0;
<a name="l97"></a>  </span><span class=cB1>U8</span><span class=cB0> *def_str;
<a name="l98"></a>  <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l321"></span><span class=cB9>CPciDevInfo</a></span><span class=cB0> snd_driver_pci;
<a name="l99"></a>  </span><span class=cB1>Bool</span><span class=cB0> found = <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l23"></span><span class=cB3>FALSE</a></span><span class=cB0>;
<a name="l100"></a>  </span><span class=cB1>if</span><span class=cB0> (<a href="http://tinkeros.github.io/WbGit/Kernel/PCI.html#l188"></span><span class=cB5>PciFindByID</a></span><span class=cB7>(</span><span class=cB0>PCIV_FM801,PCID_FM801, <a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l337"></span><span class=cB3>PCIC_MULTIMEDIA</a></span><span class=cB0>, 1, &amp;b, &amp;d, &amp;f</span><span class=cB7>)</span><span class=cB0>)
<a name="l101"></a>  </span><span class=cB7>{</span><span class=cB0>
<a name="l102"></a>    </span><span class=cB6>&quot;Found FM801 sound card!\n&quot;</span><span class=cB0>;
<a name="l103"></a>    found=<a href="http://tinkeros.github.io/WbGit/Kernel/KernelA.html#l22"></span><span class=cB3>TRUE</a></span><span class=cB0>;
<a name="l104"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l105"></a>  </span><span class=cB1>if</span><span class=cB0> (found)
<a name="l106"></a>  </span><span class=cB7>{</span><span class=cB0>
<a name="l107"></a>    <a href="http://tinkeros.github.io/WbGit/Kernel/PCI.html#l237"></span><span class=cB5>PciGetDevInfo</a></span><span class=cB0>(&amp;snd_driver_pci,b,d,f);
<a name="l108"></a>    bar=<a href="http://tinkeros.github.io/WbGit/Kernel/PCI.html#l263"></span><span class=cB5>PCIGetFirstIOBar</a></span><span class=cB0>(&amp;snd_driver_pci);
<a name="l109"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l110"></a>
<a name="l111"></a>  </span><span class=cB1>if</span><span class=cB0> (bar&gt;0)
<a name="l112"></a>  </span><span class=cB7>{</span><span class=cB0>
<a name="l113"></a>    </span><span class=cB6>&quot;Found Forte Media PCI card, trying to initialize!\n&quot;</span><span class=cB0>;
<a name="l114"></a>    fm801_io_bar=bar;
<a name="l115"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l116"></a>  </span><span class=cB1>else</span><span class=cB0>
<a name="l117"></a>  </span><span class=cB7>{</span><span class=cB0>
<a name="l118"></a>    </span><span class=cB1>return</span><span class=cB0>;
<a name="l119"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l120"></a>
<a name="l121"></a></span><span class=cB2>// PCI read cmd U16(0x4) should be 0x0 at start</span><span class=cB0>
<a name="l122"></a></span><span class=cB2>// enable io space and memory access and bus master</span><span class=cB0>
<a name="l123"></a></span><span class=cB2>// PCI write U16 0x07 to 0x4</span><span class=cB0>
<a name="l124"></a>
<a name="l125"></a>  <a href="http://tinkeros.github.io/WbGit/Kernel/PCI.html#l74"></span><span class=cB5>PCIWriteU16</a></span><span class=cB0>(b,d,f,0x4,<a href="http://tinkeros.github.io/WbGit/Kernel/PCI.html#l33"></span><span class=cB5>PCIReadU16</a></span><span class=cB7>(</span><span class=cB0>b,d,f,0x4</span><span class=cB7>)</span><span class=cB0>|0x7);
<a name="l126"></a>
<a name="l127"></a></span><span class=cB2>// PCI read U16(0x40) should be 0x907F at start</span><span class=cB0>
<a name="l128"></a></span><span class=cB2>// enable legacy</span><span class=cB0>
<a name="l129"></a>  <a href="http://tinkeros.github.io/WbGit/Kernel/PCI.html#l74"></span><span class=cB5>PCIWriteU16</a></span><span class=cB0>(b,d,f,0x40,0x7f);
<a name="l130"></a>
<a name="l131"></a></span><span class=cB2>// PCI read U16(0) = 0x1319</span><span class=cB0>
<a name="l132"></a></span><span class=cB2>// PCI read U16(2) = 0x0801</span><span class=cB0>
<a name="l133"></a>
<a name="l134"></a></span><span class=cB2>// PCI revision read U16(8) &gt;= 0xb1 -&gt; FM801-AU otherwise FM801-AS</span><span class=cB0>
<a name="l135"></a></span><span class=cB2>// AU multichannel TODO</span><span class=cB0>
<a name="l136"></a>
<a name="l137"></a>
<a name="l138"></a>
<a name="l139"></a>
<a name="l140"></a></span><span class=cB2>//OutU16D(fm801_io_bar+FM801_CODEC_CTRL, 0x20);</span><span class=cB0>
<a name="l141"></a>  OutU16D(fm801_io_bar+FM801_CODEC_CTRL, 0x30);
<a name="l142"></a>  <a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l75"></span><span class=cB5>InU16</a></span><span class=cB0>(fm801_io_bar+FM801_CODEC_CTRL);
<a name="l143"></a>  <a href="http://tinkeros.github.io/WbGit/Kernel/KMisc.html#l137"></span><span class=cB5>Sleep</a></span><span class=cB0>(1);
<a name="l144"></a>  OutU16D(fm801_io_bar+FM801_CODEC_CTRL, 0x0);
<a name="l145"></a></span><span class=cB2>//TODO linux wait_for_codec</span><span class=cB0>
<a name="l146"></a>  <a href="http://tinkeros.github.io/WbGit/Kernel/KMisc.html#l137"></span><span class=cB5>Sleep</a></span><span class=cB0>(1);
<a name="l147"></a>
<a name="l148"></a></span><span class=cB2>// Read</span><span class=cB0>
<a name="l149"></a>  OutU16D(fm801_io_bar+FM801_AC97_CMD, 0xa6);
<a name="l150"></a>  <a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l75"></span><span class=cB5>InU16</a></span><span class=cB0>(fm801_io_bar+FM801_AC97_DATA);
<a name="l151"></a>
<a name="l152"></a>  CodecWrite(0x0, 0x2);
<a name="l153"></a>  CodecWrite(0x8808, 0x4);
<a name="l154"></a>  CodecWrite(0x8808, 0x6);
<a name="l155"></a>  CodecWrite(0x8000, 0xa);
<a name="l156"></a>  CodecWrite(0x8008, 0xc);
<a name="l157"></a>  CodecWrite(0x8008, 0xe);
<a name="l158"></a>  CodecWrite(0x8808, 0x10);
<a name="l159"></a>  CodecWrite(0x808, 0x12);
<a name="l160"></a>  CodecWrite(0x8808, 0x14);
<a name="l161"></a>  CodecWrite(0x8808, 0x16);
<a name="l162"></a>  CodecWrite(0x0, 0x18);
<a name="l163"></a>  CodecWrite(0x505, 0x1a);
<a name="l164"></a>  CodecWrite(0x0, 0x1c);
<a name="l165"></a>  CodecWrite(0x0, 0x1e);
<a name="l166"></a>  CodecWrite(0x0, 0x20);
<a name="l167"></a>  CodecWrite(0x0, 0x22);
<a name="l168"></a>  CodecWrite(0x0, 0x38);
<a name="l169"></a>  CodecWrite(0x808, 0x72);
<a name="l170"></a>  CodecWrite(0x808, 0x74);
<a name="l171"></a>
<a name="l172"></a>  OutU16D(fm801_io_bar+FM801_IRQ_MASK, 0xff7c);
<a name="l173"></a>  OutU16D(fm801_io_bar+FM801_IRQ_STATUS, 0xff00);
<a name="l174"></a>  OutU16D(fm801_io_bar+FM801_PCM_VOL, 0x808);
<a name="l175"></a>  OutU16D(fm801_io_bar+FM801_FM_VOL, 0x0);
<a name="l176"></a>  OutU16D(fm801_io_bar+FM801_I2S_VOL, 0x808);
<a name="l177"></a>  OutU16D(fm801_io_bar+FM801_REC_SRC, 0x0);
<a name="l178"></a>  OutU16D(fm801_io_bar+FM801_PLY_CTRL, 0xca00);
<a name="l179"></a>  OutU16D(fm801_io_bar+FM801_CAP_CTRL, 0xca00);
<a name="l180"></a>  OutU16D(fm801_io_bar+FM801_CODEC_CTRL, 0x0);
<a name="l181"></a>  OutU16D(fm801_io_bar+FM801_I2S_MODE, 0x3);
<a name="l182"></a>
<a name="l183"></a>  <a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l80"></span><span class=cB5>OutU8</a></span><span class=cB0>(fm801_io_bar+FM801_OPL3_BANK1,5);
<a name="l184"></a>  <a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l80"></span><span class=cB5>OutU8</a></span><span class=cB0>(fm801_io_bar+FM801_OPL3_BANK1,0);
<a name="l185"></a>  <a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l80"></span><span class=cB5>OutU8</a></span><span class=cB0>(fm801_io_bar+FM801_OPL3_BANK1,4);
<a name="l186"></a>  <a href="http://tinkeros.github.io/WbGit/Kernel/KernelB.html#l80"></span><span class=cB5>OutU8</a></span><span class=cB0>(fm801_io_bar+FM801_OPL3_BANK1,0);
<a name="l187"></a>  <a href="http://tinkeros.github.io/WbGit/Kernel/KMisc.html#l137"></span><span class=cB5>Sleep</a></span><span class=cB0>(1);
<a name="l188"></a>
<a name="l189"></a>  OutU16D(fm801_io_bar+FM801_FM_VOL, 0x0);
<a name="l190"></a>  OutU16D(fm801_io_bar+0x50, 0x8);
<a name="l191"></a>  OutU16D(fm801_io_bar+FM801_GPIO_CTRL, 0xe40);
<a name="l192"></a>  OutU16D(fm801_io_bar+FM801_GEN_CTRL, 0x280c);
<a name="l193"></a>  OutU16D(fm801_io_bar+FM801_I2S_MODE, 0x3);
<a name="l194"></a>  OutU16D(fm801_io_bar+FM801_GEN_CTRL, 0x280c);
<a name="l195"></a>  OutU16D(fm801_io_bar+FM801_FM_VOL, 0x808);
<a name="l196"></a>
<a name="l197"></a>  FM801SetVol(50);
<a name="l198"></a>
<a name="l199"></a>  </span><span class=cB1>if</span><span class=cB0> (found &amp;&amp; codec_ok &amp;&amp; fm801_io_bar)
<a name="l200"></a>  </span><span class=cB7>{</span><span class=cB0>
<a name="l201"></a>    def_str=<a href="http://tinkeros.github.io/WbGit/Kernel/StrPrint.html#l1065"></span><span class=cB5>MStrPrint</a></span><span class=cB0>(</span><span class=cB6>&quot;#define FM801_OPL_BASE 0x%08x&quot;</span><span class=cB0>, fm801_io_bar+FM801_OPL3_BANK0);
<a name="l202"></a>    <a href="http://tinkeros.github.io/WbGit/Kernel/Job.html#l442"></span><span class=cB5>Adam</a></span><span class=cB0>(def_str);
<a name="l203"></a>    <a href="http://tinkeros.github.io/WbGit/Kernel/KMisc.html#l137"></span><span class=cB5>Sleep</a></span><span class=cB0>(10);
<a name="l204"></a>    <a href="http://tinkeros.github.io/WbGit/Kernel/Mem/MAllocFree.html#l415"></span><span class=cB5>Free</a></span><span class=cB0>(def_str);
<a name="l205"></a>    </span><span class=cB6>&quot;Found FM801 sound card!\n&quot;</span><span class=cB0>;
<a name="l206"></a>  </span><span class=cB7>}</span><span class=cB0>
<a name="l207"></a>}
<a name="l208"></a>
<a name="l209"></a>FM801Init;
<a name="l210"></a>
<a name="l211"></a></span><span class=cB2>// Sound mute/vol up/down hooks</span><span class=cB0>
<a name="l212"></a></span><span class=cB2>// Gameport</span><span class=cB0>
</span></div></pre></body>
</html>
